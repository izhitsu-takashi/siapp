# AIチャット機能 - 動作確認手順

## デプロイ完了 ✅

Firebase Functions `chatWithGemini` のデプロイが完了しました。

## 動作確認手順

### 1. アプリにアクセス

1. アプリのURLにアクセス
   - 本番環境: https://siapp-kadai3.web.app
   - または、ローカルで起動している場合は http://localhost:4200

2. 従業員アカウントでログイン

### 2. ナレッジページを開く

1. ログイン後、左側のメニューから「ナレッジ」タブをクリック
2. ナレッジページが表示されることを確認

### 3. チャット機能をテスト

1. **初期表示の確認**
   - チャットエリアに「こんにちは！人事・給与システムに関するご質問にお答えします。」というメッセージが表示されていることを確認

2. **メッセージを送信**
   - チャット入力欄に以下のような質問を入力：
     - 「健康保険について教えてください」
     - 「給与計算の方法を教えてください」
     - 「各種申請の手続きについて教えてください」
   - 「送信」ボタンをクリック（またはEnterキーを押す）

3. **応答の確認**
   - ローディングアニメーションが表示されることを確認
   - AIアシスタントからの応答が表示されることを確認
   - 応答が適切な内容であることを確認

4. **会話の継続**
   - 追加の質問を入力して、会話が継続できることを確認
   - 前の会話の文脈が保持されていることを確認

5. **チャット履歴のクリア**
   - 「クリア」ボタンをクリック
   - チャット履歴がクリアされ、初期メッセージが表示されることを確認

## 期待される動作

### 正常な動作

- ✅ メッセージを送信すると、ローディングアニメーションが表示される
- ✅ AIアシスタントからの応答が数秒以内に表示される
- ✅ 応答が日本語で、人事・給与システムに関する内容である
- ✅ 会話履歴が保持され、前の会話の文脈を理解している
- ✅ エラーメッセージが表示されない

### エラーが発生した場合

#### エラー: "Gemini API key is not configured"
- **原因**: 環境変数が正しく設定されていない
- **対処法**: 
  1. Firebase Consoleで環境変数が設定されているか確認
  2. 関数を再デプロイ: `firebase deploy --only functions:chatWithGemini`

#### エラー: "Failed to get response from Gemini"
- **原因**: APIキーが無効、またはネットワークエラー
- **対処法**:
  1. APIキーが有効か確認
  2. Firebase Functionsのログを確認:
     ```bash
     firebase functions:log --only chatWithGemini
     ```

#### エラー: ネットワークエラー
- **原因**: Firebase Functionsのエンドポイントに接続できない
- **対処法**:
  1. ネットワーク接続を確認
  2. ブラウザのコンソールでエラーを確認
  3. Firebase FunctionsのURLが正しいか確認

## トラブルシューティング

### Firebase Functionsのログを確認

```bash
firebase functions:log --only chatWithGemini
```

### ブラウザのコンソールでエラーを確認

1. ブラウザの開発者ツールを開く（F12キー）
2. 「Console」タブを開く
3. エラーメッセージを確認

### Firebase Consoleで関数の状態を確認

1. Firebase Console → Functions → chatWithGemini
2. 「ログ」タブでエラーログを確認
3. 「設定」タブで環境変数が設定されているか確認

## 次のステップ

動作確認が完了したら：

1. ✅ チャット機能が正常に動作することを確認
2. ✅ エラーが発生した場合は、上記のトラブルシューティングを参照
3. ✅ 問題が解決しない場合は、Firebase Functionsのログを確認

## 注意事項

- APIキーは機密情報です。Gitにコミットしないでください
- チャット機能は、Gemini APIの使用量に応じてコストが発生します
- 大量のリクエストがある場合は、Firebase Functionsの使用制限を確認してください

