rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 全コレクションへの読み書きを許可（バックグラウンド処理対応）
    match /{document=**} {
      allow read, write: if true;
    }
    
    // より厳密なルールが必要な場合は、以下のように個別に設定
    // ユーザー関連データ
    match /users/{userId} {
      allow read, write: if true;
    }
    
    // グループ関連データ
    match /groups/{groupId} {
      allow read, write: if true;
    }
    
    // 通知データ
    match /notifications/{notificationId} {
      allow read, write: if true;
    }
    
    // 自動送信スケジュール
    match /auto_report_schedules/{scheduleId} {
      allow read, write: if true;
    }
    
    // 進捗報告
    match /progressReports/{reportId} {
      allow read, write: if true;
    }
    
    // アナウンス
    match /announcements/{announcementId} {
      allow read, write: if true;
    }
    
    // 参加リクエスト
    match /joinRequests/{requestId} {
      allow read, write: if true;
    }
    
    // ユーザーアナウンスチェック
    match /userAnnouncementChecks/{checkId} {
      allow read, write: if true;
    }
    
    // グループメンバーシップ
    match /groupMemberships/{membershipId} {
      allow read, write: if true;
    }
    
    // タスク
    match /tasks/{taskId} {
      allow read, write: if true;
    }
    
    // リマインダー
    match /reminders/{reminderId} {
      allow read, write: if true;
    }
    
    // メッセージ
    match /messages/{messageId} {
      allow read, write: if true;
    }
    
    // メッセージスレッド
    match /messageThreads/{threadId} {
      allow read, write: if true;
    }
    
    // 進捗報告コメント
    match /progressReportComments/{commentId} {
      allow read, write: if true;
    }
    
    // メール送信用コレクション（Trigger Email拡張機能用）
    match /mail/{mailId} {
      allow read: if false; // 読み取りは禁止（拡張機能のみが使用）
      allow write: if true; // 書き込みは許可（アプリからメール送信をトリガー）
    }
  }
}