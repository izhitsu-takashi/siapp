<div class="dashboard-wrapper">
  <!-- ヘッダー -->
  <header class="dashboard-header">
    <div class="header-left">
      <h1 class="app-name">SIApp</h1>
    </div>
    <div class="header-right">
      <span class="user-info">
        <span class="user-name">{{ userName }}</span>
      </span>
      <button class="logout-button" (click)="logout()">ログアウト</button>
    </div>
  </header>

  <!-- メインコンテンツエリア -->
  <div class="dashboard-body">
    <!-- サイドバー -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <button
          *ngFor="let tab of tabs"
          class="sidebar-item"
          [class.active]="currentTab === tab.name"
          (click)="switchTab(tab.name)"
        >
          {{ tab.name }}
        </button>
      </nav>
    </aside>

    <!-- メインコンテンツ -->
    <main class="main-content">
      <div class="content-area">
        <!-- 社会保険料ページ -->
        <ng-container *ngIf="currentTab === '社会保険料'">
          <div class="insurance-list-page">
            <h2 class="page-title">社会保険料一覧</h2>
            
            <!-- フィルターと切り替え -->
            <div class="insurance-list-controls">
              <div class="filter-group">
                <label>表示タイプ:</label>
                <button 
                  class="toggle-button" 
                  [class.active]="insuranceListType === 'salary'"
                  (click)="switchInsuranceListType('salary')"
                >
                  給与
                </button>
                <button 
                  class="toggle-button" 
                  [class.active]="insuranceListType === 'bonus'"
                  (click)="switchInsuranceListType('bonus')"
                >
                  賞与
                </button>
              </div>
              <div class="filter-group">
                <label>年月:</label>
                <select 
                  [(ngModel)]="insuranceListYear" 
                  (change)="onInsuranceListDateChange()"
                  class="year-select"
                >
                  <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
                </select>
                <span>年</span>
                <select 
                  [(ngModel)]="insuranceListMonth" 
                  (change)="onInsuranceListDateChange()"
                  class="month-select"
                >
                  <option *ngFor="let month of availableMonths" [value]="month">{{ month }}</option>
                </select>
                <span>月</span>
              </div>
            </div>
            
            <!-- 事業主負担額合計 -->
            <div class="employer-burden-summary">
              <div class="summary-card">
                <span class="summary-label">事業主負担額合計:</span>
                <span class="summary-value">{{ getTotalEmployerBurden() | number:'1.0-0' }}円</span>
              </div>
            </div>
            
            <!-- 給与テーブル -->
            <div class="table-container" *ngIf="insuranceListType === 'salary'">
              <table class="insurance-table">
                <thead>
                  <tr>
                    <th>社員番号</th>
                    <th>氏名</th>
                    <th>固定的賃金</th>
                    <th>等級</th>
                    <th>標準報酬月額</th>
                    <th>健康保険料</th>
                    <th>介護保険料</th>
                    <th>厚生年金保険料</th>
                    <th>社員負担額</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of filteredInsuranceList; trackBy: trackByEmployeeNumber">
                    <td>{{ item.employeeNumber }}</td>
                    <td>{{ item.name }}</td>
                    <td class="number-cell">{{ item.fixedSalary | number:'1.0-0' }}円</td>
                    <td>{{ item.grade }}</td>
                    <td class="number-cell">{{ item.standardMonthlySalary | number:'1.0-0' }}円</td>
                    <td class="number-cell">{{ formatInsuranceAmount(item.healthInsurance) }}円</td>
                    <td class="number-cell">{{ formatInsuranceAmount(item.nursingInsurance) }}円</td>
                    <td class="number-cell">{{ formatInsuranceAmount(item.pensionInsurance) }}円</td>
                    <td class="number-cell total-cell">{{ item.employeeBurden | number:'1.0-0' }}円</td>
                  </tr>
                  <tr *ngIf="filteredInsuranceList.length === 0">
                    <td colspan="9" class="empty-message">データがありません</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr class="total-row">
                    <td colspan="5" class="total-label">合計</td>
                    <td class="total-value number-cell">{{ getTotalHealthInsurance() | number:'1.2-2' }}</td>
                    <td class="total-value number-cell">{{ getTotalNursingInsurance() | number:'1.2-2' }}</td>
                    <td class="total-value number-cell">{{ getTotalPensionInsurance() | number:'1.2-2' }}</td>
                    <td class="total-value number-cell">{{ getTotalEmployeeBurden() | number:'1.0-0' }}</td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- 賞与テーブル -->
            <div class="table-container" *ngIf="insuranceListType === 'bonus'">
              <table class="insurance-table">
                <thead>
                  <tr>
                    <th>社員番号</th>
                    <th>氏名</th>
                    <th>賞与額</th>
                    <th>標準賞与額</th>
                    <th>健康保険料</th>
                    <th>介護保険料</th>
                    <th>厚生年金保険料</th>
                    <th>社員負担額</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of filteredInsuranceList; trackBy: trackByEmployeeNumber">
                    <td>{{ item.employeeNumber }}</td>
                    <td>{{ item.name }}</td>
                    <td class="number-cell">{{ item.bonusAmount | number:'1.0-0' }}円</td>
                    <td class="number-cell">{{ item.standardBonusAmount | number:'1.0-0' }}円</td>
                    <td class="number-cell">{{ formatInsuranceAmount(item.healthInsurance) }}円</td>
                    <td class="number-cell">{{ formatInsuranceAmount(item.nursingInsurance) }}円</td>
                    <td class="number-cell">{{ formatInsuranceAmount(item.pensionInsurance) }}円</td>
                    <td class="number-cell total-cell">{{ item.employeeBurden | number:'1.0-0' }}円</td>
                  </tr>
                  <tr *ngIf="filteredInsuranceList.length === 0">
                    <td colspan="8" class="empty-message">データがありません</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr class="total-row">
                    <td colspan="4" class="total-label">合計</td>
                    <td class="total-value number-cell">{{ getTotalHealthInsurance() | number:'1.2-2' }}</td>
                    <td class="total-value number-cell">{{ getTotalNursingInsurance() | number:'1.2-2' }}</td>
                    <td class="total-value number-cell">{{ getTotalPensionInsurance() | number:'1.2-2' }}</td>
                    <td class="total-value number-cell">{{ getTotalEmployeeBurden() | number:'1.0-0' }}</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </ng-container>

        <!-- 給与ページ -->
        <ng-container *ngIf="currentTab === '給与'">
          <div class="page-header">
            <h2 class="page-title">給与設定</h2>
          </div>

          <!-- 給与設定フォーム -->
          <div class="form-container">
            <h3 class="form-section-title">給与設定</h3>
            <form class="salary-form" (ngSubmit)="saveSalary()">
              <div class="form-row-wide">
                <div class="form-group">
                  <label for="salaryEmployee">社員 <span class="required">*</span></label>
                  <select 
                    id="salaryEmployee" 
                    [(ngModel)]="selectedSalaryEmployee" 
                    name="salaryEmployee"
                    class="form-input"
                    required
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let emp of salaryEmployees" [value]="emp.employeeNumber">
                      {{ emp.employeeNumber }} - {{ emp.name }}
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="salaryYear">年 <span class="required">*</span></label>
                  <select 
                    id="salaryYear" 
                    [(ngModel)]="salaryYear" 
                    name="salaryYear"
                    class="form-input"
                    required
                  >
                    <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="salaryMonth">月 <span class="required">*</span></label>
                  <select 
                    id="salaryMonth" 
                    [(ngModel)]="salaryMonth" 
                    name="salaryMonth"
                    class="form-input"
                    required
                  >
                    <option *ngFor="let month of availableMonths" [value]="month">{{ month }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="salaryAmount">固定的賃金額（円） <span class="required">*</span></label>
                  <input 
                    type="number" 
                    id="salaryAmount" 
                    [(ngModel)]="salaryAmount" 
                    name="salaryAmount"
                    class="form-input"
                    min="1"
                    step="1"
                    (input)="onSalaryAmountInput($event)"
                    required
                  >
                </div>
                <div class="form-group form-group-button">
                  <button type="submit" class="submit-button">給与を設定</button>
                </div>
              </div>
            </form>
          </div>

          <!-- 給与履歴表 -->
          <div class="history-container">
            <h3 class="form-section-title">給与設定履歴</h3>
            <div class="table-container">
              <table class="history-table">
                <thead>
                  <tr>
                    <th>社員番号</th>
                    <th>氏名</th>
                    <th>年</th>
                    <th>月</th>
                    <th>固定的賃金額</th>
                    <th>設定日時</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let record of salaryHistory">
                    <td>{{ record.employeeNumber }}</td>
                    <td>{{ getEmployeeName(record.employeeNumber) }}</td>
                    <td>{{ record.year }}</td>
                    <td>{{ record.month }}</td>
                    <td>{{ record.amount | number:'1.0-0' }}円</td>
                    <td>{{ formatDateTime(record.createdAt) }}</td>
                  </tr>
                  <tr *ngIf="salaryHistory.length === 0">
                    <td colspan="6" class="empty-message">履歴がありません</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </ng-container>

        <!-- 賞与ページ -->
        <ng-container *ngIf="currentTab === '賞与'">
          <div class="page-header">
            <h2 class="page-title">賞与設定</h2>
          </div>

          <!-- 賞与設定フォーム -->
          <div class="form-container">
            <h3 class="form-section-title">賞与設定</h3>
            <form class="bonus-form" (ngSubmit)="saveBonus()">
              <div class="form-row-wide">
                <div class="form-group">
                  <label for="bonusEmployee">社員 <span class="required">*</span></label>
                  <select 
                    id="bonusEmployee" 
                    [(ngModel)]="selectedBonusEmployee" 
                    name="bonusEmployee"
                    class="form-input"
                    required
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let emp of bonusEmployees" [value]="emp.employeeNumber">
                      {{ emp.employeeNumber }} - {{ emp.name }}
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="bonusYear">年 <span class="required">*</span></label>
                  <select 
                    id="bonusYear" 
                    [(ngModel)]="bonusYear" 
                    name="bonusYear"
                    class="form-input"
                    required
                  >
                    <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="bonusMonth">月 <span class="required">*</span></label>
                  <select 
                    id="bonusMonth" 
                    [(ngModel)]="bonusMonth" 
                    name="bonusMonth"
                    class="form-input"
                    required
                  >
                    <option *ngFor="let month of availableMonths" [value]="month">{{ month }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="bonusAmount">賞与額（円） <span class="required">*</span></label>
                  <input 
                    type="number" 
                    id="bonusAmount" 
                    [(ngModel)]="bonusAmount" 
                    name="bonusAmount"
                    class="form-input"
                    min="1"
                    step="1"
                    (input)="onBonusAmountInput($event)"
                    required
                  >
                </div>
                <div class="form-group form-group-button">
                  <button type="submit" class="submit-button">賞与を設定</button>
                </div>
              </div>
            </form>
          </div>

          <!-- 賞与履歴表 -->
          <div class="history-container">
            <h3 class="form-section-title">賞与設定履歴</h3>
            <div class="table-container">
              <table class="history-table">
                <thead>
                  <tr>
                    <th>社員番号</th>
                    <th>氏名</th>
                    <th>年</th>
                    <th>月</th>
                    <th>賞与額</th>
                    <th>設定日時</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let record of bonusHistory">
                    <td>{{ record.employeeNumber }}</td>
                    <td>{{ getEmployeeName(record.employeeNumber) }}</td>
                    <td>{{ record.year }}</td>
                    <td>{{ record.month }}</td>
                    <td>{{ record.amount | number:'1.0-0' }}円</td>
                    <td>{{ formatDateTime(record.createdAt) }}</td>
                  </tr>
                  <tr *ngIf="bonusHistory.length === 0">
                    <td colspan="6" class="empty-message">履歴がありません</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </ng-container>

        <!-- 設定ページ -->
        <ng-container *ngIf="currentTab === '設定'">
          <div class="settings-page">
            <h2 class="page-title">設定</h2>
            
            <form [formGroup]="settingsForm">
              <!-- 健康保険設定 -->
              <section class="settings-section">
                <h3 class="section-title">健康保険設定</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="healthInsuranceType">健康保険種別</label>
                    <select 
                      id="healthInsuranceType" 
                      formControlName="healthInsuranceType" 
                      class="form-input"
                      (change)="onHealthInsuranceTypeChange()"
                    >
                      <option value="協会けんぽ">協会けんぽ</option>
                      <option value="組合保険">組合保険</option>
                    </select>
                  </div>
                  <div class="form-group" *ngIf="settingsForm.get('healthInsuranceType')?.value === '協会けんぽ'">
                    <label for="prefecture">都道府県 <span class="required">*</span></label>
                    <select 
                      id="prefecture" 
                      formControlName="prefecture" 
                      class="form-input"
                      (change)="onPrefectureChange()"
                    >
                      <option value="">選択してください</option>
                      <option *ngFor="let rate of kenpoRates" [value]="rate.prefecture">
                        {{ rate.prefecture }}
                      </option>
                    </select>
                  </div>
                </div>
                <div class="section-actions">
                  <button type="button" class="save-section-button" (click)="saveHealthInsuranceSetting()">
                    健康保険設定を保存
                  </button>
                </div>
              </section>

              <!-- 保険料率設定 -->
              <section class="settings-section">
                <h3 class="section-title">保険料率設定</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="healthInsuranceRate">健康保険料率 (%)</label>
                    <input 
                      type="number" 
                      id="healthInsuranceRate" 
                      formControlName="healthInsuranceRate" 
                      class="form-input"
                      step="0.01"
                      min="0"
                      max="100"
                      placeholder="例: 5.0"
                    >
                  </div>
                  <div class="form-group">
                    <label for="nursingInsuranceRate">介護保険料率 (%)</label>
                    <input 
                      type="number" 
                      id="nursingInsuranceRate" 
                      formControlName="nursingInsuranceRate" 
                      class="form-input"
                      step="0.01"
                      min="0"
                      max="100"
                      placeholder="例: 1.0"
                    >
                  </div>
                  <div class="form-group">
                    <label for="pensionInsuranceRate">厚生年金保険料率 (%)</label>
                    <input 
                      type="number" 
                      id="pensionInsuranceRate" 
                      formControlName="pensionInsuranceRate" 
                      class="form-input"
                      step="0.01"
                      min="0"
                      max="100"
                      placeholder="例: 9.15"
                    >
                  </div>
                </div>
                <div class="section-actions">
                  <button type="button" class="save-section-button" (click)="saveInsuranceRates()">
                    保険料率設定を保存
                  </button>
                </div>
              </section>

              <!-- 協会けんぽ保険料率管理 -->
              <section class="settings-section">
                <h3 class="section-title">協会けんぽ保険料率管理</h3>
                <div class="form-description">
                  <p>現在設定されている協会けんぽの保険料率データをダウンロードしたり、JSONファイルをアップロードして保険料率を更新できます。</p>
                </div>
                <div class="file-management-actions">
                  <button type="button" class="download-button" (click)="downloadKenpoRates()">
                    kenpo-rates.jsonをダウンロード
                  </button>
                  <div class="upload-group">
                    <label for="kenpoRatesFile" class="upload-label">
                      <input 
                        type="file" 
                        id="kenpoRatesFile" 
                        accept=".json"
                        (change)="onKenpoRatesFileSelected($event)"
                        style="display: none;"
                      >
                      <span class="upload-button">JSONファイルをアップロード</span>
                    </label>
                    <span *ngIf="selectedKenpoRatesFileName" class="selected-file-name">
                      {{ selectedKenpoRatesFileName }}
                    </span>
                  </div>
                  <button 
                    *ngIf="selectedKenpoRatesFile" 
                    type="button" 
                    class="apply-button" 
                    (click)="applyKenpoRates()"
                  >
                    保険料率を適用
                  </button>
                </div>
              </section>

              <!-- 等級表管理 -->
              <section class="settings-section">
                <h3 class="section-title">等級表管理</h3>
                <div class="form-description">
                  <p>現在設定されている標準報酬月額等級表データをダウンロードしたり、JSONファイルをアップロードして等級表を更新できます。</p>
                </div>
                <div class="file-management-actions">
                  <button type="button" class="download-button" (click)="downloadGradeTable()">
                    等級.jsonをダウンロード
                  </button>
                  <div class="upload-group">
                    <label for="gradeTableFile" class="upload-label">
                      <input 
                        type="file" 
                        id="gradeTableFile" 
                        accept=".json"
                        (change)="onGradeTableFileSelected($event)"
                        style="display: none;"
                      >
                      <span class="upload-button">JSONファイルをアップロード</span>
                    </label>
                    <span *ngIf="selectedGradeTableFileName" class="selected-file-name">
                      {{ selectedGradeTableFileName }}
                    </span>
                  </div>
                  <button 
                    *ngIf="selectedGradeTableFile" 
                    type="button" 
                    class="apply-button" 
                    (click)="applyGradeTable()"
                  >
                    等級表を適用
                  </button>
                </div>
              </section>
            </form>
          </div>
        </ng-container>
      </div>
    </main>
  </div>
</div>

