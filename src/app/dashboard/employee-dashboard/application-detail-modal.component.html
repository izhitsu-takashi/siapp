<!-- ========== 申請詳細モーダル ========== -->
<!-- モーダルのオーバーレイ（背景の半透明なレイヤー） -->
<div 
  class="modal-overlay" 
  *ngIf="isVisible"  <!-- isVisibleがtrueの時のみ表示 -->
  [class.modal-disabled]="isSubmittingReapplication"  <!-- 再申請送信中の場合、modal-disabledクラスを追加（ポインターイベントを無効化） -->
>
  <!-- モーダルのコンテンツ部分 -->
  <!-- stopPropagation(): クリックイベントが親要素（オーバーレイ）に伝播するのを防ぐ（オーバーレイをクリックしてもモーダルが閉じないようにする） -->
  <div class="modal-content application-detail-modal" (click)="$event.stopPropagation()">
    
    <!-- ========== モーダルヘッダー ========== -->
    <div class="modal-header">
      <!-- モーダルのタイトル -->
      <h2 class="modal-title">申請詳細</h2>
      <!-- モーダルを閉じるボタン -->
      <button 
        class="modal-close-button" 
        (click)="closeModal()"  <!-- クリック時にcloseModal()メソッドを呼び出し -->
        [disabled]="isSubmittingReapplication"  <!-- 再申請送信中はボタンを無効化 -->
        [title]="isSubmittingReapplication ? '処理中です。しばらくお待ちください。' : ''"  <!-- ホバー時のツールチップ -->
      >×</button>
    </div>
    
    <!-- ========== モーダルコンテンツ ========== -->
    <!-- 申請データが存在する場合のみ表示 -->
    <div class="application-detail-content" *ngIf="application">
      
      <!-- ========== 申請基本情報セクション ========== -->
      <section class="detail-section">
        <h3 class="section-title">申請基本情報</h3>
        <!-- グリッドレイアウトで情報を表示 -->
        <div class="detail-grid">
          <!-- 申請IDの表示 -->
          <div class="detail-item">
            <span class="detail-label">申請ID:</span>
            <span class="detail-value">{{ application.applicationId }}</span>
          </div>
          <!-- 申請種類の表示 -->
          <div class="detail-item">
            <span class="detail-label">申請種類:</span>
            <span class="detail-value">{{ application.applicationType }}</span>
          </div>
          <!-- ステータスの表示（バッジ付き） -->
          <div class="detail-item">
            <span class="detail-label">ステータス:</span>
            <span class="detail-value">
              <!-- ステータスに応じて異なる色のバッジを表示 -->
              <span class="status-badge" 
                    [class.status-pending]="application.status === '承認待ち'"  <!-- 承認待ちの場合、status-pendingクラスを追加 -->
                    [class.status-approved]="application.status === '承認' || application.status === '承認済み'"  <!-- 承認済みの場合、status-approvedクラスを追加 -->
                    [class.status-submitted]="application.status === '申請済み'"  <!-- 申請済みの場合、status-submittedクラスを追加 -->
                    [class.status-rejected]="application.status === '却下' || application.status === '差し戻し'"  <!-- 却下または差し戻しの場合、status-rejectedクラスを追加 -->
                    [class.status-resubmitted]="application.status === '再申請' || application.status === '再提出'"  <!-- 再申請の場合、status-resubmittedクラスを追加 -->
                    [class.status-cancelled]="application.status === '取り消し'">  <!-- 取り消しの場合、status-cancelledクラスを追加 -->
                {{ application.status }}  <!-- ステータスのテキストを表示 -->
              </span>
            </span>
          </div>
          <!-- 差し戻しコメントの表示（差し戻しステータスで、かつコメントが存在する場合のみ表示） -->
          <div class="detail-item full-width" *ngIf="application.status === '差し戻し' && application.statusComment">
            <span class="detail-label">差し戻しコメント:</span>
            <span class="detail-value">{{ application.statusComment }}</span>
          </div>
          <!-- 申請日の表示（DatePipeでフォーマット） -->
          <div class="detail-item">
            <span class="detail-label">申請日:</span>
            <span class="detail-value">{{ getApplicationDate(application) | date:'yyyy年MM月dd日' }}</span>
          </div>
        </div>
      </section>
      
      <!-- ========== 差し戻し申請の修正・再申請ボタンセクション ========== -->
      <!-- ステータスが「差し戻し」の場合のみ表示 -->
      <div class="reapplication-actions" *ngIf="application.status === '差し戻し'">
        <!-- 修正ボタン（編集モードでない場合のみ表示） -->
        <button 
          type="button" 
          class="edit-button" 
          (click)="enableEditMode()"  <!-- クリック時に編集モードを有効化 -->
          *ngIf="!isEditModeForReapplication"  <!-- 編集モードでない場合のみ表示 -->
          [disabled]="isSubmittingReapplication"  <!-- 再申請送信中はボタンを無効化 -->
          [title]="isSubmittingReapplication ? '処理中です。しばらくお待ちください。' : ''"  <!-- ホバー時のツールチップ -->
        >
          修正
        </button>
        <!-- 再申請ボタン（編集モードの場合のみ表示） -->
        <button 
          type="button" 
          class="resubmit-button" 
          (click)="submitReapplication()"  <!-- クリック時に再申請を送信 -->
          *ngIf="isEditModeForReapplication"  <!-- 編集モードの場合のみ表示 -->
          [disabled]="isSubmittingReapplication"  <!-- 再申請送信中はボタンを無効化 -->
          [title]="isSubmittingReapplication ? '処理中です。しばらくお待ちください。' : ''"  <!-- ホバー時のツールチップ -->
        >
          <!-- 送信中は「送信中...」、それ以外は「再申請」を表示 -->
          {{ isSubmittingReapplication ? '送信中...' : '再申請' }}
        </button>
      </div>
      
      <!-- ========== その他の申請タイプの詳細セクション（今後実装予定） ========== -->
      <!-- 実装済みの申請タイプ以外の場合に表示（現在は空のセクション） -->
      @if (isOtherApplicationType(application.applicationType)) {
        <section class="detail-section">
        </section>
      }
      
      <!-- ========== 添付資料セクション ========== -->
      <!-- 添付ファイルが存在する場合のみ表示 -->
      @if (hasAttachmentFiles(application)) {
        <section class="detail-section">
          <h3 class="section-title">添付資料</h3>
          <div class="detail-grid">
            <!-- 履歴書のリンク（URLが存在する場合のみ表示） -->
            @if (application.resumeFileUrl) {
              <div class="detail-item full-width">
                <span class="detail-label">履歴書:</span>
                <span class="detail-value">
                  <!-- 新しいタブで履歴書を開くリンク -->
                  <a [href]="application.resumeFileUrl" target="_blank" class="file-link">履歴書を開く</a>
                </span>
              </div>
            }
            <!-- 職務経歴書のリンク（URLが存在する場合のみ表示） -->
            @if (application.careerHistoryFileUrl) {
              <div class="detail-item full-width">
                <span class="detail-label">職務経歴書:</span>
                <span class="detail-value">
                  <!-- 新しいタブで職務経歴書を開くリンク -->
                  <a [href]="application.careerHistoryFileUrl" target="_blank" class="file-link">職務経歴書を開く</a>
                </span>
              </div>
            }
            <!-- 基礎年金番号がわかる書類のリンク（URLが存在する場合のみ表示） -->
            @if (application.basicPensionNumberDocFileUrl) {
              <div class="detail-item full-width">
                <span class="detail-label">基礎年金番号がわかる書類:</span>
                <span class="detail-value">
                  <!-- 新しいタブで基礎年金番号がわかる書類を開くリンク -->
                  <a [href]="application.basicPensionNumberDocFileUrl" target="_blank" class="file-link">基礎年金番号がわかる書類を開く</a>
                </span>
              </div>
            }
            <!-- 本人確認書類のリンク（URLが存在する場合のみ表示） -->
            @if (application.idDocumentFileUrl) {
              <div class="detail-item full-width">
                <span class="detail-label">本人確認書類:</span>
                <span class="detail-value">
                  <!-- 新しいタブで本人確認書類を開くリンク -->
                  <a [href]="application.idDocumentFileUrl" target="_blank" class="file-link">本人確認書類を開く</a>
                </span>
              </div>
            }
          </div>
        </section>
      }
    </div>
    
    <!-- ========== モーダルフッター ========== -->
    <div class="modal-footer">
      <!-- モーダルを閉じるボタン -->
      <button 
        type="button" 
        class="close-detail-button" 
        (click)="closeModal()"  <!-- クリック時にcloseModal()メソッドを呼び出し -->
        [disabled]="isSubmittingReapplication"  <!-- 再申請送信中はボタンを無効化 -->
        [title]="isSubmittingReapplication ? '処理中です。しばらくお待ちください。' : ''"  <!-- ホバー時のツールチップ -->
      >閉じる</button>
    </div>
  </div>
</div>
