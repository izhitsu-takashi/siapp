<div class="dashboard-wrapper">
  <!-- ヘッダー -->
  <header class="dashboard-header">
    <div class="header-left">
      <h1 class="app-name">SIApp</h1>
    </div>
    <div class="header-right">
      <span class="employee-info">
        <span class="employee-number">社員番号: {{ employeeNumber }}</span>
        <span class="employee-name">{{ employeeName }}</span>
      </span>
      <button class="logout-button" (click)="logout()" [attr.disabled]="isSubmittingOnboardingApplication ? '' : null" [title]="isSubmittingOnboardingApplication ? '申請中です。しばらくお待ちください。' : ''">ログアウト</button>
    </div>
  </header>

  <!-- メインコンテンツエリア -->
  <div class="dashboard-body">
    <!-- サイドバー -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <button
          *ngFor="let tab of tabs"
          class="sidebar-item"
          [class.active]="currentTab === tab.name"
          (click)="switchTab(tab.name)"
          [attr.disabled]="isSubmittingOnboardingApplication ? '' : null"
          [title]="isSubmittingOnboardingApplication ? '申請中です。しばらくお待ちください。' : ''"
        >
          {{ tab.name }}
        </button>
      </nav>
    </aside>

    <!-- メインコンテンツ -->
    <main class="main-content">
      <div class="content-area">
        <!-- 情報照会ページ -->
        <ng-container *ngIf="currentTab === '情報照会'">
          <div class="page-header">
            <h2 class="page-title">社員情報</h2>
          </div>

          <form [formGroup]="settingsForm" class="settings-form">
            
            <!-- 基本情報欄 -->
            <section class="form-section">
              <h3 class="section-title">基本情報</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="lastName">姓</label>
                  <input 
                    type="text" 
                    id="lastName" 
                    formControlName="lastName" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="firstName">名</label>
                  <input 
                    type="text" 
                    id="firstName" 
                    formControlName="firstName" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="lastNameKana">姓（ヨミガナ）</label>
                  <input 
                    type="text" 
                    id="lastNameKana" 
                    formControlName="lastNameKana" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="firstNameKana">名（ヨミガナ）</label>
                  <input 
                    type="text" 
                    id="firstNameKana" 
                    formControlName="firstNameKana" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="birthDate">生年月日</label>
                  <div class="birth-date-container">
                    <input 
                      type="date" 
                      id="birthDate" 
                      formControlName="birthDate" 
                      class="form-input"
                      [readonly]="true"
                      (change)="onBirthDateChange()"
                    >
                    <span *ngIf="age !== null" class="age-display">（{{ age }}歳）</span>
                  </div>
                </div>
                <div class="form-group">
                  <label for="gender">戸籍上の性別</label>
                  <select 
                    id="gender" 
                    formControlName="gender" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let g of genders" [value]="g">{{ g }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="email">メールアドレス</label>
                  <input 
                    type="email" 
                    id="email" 
                    formControlName="email" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group full-width">
                  <label>本人確認書類添付</label>
                  <div *ngIf="employeeData?.idDocumentFileUrl" class="file-info">
                    <a [href]="employeeData.idDocumentFileUrl" target="_blank" class="file-link">
                      {{ employeeData.idDocumentFile || '本人確認書類を開く' }}
                    </a>
                  </div>
                  <div *ngIf="!employeeData?.idDocumentFileUrl" class="file-info">
                    <span class="no-file-message">添付ファイルがありません</span>
                  </div>
                </div>
              </div>
            </section>

            <!-- マイナンバー欄 -->
            <section class="form-section">
              <h3 class="section-title">マイナンバー</h3>
              <div class="form-grid">
                <div class="form-group full-width">
                  <!-- <label for="myNumberPart1">マイナンバー</label> -->
                  <div class="my-number-container">
                    <div class="my-number-inputs">
                      <input 
                        type="text" 
                        id="myNumberPart1" 
                        [value]="getMyNumberDisplayValue(1)"
                        class="form-input my-number-part"
                        [readonly]="true"
                        maxlength="4"
                        (input)="formatMyNumberInput($event, 1)"
                        placeholder="0000"
                      >
                      <span class="my-number-separator">-</span>
                      <input 
                        type="text" 
                        id="myNumberPart2" 
                        [value]="getMyNumberDisplayValue(2)"
                        class="form-input my-number-part"
                        [readonly]="true"
                        maxlength="4"
                        (input)="formatMyNumberInput($event, 2)"
                        placeholder="0000"
                      >
                      <span class="my-number-separator">-</span>
                      <input 
                        type="text" 
                        id="myNumberPart3" 
                        [value]="getMyNumberDisplayValue(3)"
                        class="form-input my-number-part"
                        [readonly]="true"
                        maxlength="4"
                        (input)="formatMyNumberInput($event, 3)"
                        placeholder="0000"
                      >
                    </div>
                    <button 
                      type="button" 
                      class="toggle-button" 
                      (click)="toggleMyNumber()"
                    >
                      {{ showMyNumber ? '非表示' : '表示' }}
                    </button>
                  </div>
                </div>
                <div class="form-group full-width">
                  <label>マイナンバーカード添付</label>
                  <div *ngIf="employeeData?.myNumberCardFileUrl" class="file-info">
                    <a [href]="employeeData.myNumberCardFileUrl" target="_blank" class="file-link">
                      {{ employeeData.myNumberCardFile || 'マイナンバーカードを開く' }}
                    </a>
                  </div>
                  <div *ngIf="!employeeData?.myNumberCardFileUrl" class="file-info">
                    <span class="no-file-message">添付ファイルがありません</span>
                  </div>
                </div>
              </div>
            </section>

            <!-- 入退社情報欄 -->
            <section class="form-section">
              <h3 class="section-title">入退社情報</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="employmentStatus">在籍状況</label>
                  <select 
                    id="employmentStatus" 
                    formControlName="employmentStatus" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let status of employmentStatuses" [value]="status">{{ status }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="joinDate">入社年月日</label>
                  <input 
                    type="date" 
                    id="joinDate" 
                    formControlName="joinDate" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="resignationDate">退職年月日</label>
                  <input 
                    type="date" 
                    id="resignationDate" 
                    formControlName="resignationDate" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group full-width">
                  <label for="resignationReason">退職事由</label>
                  <textarea 
                    id="resignationReason" 
                    formControlName="resignationReason" 
                    class="form-input" 
                    rows="3"
                    [readonly]="true"
                  ></textarea>
                </div>
              </div>
            </section>

            <!-- 業務情報欄 -->
            <section class="form-section">
              <h3 class="section-title">業務情報</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="employeeNumber">社員番号</label>
                  <input 
                    type="text" 
                    id="employeeNumber" 
                    formControlName="employeeNumber" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="office">事業所</label>
                  <select 
                    id="office" 
                    formControlName="office" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let office of offices" [value]="office">{{ office }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="workContent">業務内容</label>
                  <select 
                    id="workContent" 
                    formControlName="workContent" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let content of workContents" [value]="content">{{ content }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="employmentType">雇用形態</label>
                  <select 
                    id="employmentType" 
                    formControlName="employmentType" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let type of employmentTypes" [value]="type">{{ type }}</option>
                  </select>
                </div>
                <!-- <div class="form-group">
                  <label for="paymentType">給与支給形態</label>
                  <select 
                    id="paymentType" 
                    formControlName="paymentType" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let type of paymentTypes" [value]="type">{{ type }}</option>
                  </select>
                </div> -->
              </div>
            </section>

            <!-- 部署・役職情報 -->
            <section class="form-section">
              <h3 class="section-title">部署・役職情報</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="department">部署</label>
                  <select 
                    id="department" 
                    formControlName="department" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="position">役職</label>
                  <select 
                    id="position" 
                    formControlName="position" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let pos of positions" [value]="pos">{{ pos }}</option>
                  </select>
                </div>
              </div>
            </section>

            <!-- 現住所と連絡先欄 -->
            <section class="form-section">
              <h3 class="section-title">現住所と連絡先</h3>
              <div class="form-grid">
                <div class="form-group full-width">
                  <label for="currentAddress">現住所</label>
                  <textarea 
                    id="currentAddress" 
                    formControlName="currentAddress" 
                    class="form-input" 
                    rows="2"
                    [readonly]="true"
                  ></textarea>
                </div>
                <div class="form-group full-width">
                  <label for="currentAddressKana">現住所（ヨミガナ）</label>
                  <textarea 
                    id="currentAddressKana" 
                    formControlName="currentAddressKana" 
                    class="form-input" 
                    rows="2"
                    [readonly]="true"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="phoneNumber">電話番号</label>
                  <input 
                    type="tel" 
                    id="phoneNumber" 
                    formControlName="phoneNumber" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="currentHouseholdHead">世帯主（本人/親族）</label>
                  <select 
                    id="currentHouseholdHead" 
                    formControlName="currentHouseholdHead" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let type of householdHeadTypes" [value]="type">{{ type }}</option>
                  </select>
                </div>
              </div>
            </section>

            <!-- 住民票住所欄 -->
            <section class="form-section">
              <h3 class="section-title">住民票住所</h3>
              <div class="form-grid">
                <div class="form-group full-width">
                  <label class="checkbox-label">
                    <input 
                      type="checkbox" 
                      [checked]="sameAsCurrentAddress" 
                      [disabled]="true"
                    >
                    住所（現住所と同じ）
                  </label>
                </div>
                <div class="form-group full-width">
                  <label for="residentAddress">住所</label>
                  <textarea 
                    id="residentAddress" 
                    formControlName="residentAddress" 
                    class="form-input" 
                    rows="2"
                    [readonly]="!isEditMode || sameAsCurrentAddress"
                  ></textarea>
                </div>
                <div class="form-group full-width">
                  <label for="residentAddressKana">住所（ヨミガナ）</label>
                  <textarea 
                    id="residentAddressKana" 
                    formControlName="residentAddressKana" 
                    class="form-input" 
                    rows="2"
                    [readonly]="!isEditMode || sameAsCurrentAddress"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="residentHouseholdHead">世帯主（本人/親族）</label>
                  <select 
                    id="residentHouseholdHead" 
                    formControlName="residentHouseholdHead" 
                    class="form-input"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let type of householdHeadTypes" [value]="type">{{ type }}</option>
                  </select>
                </div>
              </div>
            </section>

            <!-- 履歴書・職務経歴書欄 -->
            <section class="form-section">
              <h3 class="section-title">履歴書・職務経歴書</h3>
              <div class="form-grid">
                <div class="form-group full-width">
                  <label>履歴書添付</label>
                  <div *ngIf="employeeData?.resumeFileUrl" class="file-info">
                    <a [href]="employeeData.resumeFileUrl" target="_blank" class="file-link">
                      {{ employeeData.resumeFile || '履歴書を開く' }}
                    </a>
                  </div>
                  <div *ngIf="!employeeData?.resumeFileUrl" class="file-info">
                    <span class="no-file-message">添付ファイルがありません</span>
                  </div>
                </div>
                <div class="form-group full-width">
                  <label>職務経歴書添付</label>
                  <div *ngIf="employeeData?.careerHistoryFileUrl" class="file-info">
                    <a [href]="employeeData.careerHistoryFileUrl" target="_blank" class="file-link">
                      {{ employeeData.careerHistoryFile || '職務経歴書を開く' }}
                    </a>
                  </div>
                  <div *ngIf="!employeeData?.careerHistoryFileUrl" class="file-info">
                    <span class="no-file-message">添付ファイルがありません</span>
                  </div>
                </div>
              </div>
            </section>

            <!-- 緊急連絡先欄 -->
            <section class="form-section">
              <h3 class="section-title">緊急連絡先</h3>
              <div formGroupName="emergencyContact" class="nested-form">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="emergencyName">氏名</label>
                    <input 
                      type="text" 
                      id="emergencyName" 
                      formControlName="name" 
                      class="form-input"
                      [readonly]="true"
                    >
                  </div>
                  <div class="form-group">
                    <label for="emergencyNameKana">氏名（ヨミガナ）</label>
                    <input 
                      type="text" 
                      id="emergencyNameKana" 
                      formControlName="nameKana" 
                      class="form-input"
                      [readonly]="true"
                    >
                  </div>
                  <div class="form-group">
                    <label for="emergencyRelationship">続柄</label>
                    <input 
                      type="text" 
                      id="emergencyRelationship" 
                      formControlName="relationship" 
                      class="form-input"
                      [readonly]="true"
                    >
                  </div>
                  <div class="form-group">
                    <label for="emergencyPhone">緊急連絡先電話番号</label>
                    <input 
                      type="tel" 
                      id="emergencyPhone" 
                      formControlName="phone" 
                      class="form-input"
                      [readonly]="true"
                    >
                  </div>
                  <div class="form-group full-width">
                    <label for="emergencyAddress">住所</label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                      <input 
                        type="checkbox" 
                        [checked]="sameAsCurrentAddressForEmergency"
                        (change)="onSameAddressForEmergencyChange($event)"
                        [disabled]="true"
                        class="checkbox-input"
                      >
                      現住所と同じ
                    </label>
                    <textarea 
                      id="emergencyAddress" 
                      formControlName="address" 
                      class="form-input" 
                      rows="2"
                      [readonly]="!isEditMode || sameAsCurrentAddressForEmergency"
                    ></textarea>
                  </div>
                  <div class="form-group full-width">
                    <label for="emergencyAddressKana">住所（ヨミガナ）</label>
                    <textarea 
                      id="emergencyAddressKana" 
                      formControlName="addressKana" 
                      class="form-input" 
                      rows="2"
                      [readonly]="!isEditMode || sameAsCurrentAddressForEmergency"
                    ></textarea>
                  </div>
                </div>
              </div>
            </section>

            <!-- 口座情報欄 -->
            <section class="form-section">
              <h3 class="section-title">口座情報</h3>
              <div formGroupName="bankAccount" class="nested-form">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="bankName">銀行名</label>
                    <input 
                      type="text" 
                      id="bankName" 
                      formControlName="bankName" 
                      class="form-input"
                      [readonly]="true"
                    >
                  </div>
                  <div class="form-group">
                    <label for="accountType">預金種別</label>
                    <select 
                      id="accountType" 
                      formControlName="accountType" 
                      class="form-input"
                    >
                      <option value="">選択してください</option>
                      <option value="普通">普通</option>
                      <option value="当座">当座</option>
                      <option value="貯蓄">貯蓄</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="accountHolder">名義（カタカナ）</label>
                    <input 
                      type="text" 
                      id="accountHolder" 
                      formControlName="accountHolder" 
                      class="form-input"
                      [readonly]="true"
                    >
                  </div>
                  <div class="form-group">
                    <label for="branchName">支店名</label>
                    <input 
                      type="text" 
                      id="branchName" 
                      formControlName="branchName" 
                      class="form-input"
                      [readonly]="true"
                    >
                  </div>
                  <div class="form-group">
                    <label for="accountNumber">口座番号</label>
                    <input 
                      type="text" 
                      id="accountNumber" 
                      formControlName="accountNumber" 
                      class="form-input"
                      [readonly]="true"
                    >
                  </div>
                </div>
              </div>
            </section>

            <!-- 社会保険欄 -->
            <section class="form-section">
              <h3 class="section-title">社会保険</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="healthInsuranceNumber">健康保険の被保険者整理番号</label>
                  <input 
                    type="text" 
                    id="healthInsuranceNumber" 
                    formControlName="healthInsuranceNumber" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="pensionInsuranceNumber">厚生年金保険の被保険者整理番号</label>
                  <input 
                    type="text" 
                    id="pensionInsuranceNumber" 
                    formControlName="pensionInsuranceNumber" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="basicPensionNumberPart1">基礎年金番号</label>
                  <div class="basic-pension-number-container">
                    <input 
                      type="text" 
                      id="basicPensionNumberPart1" 
                      formControlName="basicPensionNumberPart1" 
                      class="form-input basic-pension-part"
                      maxlength="4"
                      (input)="formatBasicPensionNumberInput($event, 1)"
                      placeholder="0000"
                      [readonly]="true"
                    >
                    <span class="basic-pension-separator">-</span>
                    <input 
                      type="text" 
                      id="basicPensionNumberPart2" 
                      formControlName="basicPensionNumberPart2" 
                      class="form-input basic-pension-part"
                      maxlength="6"
                      (input)="formatBasicPensionNumberInput($event, 2)"
                      placeholder="000000"
                      [readonly]="true"
                    >
                  </div>
                </div>
                <div class="form-group">
                  <label for="pensionHistoryStatus">厚生年金加入履歴</label>
                  <select 
                    id="pensionHistoryStatus" 
                    formControlName="pensionHistoryStatus" 
                    class="form-input" 
                    (change)="onPensionHistoryChange($event)"
                  >
                    <option value="">選択してください</option>
                    <option *ngFor="let option of pensionHistoryOptions" [value]="option">{{ option }}</option>
                  </select>
                </div>
                <div class="form-group full-width" *ngIf="hasPensionHistory">
                  <label for="pensionHistory">厚生年金加入履歴（詳細）</label>
                  <textarea 
                    id="pensionHistory" 
                    formControlName="pensionHistory" 
                    class="form-input" 
                    rows="4"
                    [readonly]="true"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="socialInsuranceAcquisitionDate">社会保険の資格取得年月日</label>
                  <input 
                    type="date" 
                    id="socialInsuranceAcquisitionDate" 
                    formControlName="socialInsuranceAcquisitionDate" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group">
                  <label for="socialInsuranceLossDate">社会保険の資格喪失年月日</label>
                  <input 
                    type="date" 
                    id="socialInsuranceLossDate" 
                    formControlName="socialInsuranceLossDate" 
                    class="form-input"
                    [readonly]="true"
                  >
                </div>
                <div class="form-group full-width">
                  <label>基礎年金番号確認書類添付</label>
                  <div *ngIf="employeeData?.basicPensionNumberDocFileUrl" class="file-info">
                    <a [href]="employeeData.basicPensionNumberDocFileUrl" target="_blank" class="file-link">
                      {{ employeeData.basicPensionNumberDocFile || '基礎年金番号がわかる書類を開く' }}
                    </a>
                  </div>
                  <div *ngIf="!employeeData?.basicPensionNumberDocFileUrl" class="file-info">
                    <span class="no-file-message">添付ファイルがありません</span>
                  </div>
                </div>
              </div>
            </section>

            <!-- 送信ボタン -->
            <div class="form-actions" *ngIf="isEditMode">
              <button type="submit" class="submit-button" [disabled]="settingsForm.invalid || isSaving">
                {{ isSaving ? '保存中...' : '保存' }}
              </button>
            </div>
          </form>
        </ng-container>

        <!-- 各種申請ページ -->
        <ng-container *ngIf="currentTab === '各種申請'">
          <div class="page-header">
            <h2 class="page-title">各種申請</h2>
          </div>
          
          <div class="application-grid">
            <button 
              *ngIf="!hasOnboardingApplication"
              class="application-button" 
              (click)="openApplicationModal('入社時申請')"
            >
              <span class="application-icon">📝</span>
              <span class="application-label">入社時申請</span>
            </button>
            
            <button 
              class="application-button" 
              (click)="openApplicationModal('扶養家族追加')"
              [disabled]="!isOnboardingCompleted"
              [title]="!isOnboardingCompleted ? '入社処理が完了するまで利用できません' : ''"
            >
              <span class="application-icon">👨‍👩‍👧</span>
              <span class="application-label">扶養家族追加</span>
            </button>
            
            <button 
              class="application-button" 
              (click)="openApplicationModal('扶養削除申請')"
              [disabled]="!isOnboardingCompleted"
              [title]="!isOnboardingCompleted ? '入社処理が完了するまで利用できません' : ''"
            >
              <span class="application-icon">❌</span>
              <span class="application-label">扶養削除申請</span>
            </button>
            
            <button 
              class="application-button" 
              (click)="openApplicationModal('住所変更申請')"
              [disabled]="!isOnboardingCompleted"
              [title]="!isOnboardingCompleted ? '入社処理が完了するまで利用できません' : ''"
            >
              <span class="application-icon">🏠</span>
              <span class="application-label">住所変更申請</span>
            </button>
            
            <button 
              class="application-button" 
              (click)="openApplicationModal('氏名変更申請')"
              [disabled]="!isOnboardingCompleted"
              [title]="!isOnboardingCompleted ? '入社処理が完了するまで利用できません' : ''"
            >
              <span class="application-icon">✏️</span>
              <span class="application-label">氏名変更申請</span>
            </button>
            
            <button 
              class="application-button" 
              (click)="openApplicationModal('マイナンバー変更申請')"
              [disabled]="!isOnboardingCompleted"
              [title]="!isOnboardingCompleted ? '入社処理が完了するまで利用できません' : ''"
            >
              <span class="application-icon">🔢</span>
              <span class="application-label">マイナンバー変更申請</span>
            </button>
            
            <button 
              class="application-button" 
              (click)="openApplicationModal('産前産後休業申請')"
              [disabled]="!isOnboardingCompleted"
              [title]="!isOnboardingCompleted ? '入社処理が完了するまで利用できません' : ''"
            >
              <span class="application-icon">🤰</span>
              <span class="application-label">産前産後休業申請</span>
            </button>
            
            <button 
              class="application-button" 
              (click)="openApplicationModal('退職申請')"
              [disabled]="!isOnboardingCompleted"
              [title]="!isOnboardingCompleted ? '入社処理が完了するまで利用できません' : ''"
            >
              <span class="application-icon">🚪</span>
              <span class="application-label">退職申請</span>
            </button>
          </div>
        </ng-container>

        <!-- メインページ -->
        <ng-container *ngIf="currentTab === 'メインページ'">
          <div class="page-header">
            <h2 class="page-title">メインページ</h2>
          </div>
          <div class="main-page-layout">
            <!-- 上部エリア：自分の情報欄と人事からの依頼欄 -->
            <div class="main-page-top">
              <!-- 自分の情報欄 -->
              <div class="info-card my-info-card">
                <h3 class="card-title">自分の情報</h3>
                <div class="info-content" *ngIf="employeeData">
                  <div class="info-row">
                    <span class="info-label">社員番号:</span>
                    <span class="info-value">{{ employeeData.employeeNumber || employeeNumber }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">氏名:</span>
                    <span class="info-value">{{ (employeeData.lastName || '') + (employeeData.firstName || '') || employeeData.name || employeeName }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">部署:</span>
                    <span class="info-value">{{ employeeData.department || '-' }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">役職:</span>
                    <span class="info-value">{{ employeeData.position || '-' }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">雇用形態:</span>
                    <span class="info-value">{{ employeeData.employmentType || '-' }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">在籍状況:</span>
                    <span class="info-value">{{ employeeData.employmentStatus || '在籍' }}</span>
                  </div>
                </div>
                <div class="info-content" *ngIf="!employeeData">
                  <p class="no-data">情報を読み込み中...</p>
                </div>
              </div>

              <!-- 人事からの依頼欄 -->
              <div class="info-card hr-request-card">
                <h3 class="card-title">
                  人事からの依頼
                  <span class="request-badge" *ngIf="hrRequests.length > 0">{{ hrRequests.length }}</span>
                </h3>
                <div class="request-content">
                  <div *ngIf="hrRequests.length === 0" class="no-data">
                    現在、依頼はありません
                  </div>
                  <div *ngFor="let request of hrRequests" class="request-item">
                    <div class="request-header">
                      <span class="request-title">{{ request.title }}</span>
                      <span class="request-date" *ngIf="request.date">{{ request.date | date:'yyyy/MM/dd' }}</span>
                    </div>
                    <p class="request-message">{{ request.message }}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- 申請一覧テーブル -->
            <div class="application-list-section">
              <div class="section-header">
                <h3 class="section-title">申請一覧</h3>
              </div>
              <div class="table-container">
                <table class="application-table">
                  <thead>
                    <tr>
                      <th>申請ID</th>
                      <th>申請種類</th>
                      <th>ステータス</th>
                      <th>申請日</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let application of applications" class="application-row" (click)="openApplicationDetail(application)">
                      <td>{{ application.applicationId }}</td>
                      <td>{{ application.applicationType }}</td>
                      <td>
                        <span class="status-badge"
                              [class.status-pending]="application.status === '承認待ち'"
                              [class.status-reviewing]="application.status === '確認中'"
                              [class.status-approved]="application.status === '承認' || application.status === '承認済み'"
                              [class.status-submitted]="application.status === '申請済み'"
                              [class.status-rejected]="application.status === '却下' || application.status === '差し戻し'"
                              [class.status-cancelled]="application.status === '取り消し'"
                              [class.status-resubmitted]="application.status === '再申請' || application.status === '再提出'">
                          {{ application.status }}
                        </span>
                        <div *ngIf="application.status === '差し戻し' && application.statusComment" class="status-comment-preview">
                          <small>{{ application.statusComment }}</small>
                        </div>
                      </td>
                      <td>{{ getApplicationDate(application) | date:'yyyy/MM/dd' }}</td>
                    </tr>
                    <tr *ngIf="applications.length === 0">
                      <td colspan="4" class="empty-message">申請履歴がありません</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- パスワード変更ページ -->
        <ng-container *ngIf="currentTab === 'パスワード変更'">
          <div class="page-header">
            <h2 class="page-title">パスワード変更</h2>
          </div>
          
          <form [formGroup]="passwordChangeForm" (ngSubmit)="changePassword()" class="settings-form">
            <section class="form-section">
              <h3 class="section-title">パスワード変更</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="currentPassword">現在のパスワード <span class="required">*</span></label>
                  <input 
                    type="password" 
                    id="currentPassword" 
                    formControlName="currentPassword" 
                    class="form-input"
                    placeholder="現在のパスワードを入力"
                  >
                  <div *ngIf="passwordChangeForm.get('currentPassword')?.invalid && passwordChangeForm.get('currentPassword')?.touched" class="error-message">
                    現在のパスワードを入力してください
                  </div>
                </div>
                <div class="form-group">
                  <label for="newPassword">新しいパスワード <span class="required">*</span></label>
                  <input 
                    type="password" 
                    id="newPassword" 
                    formControlName="newPassword" 
                    class="form-input"
                    placeholder="新しいパスワードを入力（6文字以上）"
                  >
                  <div *ngIf="passwordChangeForm.get('newPassword')?.invalid && passwordChangeForm.get('newPassword')?.touched" class="error-message">
                    新しいパスワードを6文字以上で入力してください
                  </div>
                </div>
                <div class="form-group">
                  <label for="confirmPassword">新しいパスワード（確認） <span class="required">*</span></label>
                  <input 
                    type="password" 
                    id="confirmPassword" 
                    formControlName="confirmPassword" 
                    class="form-input"
                    placeholder="新しいパスワードを再入力"
                  >
                  <div *ngIf="passwordChangeForm.get('confirmPassword')?.invalid && passwordChangeForm.get('confirmPassword')?.touched" class="error-message">
                    新しいパスワードを再入力してください
                  </div>
                  <div *ngIf="passwordChangeForm.get('confirmPassword')?.hasError('passwordMismatch') && passwordChangeForm.get('confirmPassword')?.touched" class="error-message">
                    新しいパスワードが一致しません
                  </div>
                </div>
              </div>
            </section>
            
            <div class="form-actions">
              <button type="submit" class="submit-button" [disabled]="passwordChangeForm.invalid">
                パスワードを変更
              </button>
            </div>
          </form>
        </ng-container>

        <!-- その他のタブ -->
        <!-- 保険・扶養ページ -->
        <ng-container *ngIf="currentTab === '保険・扶養'">
          <div class="page-header">
            <h2 class="page-title">保険・扶養情報</h2>
          </div>
          <div class="insurance-dependents-page">
            
            <!-- 保険者種別情報 -->
            <section class="info-section">
              <h3 class="section-title">保険者種別</h3>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">健康保険者種別:</span>
                  <span class="info-value">{{ insuranceData?.healthInsuranceType || '未設定' }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">介護保険者種別:</span>
                  <span class="info-value">{{ insuranceData?.nursingInsuranceType || '未設定' }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">厚生年金保険者種別:</span>
                  <span class="info-value">{{ insuranceData?.pensionInsuranceType || '未設定' }}</span>
                </div>
              </div>
            </section>

            <!-- 扶養者情報 -->
            <section class="info-section">
              <h3 class="section-title">扶養者情報</h3>
              <div class="dependents-list">
                <div *ngIf="dependentsData.length === 0" class="no-data-message">
                  扶養者が登録されていません。
                </div>
                <div *ngFor="let dependent of dependentsData; let i = index" class="dependent-card">
                  <div class="dependent-header" (click)="toggleDependentExpanded(i)" style="cursor: pointer;">
                    <h4 class="dependent-title">扶養者 {{ i + 1 }} <span class="expand-icon">{{ isDependentExpanded(i) ? '▼' : '▶' }}</span></h4>
                  </div>
                  <div class="dependent-info-grid" *ngIf="isDependentExpanded(i)">
                    <div class="dependent-info-item">
                      <span class="dependent-label">氏名:</span>
                      <span class="dependent-value">{{ dependent.name || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">氏名（ヨミガナ）:</span>
                      <span class="dependent-value">{{ dependent.nameKana || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">続柄:</span>
                      <span class="dependent-value">{{ dependent.relationship || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">生年月日:</span>
                      <span class="dependent-value">{{ dependent.birthDate ? (dependent.birthDate | date:'yyyy年MM月dd日') : '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">性別:</span>
                      <span class="dependent-value">{{ dependent.gender || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">電話番号:</span>
                      <span class="dependent-value">{{ dependent.phoneNumber || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">職業:</span>
                      <span class="dependent-value">{{ dependent.occupation || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">年間収入見込み額:</span>
                      <span class="dependent-value">{{ dependent.annualIncome ? (dependent.annualIncome | number:'1.0-0') + '円' : '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">月額収入見込み額:</span>
                      <span class="dependent-value">{{ dependent.monthlyIncome ? (dependent.monthlyIncome | number:'1.0-0') + '円' : '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">社会保険の扶養者となった日:</span>
                      <span class="dependent-value">{{ dependent.dependentStartDate ? (dependent.dependentStartDate | date:'yyyy年MM月dd日') : '-' }}</span>
                    </div>
                    <div class="dependent-info-item full-width">
                      <span class="dependent-label">扶養に追加された理由:</span>
                      <span class="dependent-value">{{ dependent.dependentReason || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">マイナンバー:</span>
                      <span class="dependent-value">{{ dependent.myNumber ? '●●●●-●●●●-●●●●' : '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">同居/別居:</span>
                      <span class="dependent-value">{{ dependent.livingTogether || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">郵便番号:</span>
                      <span class="dependent-value">{{ dependent.postalCode || '-' }}</span>
                    </div>
                    <div class="dependent-info-item full-width">
                      <span class="dependent-label">住所:</span>
                      <span class="dependent-value">{{ dependent.address || '-' }}</span>
                    </div>
                    <div class="dependent-info-item full-width">
                      <span class="dependent-label">住所（ヨミガナ）:</span>
                      <span class="dependent-value">{{ dependent.addressKana || '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">住所変更年月日:</span>
                      <span class="dependent-value">{{ dependent.addressChangeDate ? (dependent.addressChangeDate | date:'yyyy年MM月dd日') : '-' }}</span>
                    </div>
                    <div class="dependent-info-item">
                      <span class="dependent-label">基礎年金番号:</span>
                      <span class="dependent-value">{{ dependent.basicPensionNumber || '-' }}</span>
                    </div>
                    <ng-container *ngIf="dependent.disabilityCategory || dependent.disabilityCardType || dependent.disabilityCardIssueDate">
                      <div class="dependent-info-item">
                        <span class="dependent-label">障がい者区分:</span>
                        <span class="dependent-value">{{ dependent.disabilityCategory || '-' }}</span>
                      </div>
                      <div class="dependent-info-item">
                        <span class="dependent-label">障がい者手帳の種類:</span>
                        <span class="dependent-value">{{ dependent.disabilityCardType || '-' }}</span>
                      </div>
                      <div class="dependent-info-item">
                        <span class="dependent-label">障がい者手帳の交付年月日:</span>
                        <span class="dependent-value">{{ dependent.disabilityCardIssueDate ? (dependent.disabilityCardIssueDate | date:'yyyy年MM月dd日') : '-' }}</span>
                      </div>
                    </ng-container>
                    <!-- 添付書類 -->
                    <ng-container *ngIf="dependent.basicPensionNumberDocFileUrl || dependent.myNumberDocFileUrl || dependent.identityDocFileUrl || dependent.disabilityCardFileUrl">
                      <div class="dependent-info-item full-width">
                        <span class="dependent-label">添付書類:</span>
                        <div class="dependent-value">
                          <div *ngIf="dependent.basicPensionNumberDocFileUrl" style="margin-bottom: 0.5rem;">
                            <a [href]="dependent.basicPensionNumberDocFileUrl" target="_blank" class="file-link">{{ getFileNameFromUrl(dependent.basicPensionNumberDocFileUrl, dependent.basicPensionNumberDocFileName) }}</a>
                          </div>
                          <div *ngIf="dependent.myNumberDocFileUrl" style="margin-bottom: 0.5rem;">
                            <a [href]="dependent.myNumberDocFileUrl" target="_blank" class="file-link">{{ getFileNameFromUrl(dependent.myNumberDocFileUrl, dependent.myNumberDocFileName) }}</a>
                          </div>
                          <div *ngIf="dependent.identityDocFileUrl" style="margin-bottom: 0.5rem;">
                            <a [href]="dependent.identityDocFileUrl" target="_blank" class="file-link">{{ getFileNameFromUrl(dependent.identityDocFileUrl, dependent.identityDocFileName) }}</a>
                          </div>
                          <div *ngIf="dependent.disabilityCardFileUrl">
                            <a [href]="dependent.disabilityCardFileUrl" target="_blank" class="file-link">{{ getFileNameFromUrl(dependent.disabilityCardFileUrl, dependent.disabilityCardFileName) }}</a>
                          </div>
                        </div>
                      </div>
                    </ng-container>
                    <div class="dependent-info-item full-width" *ngIf="dependent.notes">
                      <span class="dependent-label">備考:</span>
                      <span class="dependent-value">{{ dependent.notes }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </ng-container>

        <!-- ナレッジページ -->
        <ng-container *ngIf="currentTab === 'ナレッジ'">
          <div class="page-header">
            <h2 class="page-title">ナレッジ - AIアシスタント</h2>
          </div>
          <div class="knowledge-page">
            <p class="knowledge-description">
              人事・給与システムに関するご質問にお答えします。わからないことがあれば、お気軽にお尋ねください。
            </p>
            
            <!-- チャットエリア -->
            <div class="chat-container">
              <div class="chat-messages" #chatMessagesContainer>
                <div *ngIf="chatMessages.length === 0" class="chat-welcome">
                  <p>こんにちは！人事・給与システムに関するご質問にお答えします。</p>
                  <p>どのようなことでお困りでしょうか？</p>
                  
                  <!-- テンプレート質問 -->
                  <div class="template-questions">
                    <p class="template-questions-title">よくある質問から選ぶ：</p>
                    <div class="template-questions-grid">
                      <button
                        *ngFor="let template of templateQuestions"
                        class="template-question-button"
                        (click)="sendTemplateQuestion(template.question)"
                        [disabled]="isChatLoading"
                      >
                        <span class="template-question-icon">{{ template.icon }}</span>
                        <span class="template-question-text">{{ template.text }}</span>
                      </button>
                    </div>
                  </div>
                </div>
                <div *ngFor="let message of chatMessages" class="chat-message" [class.user-message]="message.role === 'user'" [class.assistant-message]="message.role === 'assistant'">
                  <div class="message-content">
                    <div class="message-role" *ngIf="message.role === 'user'">あなた</div>
                    <div class="message-role" *ngIf="message.role === 'assistant'">AIアシスタント</div>
                    <div class="message-text">{{ message.content }}</div>
                    <!-- 申請ボタン（アシスタントの応答で申請タイプがある場合） -->
                    <div *ngIf="message.role === 'assistant' && message.applicationType" class="application-button-container">
                      <button
                        class="application-action-button"
                        (click)="openApplicationFromChat(message.applicationType!)"
                        [disabled]="!isOnboardingCompleted && message.applicationType !== '入社時申請'"
                        [title]="!isOnboardingCompleted && message.applicationType !== '入社時申請' ? '入社処理が完了するまで利用できません' : ''"
                      >
                        <span class="application-action-icon">📝</span>
                        <span class="application-action-text">{{ message.applicationType }}を開く</span>
                      </button>
                    </div>
                    <div class="message-time" *ngIf="message.timestamp">
                      {{ message.timestamp | date:'HH:mm' }}
                    </div>
                  </div>
                </div>
                <div *ngIf="isChatLoading" class="chat-message assistant-message">
                  <div class="message-content">
                    <div class="message-role">AIアシスタント</div>
                    <div class="message-text loading">
                      <span class="loading-dot"></span>
                      <span class="loading-dot"></span>
                      <span class="loading-dot"></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- チャット入力エリア -->
              <div class="chat-input-container">
                <div class="chat-input-wrapper">
                  <textarea
                    [(ngModel)]="chatInputMessage"
                    (keydown)="onChatInputKeydown($event)"
                    placeholder="メッセージを入力してください（Enterで送信、Shift+Enterで改行）"
                    class="chat-input"
                    rows="2"
                    [disabled]="isChatLoading"
                  ></textarea>
                  <div class="chat-actions">
                    <button
                      (click)="sendChatMessage()"
                      [disabled]="!chatInputMessage.trim() || isChatLoading"
                      class="chat-send-button"
                    >
                      送信
                    </button>
                    <button
                      (click)="clearChat()"
                      [disabled]="chatMessages.length === 0"
                      class="chat-clear-button"
                    >
                      クリア
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- その他のページ -->
        <ng-container *ngIf="currentTab !== '情報照会' && currentTab !== '各種申請' && currentTab !== 'メインページ' && currentTab !== '保険・扶養' && currentTab !== 'パスワード変更' && currentTab !== 'ナレッジ'">
          <h2 class="page-title">{{ currentTab }}のページです</h2>
        </ng-container>
      </div>
    </main>
  </div>
</div>

<!-- 入社時申請モーダル -->
<div class="modal-overlay" *ngIf="showApplicationModal && currentApplicationType === '入社時申請'">
  <div class="modal-content" [class.form-disabled]="isSubmittingOnboardingApplication">
    <div class="modal-header">
      <h2 class="modal-title">入社時申請</h2>
      <button class="modal-close-button" (click)="closeApplicationModal()" [disabled]="isSubmittingOnboardingApplication" [title]="isSubmittingOnboardingApplication ? '申請中です。しばらくお待ちください。' : ''">×</button>
    </div>
    
    <div *ngIf="isSubmittingOnboardingApplication" class="loading-overlay">
      <div class="loading-spinner"></div>
      <p class="loading-message">申請を送信しています。しばらくお待ちください...</p>
    </div>
    
    <form [formGroup]="onboardingApplicationForm" (ngSubmit)="submitOnboardingApplication()" class="application-form">
      <!-- 基本情報欄 -->
      <section class="form-section">
        <h3 class="section-title">基本情報</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="onboarding-lastName">姓 <span class="required">*</span></label>
            <input 
              type="text" 
              id="onboarding-lastName" 
              formControlName="lastName" 
              class="form-input"
              [readonly]="true"
              style="background: #f5f5f5;"
            >
            <div *ngIf="onboardingApplicationForm.get('lastName')?.invalid && onboardingApplicationForm.get('lastName')?.touched" class="error-message">
              姓を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="onboarding-firstName">名 <span class="required">*</span></label>
            <input 
              type="text" 
              id="onboarding-firstName" 
              formControlName="firstName" 
              class="form-input"
              [readonly]="true"
              style="background: #f5f5f5;"
            >
            <div *ngIf="onboardingApplicationForm.get('firstName')?.invalid && onboardingApplicationForm.get('firstName')?.touched" class="error-message">
              名を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="onboarding-lastNameKana">姓（ヨミガナ） <span class="required">*</span></label>
            <input 
              type="text" 
              id="onboarding-lastNameKana" 
              formControlName="lastNameKana" 
              class="form-input"
              [readonly]="true"
              style="background: #f5f5f5;"
            >
            <div *ngIf="onboardingApplicationForm.get('lastNameKana')?.invalid && onboardingApplicationForm.get('lastNameKana')?.touched" class="error-message">
              <span *ngIf="onboardingApplicationForm.get('lastNameKana')?.errors?.['required']">
                姓（ヨミガナ）を入力してください
              </span>
              <span *ngIf="onboardingApplicationForm.get('lastNameKana')?.errors?.['katakana']">
                カタカナで入力してください
              </span>
            </div>
          </div>
          <div class="form-group">
            <label for="onboarding-firstNameKana">名（ヨミガナ） <span class="required">*</span></label>
            <input 
              type="text" 
              id="onboarding-firstNameKana" 
              formControlName="firstNameKana" 
              class="form-input"
              [readonly]="true"
              style="background: #f5f5f5;"
            >
            <div *ngIf="onboardingApplicationForm.get('firstNameKana')?.invalid && onboardingApplicationForm.get('firstNameKana')?.touched" class="error-message">
              <span *ngIf="onboardingApplicationForm.get('firstNameKana')?.errors?.['required']">
                名（ヨミガナ）を入力してください
              </span>
              <span *ngIf="onboardingApplicationForm.get('firstNameKana')?.errors?.['katakana']">
                カタカナで入力してください
              </span>
            </div>
          </div>
          <div class="form-group">
            <label for="onboarding-birthDate">生年月日 <span class="required">*</span></label>
            <input 
              type="date" 
              id="onboarding-birthDate" 
              formControlName="birthDate" 
              class="form-input"
            >
            <div *ngIf="onboardingApplicationForm.get('birthDate')?.invalid && onboardingApplicationForm.get('birthDate')?.touched" class="error-message">
              生年月日を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="onboarding-gender">戸籍上の性別 <span class="required">*</span></label>
            <select 
              id="onboarding-gender" 
              formControlName="gender" 
              class="form-input"
            >
              <option value="">選択してください</option>
              <option *ngFor="let g of genders" [value]="g">{{ g }}</option>
            </select>
            <div *ngIf="onboardingApplicationForm.get('gender')?.invalid && onboardingApplicationForm.get('gender')?.touched" class="error-message">
              性別を選択してください
            </div>
          </div>
          <div class="form-group">
            <label for="onboarding-email">メールアドレス <span class="required">*</span></label>
            <input 
              type="email" 
              id="onboarding-email" 
              formControlName="email" 
              class="form-input"
              [readonly]="true"
              style="background: #f5f5f5;"
            >
            <div *ngIf="onboardingApplicationForm.get('email')?.invalid && onboardingApplicationForm.get('email')?.touched" class="error-message">
              有効なメールアドレスを入力してください
            </div>
          </div>
          <div class="form-group full-width">
            <label for="onboarding-idDocument">本人確認書類添付</label>
            <input 
              type="file" 
              id="onboarding-idDocument" 
              class="form-input"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'idDocument')"
            >
            <div *ngIf="idDocumentFile" class="file-name">{{ idDocumentFile.name }}</div>
          </div>
        </div>
      </section>

      <!-- マイナンバー欄 -->
      <section class="form-section">
        <h3 class="section-title">マイナンバー（任意）</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <div class="my-number-container">
              <div class="my-number-inputs">
                <input 
                  type="text" 
                  id="onboarding-myNumberPart1" 
                  formControlName="myNumberPart1" 
                  class="form-input my-number-part"
                  maxlength="4"
                  placeholder="0000"
                  (input)="onMyNumberInput($event, 'myNumberPart1')"
                >
                <span class="my-number-separator">-</span>
                <input 
                  type="text" 
                  id="onboarding-myNumberPart2" 
                  formControlName="myNumberPart2" 
                  class="form-input my-number-part"
                  maxlength="4"
                  placeholder="0000"
                  (input)="onMyNumberInput($event, 'myNumberPart2')"
                >
                <span class="my-number-separator">-</span>
                <input 
                  type="text" 
                  id="onboarding-myNumberPart3" 
                  formControlName="myNumberPart3" 
                  class="form-input my-number-part"
                  maxlength="4"
                  placeholder="0000"
                  (input)="onMyNumberInput($event, 'myNumberPart3')"
                >
              </div>
            </div>
          </div>
          <div class="form-group full-width">
            <label for="onboardingMyNumberCard">マイナンバーカード添付</label>
            <input 
              type="file" 
              id="onboardingMyNumberCard" 
              class="form-input"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'myNumberCard')"
            >
            <div *ngIf="myNumberCardFile" class="file-name">{{ myNumberCardFile.name }}</div>
          </div>
        </div>
      </section>

      <!-- 現住所と連絡先欄 -->
      <section class="form-section">
        <h3 class="section-title">現住所と連絡先</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                formControlName="isOverseasResident"
                (change)="onOverseasResidentChange($event)"
              >
              海外に在住
            </label>
          </div>
          <div class="form-group" *ngIf="!onboardingApplicationForm.get('isOverseasResident')?.value">
            <label for="onboarding-postalCode">郵便番号 <span class="required">*</span></label>
            <input 
              type="text" 
              id="onboarding-postalCode" 
              formControlName="postalCode" 
              class="form-input"
              maxlength="7"
              (input)="formatPostalCode($event)"
              placeholder="1234567"
            >
            <div *ngIf="onboardingApplicationForm.get('postalCode')?.invalid && onboardingApplicationForm.get('postalCode')?.touched" class="error-message">
              <span *ngIf="onboardingApplicationForm.get('postalCode')?.errors?.['pattern']">
                7桁の数字を入力してください
              </span>
            </div>
          </div>
          <div class="form-group full-width" *ngIf="!onboardingApplicationForm.get('isOverseasResident')?.value">
            <label for="onboarding-currentAddress">現住所 <span class="required">*</span></label>
            <textarea 
              id="onboarding-currentAddress" 
              formControlName="currentAddress" 
              class="form-input" 
              rows="2"
            ></textarea>
            <div *ngIf="onboardingApplicationForm.get('currentAddress')?.invalid && onboardingApplicationForm.get('currentAddress')?.touched" class="error-message">
              現住所を入力してください
            </div>
          </div>
          <div class="form-group full-width" *ngIf="!onboardingApplicationForm.get('isOverseasResident')?.value">
            <label for="onboarding-currentAddressKana">現住所（ヨミガナ） <span class="required">*</span></label>
            <textarea 
              id="onboarding-currentAddressKana" 
              formControlName="currentAddressKana" 
              class="form-input" 
              rows="2"
            ></textarea>
            <div *ngIf="onboardingApplicationForm.get('currentAddressKana')?.invalid && onboardingApplicationForm.get('currentAddressKana')?.touched" class="error-message">
              <span *ngIf="onboardingApplicationForm.get('currentAddressKana')?.errors?.['required']">
                現住所（ヨミガナ）を入力してください
              </span>
              <span *ngIf="onboardingApplicationForm.get('currentAddressKana')?.errors?.['katakana']">
                カタカナで入力してください
              </span>
            </div>
          </div>
          <div class="form-group full-width" *ngIf="onboardingApplicationForm.get('isOverseasResident')?.value">
            <label for="onboarding-overseasAddress">住所 <span class="required">*</span></label>
            <textarea 
              id="onboarding-overseasAddress" 
              formControlName="overseasAddress" 
              class="form-input" 
              rows="2"
              placeholder="海外住所を入力してください"
            ></textarea>
            <div *ngIf="onboardingApplicationForm.get('overseasAddress')?.invalid && onboardingApplicationForm.get('overseasAddress')?.touched" class="error-message">
              住所を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="onboarding-phoneNumber">電話番号（ハイフンなし） <span class="required">*</span></label>
            <input 
              type="tel" 
              id="onboarding-phoneNumber" 
              formControlName="phoneNumber" 
              class="form-input"
              maxlength="11"
              (input)="formatPhoneNumber($event)"
            >
            <div *ngIf="onboardingApplicationForm.get('phoneNumber')?.invalid && onboardingApplicationForm.get('phoneNumber')?.touched" class="error-message">
              <span *ngIf="onboardingApplicationForm.get('phoneNumber')?.errors?.['required']">
                電話番号を入力してください
              </span>
              <span *ngIf="onboardingApplicationForm.get('phoneNumber')?.errors?.['pattern']">
                数字のみで入力してください（最大11桁）
              </span>
            </div>
          </div>
        </div>
      </section>

      <!-- 住民票住所欄 -->
      <section class="form-section">
        <h3 class="section-title">住民票住所</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                formControlName="skipResidentAddress"
                [disabled]="onboardingApplicationForm.get('isOverseasResident')?.value"
                (change)="onSkipResidentAddressChange($event)"
              >
              住民票住所を記載しない
            </label>
          </div>
          <div class="form-group full-width" *ngIf="onboardingApplicationForm.get('skipResidentAddress')?.value">
            <label for="onboarding-residentAddressSkipReason">理由 <span class="required">*</span></label>
            <select 
              id="onboarding-residentAddressSkipReason" 
              formControlName="residentAddressSkipReason" 
              class="form-input"
              (change)="onResidentAddressSkipReasonChange($event)"
            >
              <option value="">選択してください</option>
              <option value="海外在住">海外在住</option>
              <option value="短期留学">短期留学</option>
              <option value="その他">その他</option>
            </select>
            <div *ngIf="onboardingApplicationForm.get('residentAddressSkipReason')?.invalid && onboardingApplicationForm.get('residentAddressSkipReason')?.touched" class="error-message">
              理由を選択してください
            </div>
          </div>
          <div class="form-group full-width" *ngIf="onboardingApplicationForm.get('skipResidentAddress')?.value && onboardingApplicationForm.get('residentAddressSkipReason')?.value === 'その他'">
            <label for="onboarding-residentAddressSkipReasonOther">理由（その他） <span class="required">*</span></label>
            <input 
              type="text" 
              id="onboarding-residentAddressSkipReasonOther" 
              formControlName="residentAddressSkipReasonOther" 
              class="form-input"
              placeholder="理由を入力してください"
            >
            <div *ngIf="onboardingApplicationForm.get('residentAddressSkipReasonOther')?.invalid && onboardingApplicationForm.get('residentAddressSkipReasonOther')?.touched" class="error-message">
              理由を入力してください
            </div>
          </div>
          <div class="form-group full-width" *ngIf="!onboardingApplicationForm.get('skipResidentAddress')?.value">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                formControlName="sameAsCurrentAddress"
                (change)="onOnboardingSameAddressChange($event)"
              >
              住所（現住所と同じ）
            </label>
          </div>
          <div class="form-group" *ngIf="!onboardingApplicationForm.get('skipResidentAddress')?.value">
            <label for="onboarding-residentPostalCode">郵便番号 <span class="required">*</span></label>
            <input 
              type="text" 
              id="onboarding-residentPostalCode" 
              formControlName="residentPostalCode" 
              class="form-input"
              maxlength="7"
              (input)="formatResidentPostalCode($event)"
              placeholder="1234567"
              [readonly]="onboardingApplicationForm.get('sameAsCurrentAddress')?.value"
            >
            <div *ngIf="onboardingApplicationForm.get('residentPostalCode')?.invalid && onboardingApplicationForm.get('residentPostalCode')?.touched" class="error-message">
              <span *ngIf="onboardingApplicationForm.get('residentPostalCode')?.errors?.['required']">
                郵便番号を入力してください
              </span>
              <span *ngIf="onboardingApplicationForm.get('residentPostalCode')?.errors?.['pattern']">
                7桁の数字を入力してください
              </span>
            </div>
          </div>
          <div class="form-group full-width" *ngIf="!onboardingApplicationForm.get('skipResidentAddress')?.value">
            <label for="onboarding-residentAddress">住所 <span class="required">*</span></label>
            <textarea 
              id="onboarding-residentAddress" 
              formControlName="residentAddress" 
              class="form-input" 
              rows="2"
              [readonly]="onboardingApplicationForm.get('sameAsCurrentAddress')?.value"
            ></textarea>
            <div *ngIf="onboardingApplicationForm.get('residentAddress')?.invalid && onboardingApplicationForm.get('residentAddress')?.touched" class="error-message">
              住所を入力してください
            </div>
          </div>
          <div class="form-group full-width" *ngIf="!onboardingApplicationForm.get('skipResidentAddress')?.value">
            <label for="onboarding-residentAddressKana">住所（ヨミガナ） <span class="required">*</span></label>
            <textarea 
              id="onboarding-residentAddressKana" 
              formControlName="residentAddressKana" 
              class="form-input" 
              rows="2"
              [readonly]="onboardingApplicationForm.get('sameAsCurrentAddress')?.value"
            ></textarea>
            <div *ngIf="onboardingApplicationForm.get('residentAddressKana')?.invalid && onboardingApplicationForm.get('residentAddressKana')?.touched" class="error-message">
              <span *ngIf="onboardingApplicationForm.get('residentAddressKana')?.errors?.['required']">
                住所（ヨミガナ）を入力してください
              </span>
              <span *ngIf="onboardingApplicationForm.get('residentAddressKana')?.errors?.['katakana']">
                カタカナで入力してください
              </span>
            </div>
          </div>
        </div>
      </section>

      <!-- 履歴書・職務経歴書欄 -->
      <section class="form-section">
        <h3 class="section-title">履歴書・職務経歴書</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="onboarding-resume">履歴書添付</label>
            <input 
              type="file" 
              id="onboarding-resume" 
              class="form-input"
              accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'onboardingResume')"
            >
            <div *ngIf="resumeFile" class="file-name">{{ resumeFile.name }}</div>
          </div>
          <div class="form-group full-width">
            <label for="onboarding-careerHistory">職務経歴書添付</label>
            <input 
              type="file" 
              id="onboarding-careerHistory" 
              class="form-input"
              accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'onboardingCareerHistory')"
            >
            <div *ngIf="careerHistoryFile" class="file-name">{{ careerHistoryFile.name }}</div>
          </div>
        </div>
      </section>

      <!-- 緊急連絡先欄 -->
      <section class="form-section">
        <h3 class="section-title">緊急連絡先</h3>
        <div formGroupName="emergencyContact" class="nested-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="onboarding-emergencyName">氏名</label>
              <input 
                type="text" 
                id="onboarding-emergencyName" 
                formControlName="name" 
                class="form-input"
              >
            </div>
            <div class="form-group">
              <label for="onboarding-emergencyNameKana">氏名（ヨミガナ）</label>
              <input 
                type="text" 
                id="onboarding-emergencyNameKana" 
                formControlName="nameKana" 
                class="form-input"
              >
              <div *ngIf="onboardingApplicationForm.get('emergencyContact.nameKana')?.invalid && onboardingApplicationForm.get('emergencyContact.nameKana')?.touched" class="error-message">
                <span *ngIf="onboardingApplicationForm.get('emergencyContact.nameKana')?.errors?.['katakana']">
                  カタカナで入力してください
                </span>
              </div>
            </div>
            <div class="form-group">
              <label for="onboarding-emergencyRelationship">続柄</label>
              <input 
                type="text" 
                id="onboarding-emergencyRelationship" 
                formControlName="relationship" 
                class="form-input"
              >
            </div>
            <div class="form-group">
              <label for="onboarding-emergencyPhone">緊急連絡先電話番号</label>
              <input 
                type="tel" 
                id="onboarding-emergencyPhone" 
                formControlName="phone" 
                class="form-input"
                maxlength="11"
                (input)="formatEmergencyPhoneNumber($event)"
              >
              <div *ngIf="onboardingApplicationForm.get('emergencyContact.phone')?.invalid && onboardingApplicationForm.get('emergencyContact.phone')?.touched" class="error-message">
                <span *ngIf="onboardingApplicationForm.get('emergencyContact.phone')?.errors?.['pattern']">
                  数字のみで入力してください（最大11桁）
                </span>
              </div>
            </div>
          </div>
        </div>
        <div formGroupName="emergencyContact" class="nested-form">
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="onboarding-emergencyAddress">住所</label>
              <label class="checkbox-label" style="display: block; margin-bottom: 0.5rem;">
                <input 
                  type="checkbox" 
                  formControlName="sameAsCurrentAddressForEmergency"
                  (change)="onSameAsCurrentAddressForEmergencyChange($event)"
                >
                現住所と同じ
              </label>
              <textarea 
                id="onboarding-emergencyAddress" 
                formControlName="address" 
                class="form-input" 
                rows="2"
              ></textarea>
            </div>
            <div class="form-group full-width" *ngIf="!onboardingApplicationForm.get('isOverseasResident')?.value || !onboardingApplicationForm.get('sameAsCurrentAddressForEmergency')?.value">
              <label for="onboarding-emergencyAddressKana">住所（ヨミガナ）</label>
              <textarea 
                id="onboarding-emergencyAddressKana" 
                formControlName="addressKana" 
                class="form-input" 
                rows="2"
              ></textarea>
              <div *ngIf="onboardingApplicationForm.get('emergencyContact.addressKana')?.invalid && onboardingApplicationForm.get('emergencyContact.addressKana')?.touched" class="error-message">
                <span *ngIf="onboardingApplicationForm.get('emergencyContact.addressKana')?.errors?.['katakana']">
                  カタカナで入力してください
                </span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 口座情報欄 -->
      <section class="form-section">
        <h3 class="section-title">口座情報</h3>
        <div formGroupName="bankAccount" class="nested-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="onboarding-bankName">銀行名</label>
              <input 
                type="text" 
                id="onboarding-bankName" 
                formControlName="bankName" 
                class="form-input"
              >
            </div>
            <div class="form-group">
              <label for="onboarding-accountType">預金種別</label>
              <select 
                id="onboarding-accountType" 
                formControlName="accountType" 
                class="form-input"
              >
                <option value="">選択してください</option>
                <option value="普通">普通</option>
                <option value="当座">当座</option>
                <option value="貯蓄">貯蓄</option>
              </select>
            </div>
            <div class="form-group">
              <label for="onboarding-accountHolder">名義（カタカナ）</label>
              <input 
                type="text" 
                id="onboarding-accountHolder" 
                formControlName="accountHolder" 
                class="form-input"
              >
              <div *ngIf="onboardingApplicationForm.get('bankAccount.accountHolder')?.invalid && onboardingApplicationForm.get('bankAccount.accountHolder')?.touched" class="error-message">
                <span *ngIf="onboardingApplicationForm.get('bankAccount.accountHolder')?.errors?.['katakana']">
                  カタカナで入力してください
                </span>
              </div>
            </div>
            <div class="form-group">
              <label for="onboarding-branchName">支店名</label>
              <input 
                type="text" 
                id="onboarding-branchName" 
                formControlName="branchName" 
                class="form-input"
              >
            </div>
            <div class="form-group">
              <label for="onboarding-accountNumber">口座番号</label>
              <input 
                type="text" 
                id="onboarding-accountNumber" 
                formControlName="accountNumber" 
                class="form-input"
                (input)="formatAccountNumber($event)"
              >
            </div>
          </div>
        </div>
      </section>

      <!-- 社会保険欄（基礎年金番号、厚生年金加入履歴のみ） -->
      <section class="form-section">
        <h3 class="section-title">社会保険</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="onboarding-basicPensionNumberPart1">基礎年金番号 <span class="required">*</span></label>
            <div class="basic-pension-number-container">
              <input 
                type="text" 
                id="onboarding-basicPensionNumberPart1" 
                formControlName="basicPensionNumberPart1" 
                class="form-input basic-pension-part"
                maxlength="4"
                placeholder="0000"
                (input)="formatOnboardingBasicPensionNumberInput($event, 1)"
              >
              <span class="basic-pension-separator">-</span>
              <input 
                type="text" 
                id="onboarding-basicPensionNumberPart2" 
                formControlName="basicPensionNumberPart2" 
                class="form-input basic-pension-part"
                maxlength="6"
                placeholder="000000"
                (input)="formatOnboardingBasicPensionNumberInput($event, 2)"
              >
            </div>
            <div *ngIf="(onboardingApplicationForm.get('basicPensionNumberPart1')?.invalid || onboardingApplicationForm.get('basicPensionNumberPart2')?.invalid) && (onboardingApplicationForm.get('basicPensionNumberPart1')?.touched || onboardingApplicationForm.get('basicPensionNumberPart2')?.touched)" class="error-message">
              <span *ngIf="onboardingApplicationForm.get('basicPensionNumberPart1')?.errors?.['required'] || onboardingApplicationForm.get('basicPensionNumberPart2')?.errors?.['required']">
                基礎年金番号を入力してください
              </span>
              <span *ngIf="onboardingApplicationForm.get('basicPensionNumberPart1')?.errors?.['pattern'] || onboardingApplicationForm.get('basicPensionNumberPart2')?.errors?.['pattern']">
                半角数字のみで入力してください
              </span>
            </div>
          </div>
          <div class="form-group">
            <label for="onboarding-pensionHistoryStatus">厚生年金加入履歴 <span class="required">*</span></label>
            <select 
              id="onboarding-pensionHistoryStatus" 
              formControlName="pensionHistoryStatus" 
              class="form-input" 
              (change)="onPensionHistoryChange($event)"
            >
              <option value="">選択してください</option>
              <option *ngFor="let option of pensionHistoryOptions" [value]="option">{{ option }}</option>
            </select>
            <div *ngIf="onboardingApplicationForm.get('pensionHistoryStatus')?.invalid && onboardingApplicationForm.get('pensionHistoryStatus')?.touched" class="error-message">
              厚生年金加入履歴を選択してください
            </div>
          </div>
          <div class="form-group full-width">
            <label for="onboarding-basicPensionNumberDoc">基礎年金番号確認書類添付</label>
            <input 
              type="file" 
              id="onboarding-basicPensionNumberDoc" 
              class="form-input"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'basicPensionNumberDoc')"
            >
            <div *ngIf="basicPensionNumberDocFile" class="file-name">{{ basicPensionNumberDocFile.name }}</div>
          </div>
          <div class="form-group full-width" *ngIf="hasPensionHistory">
            <label for="onboarding-pensionHistory">厚生年金加入履歴（詳細）</label>
            <textarea 
              id="onboarding-pensionHistory" 
              formControlName="pensionHistory" 
              class="form-input" 
              rows="4"
            ></textarea>
          </div>
        </div>
      </section>

      <!-- 扶養者有無欄 -->
      <section class="form-section">
        <h3 class="section-title">扶養者有無</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="onboarding-dependentStatus">被扶養者 <span class="required">*</span></label>
            <select 
              id="onboarding-dependentStatus" 
              formControlName="dependentStatus" 
              class="form-input"
            >
              <option value="">選択してください</option>
              <option value="有">有</option>
              <option value="無">無</option>
            </select>
            <div *ngIf="onboardingApplicationForm.get('dependentStatus')?.invalid && onboardingApplicationForm.get('dependentStatus')?.touched" class="error-message">
              被扶養者を選択してください
            </div>
          </div>
        </div>
      </section>

      <!-- 資格確認書発行要否欄 -->
      <section class="form-section">
        <h3 class="section-title">資格確認書発行要否</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>資格確認書発行要否 <span class="required">*</span></label>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  formControlName="qualificationCertificateRequired" 
                  value="必要"
                  name="qualificationCertificateRequired"
                >
                必要
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  formControlName="qualificationCertificateRequired" 
                  value="不要"
                  name="qualificationCertificateRequired"
                >
                不要
              </label>
            </div>
            <div *ngIf="onboardingApplicationForm.get('qualificationCertificateRequired')?.invalid && onboardingApplicationForm.get('qualificationCertificateRequired')?.touched" class="error-message">
              資格確認書発行要否を選択してください
            </div>
          </div>
        </div>
      </section>

      <!-- 年金基金加入欄 -->
      <section class="form-section">
        <h3 class="section-title">年金基金加入</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>年金基金に加入しているか <span class="required">*</span></label>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  formControlName="pensionFundMembership" 
                  value="はい"
                  name="pensionFundMembership"
                >
                はい
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  formControlName="pensionFundMembership" 
                  value="いいえ"
                  name="pensionFundMembership"
                >
                いいえ
              </label>
            </div>
            <div *ngIf="onboardingApplicationForm.get('pensionFundMembership')?.invalid && onboardingApplicationForm.get('pensionFundMembership')?.touched" class="error-message">
              年金基金に加入しているかを選択してください
            </div>
          </div>
        </div>
      </section>

      <!-- 送信ボタン -->
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="closeApplicationModal()" [disabled]="isSubmittingOnboardingApplication">キャンセル</button>
        <button type="submit" class="submit-button" [disabled]="onboardingApplicationForm.invalid || isSubmittingOnboardingApplication">
          {{ isSubmittingOnboardingApplication ? '申請中...' : '申請' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- 扶養家族追加申請モーダル -->
<div class="modal-overlay" *ngIf="showApplicationModal && currentApplicationType === '扶養家族追加'">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">扶養家族追加申請</h2>
      <button class="modal-close-button" (click)="closeApplicationModal()">×</button>
    </div>
    
    <form [formGroup]="dependentApplicationForm" (ngSubmit)="submitDependentApplication()" class="application-form">
      <!-- 続柄欄 -->
      <section class="form-section">
        <h3 class="section-title">続柄 <span class="required">*</span></h3>
        <div class="form-group">
          <label class="radio-label">
            <input type="radio" formControlName="relationshipType" value="配偶者" (change)="onRelationshipTypeChange()">
            配偶者
          </label>
          <label class="radio-label">
            <input type="radio" formControlName="relationshipType" value="配偶者以外" (change)="onRelationshipTypeChange()">
            配偶者以外
          </label>
        </div>
        <div *ngIf="dependentApplicationForm.get('relationshipType')?.invalid && dependentApplicationForm.get('relationshipType')?.touched" class="error-message">
          続柄を選択してください
        </div>
        
        <!-- 配偶者選択時 -->
        <div *ngIf="dependentApplicationForm.get('relationshipType')?.value === '配偶者'" class="form-group">
          <label for="spouseType">配偶者の種別 <span class="required">*</span></label>
          <select 
            id="spouseType" 
            formControlName="spouseType" 
            class="form-input"
            (change)="onSpouseTypeChange()"
          >
            <option value="">選択してください</option>
            <option value="妻">妻</option>
            <option value="夫">夫</option>
          </select>
        </div>
        <div *ngIf="dependentApplicationForm.get('relationshipType')?.value === '配偶者' && dependentApplicationForm.get('spouseType')?.invalid && dependentApplicationForm.get('spouseType')?.touched" class="error-message">
          妻または夫を選択してください
        </div>
        
        <!-- 配偶者以外選択時 -->
        <div *ngIf="dependentApplicationForm.get('relationshipType')?.value === '配偶者以外'" class="form-group">
          <label for="relationship">続柄 <span class="required">*</span></label>
          <input type="text" id="relationship" formControlName="relationship" class="form-input" placeholder="例: 長男、長女">
        </div>
      </section>
      
      <!-- 基礎年金番号 -->
      <section class="form-section">
        <h3 class="section-title">基礎年金番号</h3>
        <div class="form-group">
          <label>基礎年金番号 <span class="required">*</span></label>
          <div class="basic-pension-number-container">
            <input 
              type="text" 
              id="dependentBasicPensionNumberPart1" 
              formControlName="basicPensionNumberPart1" 
              class="form-input basic-pension-part"
              maxlength="4"
              (input)="formatDependentBasicPensionNumberInput($event, 1)"
              placeholder="0000"
              aria-label="基礎年金番号（前半4桁）"
            >
            <span class="basic-pension-separator">-</span>
            <input 
              type="text" 
              id="dependentBasicPensionNumberPart2" 
              formControlName="basicPensionNumberPart2" 
              class="form-input basic-pension-part"
              maxlength="6"
              (input)="formatDependentBasicPensionNumberInput($event, 2)"
              placeholder="000000"
              aria-label="基礎年金番号（後半6桁）"
            >
          </div>
          <div *ngIf="(dependentApplicationForm.get('basicPensionNumberPart1')?.invalid || dependentApplicationForm.get('basicPensionNumberPart2')?.invalid) && (dependentApplicationForm.get('basicPensionNumberPart1')?.touched || dependentApplicationForm.get('basicPensionNumberPart2')?.touched)" class="error-message">
            基礎年金番号を入力してください
          </div>
        </div>
        <div class="form-group">
          <label for="dependentBasicPensionNumberDoc">基礎年金番号確認書類添付</label>
          <input 
            type="file" 
            id="dependentBasicPensionNumberDoc" 
            class="form-input"
            accept=".pdf,.jpg,.jpeg,.png"
            (change)="onDependentFileSelected($event, 'basicPensionNumberDoc')"
          >
          <div *ngIf="dependentBasicPensionNumberDocFile" class="file-name">{{ dependentBasicPensionNumberDocFile.name }}</div>
        </div>
      </section>
      
      <!-- 基本情報 -->
      <section class="form-section">
        <h3 class="section-title">基本情報</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="dependentLastName">姓 <span class="required">*</span></label>
            <input type="text" id="dependentLastName" formControlName="lastName" class="form-input">
          </div>
          <div class="form-group">
            <label for="dependentFirstName">名 <span class="required">*</span></label>
            <input type="text" id="dependentFirstName" formControlName="firstName" class="form-input">
          </div>
          <div class="form-group">
            <label for="dependentLastNameKana">姓（ヨミガナ）</label>
            <input type="text" id="dependentLastNameKana" formControlName="lastNameKana" class="form-input">
          </div>
          <div class="form-group">
            <label for="dependentFirstNameKana">名（ヨミガナ）</label>
            <input type="text" id="dependentFirstNameKana" formControlName="firstNameKana" class="form-input">
          </div>
          <div class="form-group">
            <label for="dependentBirthDate">生年月日 <span class="required">*</span></label>
            <input type="date" id="dependentBirthDate" formControlName="birthDate" class="form-input">
          </div>
          <div class="form-group">
            <label for="dependentGender">性別 <span class="required">*</span></label>
            <select id="dependentGender" formControlName="gender" class="form-input">
              <option value="">選択してください</option>
              <option value="男性">男性</option>
              <option value="女性">女性</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dependentPhoneNumber">電話番号</label>
            <input 
              type="tel" 
              id="dependentPhoneNumber" 
              formControlName="phoneNumber" 
              class="form-input"
              maxlength="11"
              pattern="[a-zA-Z0-9]*"
              (input)="formatDependentPhoneNumber($event)"
            >
          </div>
          <div class="form-group">
            <label for="dependentOccupation">職業</label>
            <input type="text" id="dependentOccupation" formControlName="occupation" class="form-input">
          </div>
          <div class="form-group full-width">
            <label for="dependentIdentityDoc">身元確認書類添付</label>
            <input 
              type="file" 
              id="dependentIdentityDoc" 
              class="form-input"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onDependentFileSelected($event, 'identityDoc')"
            >
            <div *ngIf="dependentIdentityDocFile" class="file-name">{{ dependentIdentityDocFile.name }}</div>
          </div>
        </div>
      </section>
      
      <!-- 収入情報 -->
      <section class="form-section">
        <h3 class="section-title">収入情報</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="dependentAnnualIncome">扶養追加日からの年間収入見込み額</label>
            <input type="number" id="dependentAnnualIncome" formControlName="annualIncome" class="form-input" placeholder="円">
          </div>
          <div class="form-group">
            <label for="dependentMonthlyIncome">扶養追加日からの月額収入見込み額</label>
            <input type="number" id="dependentMonthlyIncome" formControlName="monthlyIncome" class="form-input" placeholder="円">
          </div>
          <div class="form-group">
            <label for="dependentStartDate">社会保険の扶養者となった日 <span class="required">*</span></label>
            <input type="date" id="dependentStartDate" formControlName="dependentStartDate" class="form-input">
          </div>
          <div class="form-group full-width">
            <label for="dependentReason">扶養に追加された理由</label>
            <textarea id="dependentReason" formControlName="dependentReason" class="form-input" rows="3"></textarea>
          </div>
        </div>
      </section>
      
      <!-- マイナンバー -->
      <section class="form-section">
        <h3 class="section-title">マイナンバー</h3>
        <div class="form-group">
          <label>マイナンバーの提供 <span class="required">*</span></label>
          <div>
            <label class="radio-label">
              <input type="radio" formControlName="provideMyNumber" value="提供する" (change)="onProvideMyNumberChange()">
              提供する
            </label>
            <label class="radio-label">
              <input type="radio" formControlName="provideMyNumber" value="提供しない" (change)="onProvideMyNumberChange()">
              提供しない
            </label>
          </div>
          <div *ngIf="dependentApplicationForm.get('provideMyNumber')?.invalid && dependentApplicationForm.get('provideMyNumber')?.touched" class="error-message">
            マイナンバーの提供を選択してください
          </div>
        </div>
        
        <!-- マイナンバー提供する場合 -->
        <div *ngIf="dependentApplicationForm.get('provideMyNumber')?.value === '提供する'">
          <div class="form-group">
            <label>マイナンバー <span class="required">*</span></label>
            <div class="my-number-container">
              <div class="my-number-inputs">
                <input 
                  type="text" 
                  id="dependentMyNumberPart1" 
                  formControlName="myNumberPart1" 
                  class="form-input my-number-part"
                  maxlength="4"
                  (input)="formatDependentMyNumberInput($event, 1)"
                  placeholder="0000"
                  aria-label="マイナンバー（前半4桁）"
                >
                <span class="my-number-separator">-</span>
                <input 
                  type="text" 
                  id="dependentMyNumberPart2" 
                  formControlName="myNumberPart2" 
                  class="form-input my-number-part"
                  maxlength="4"
                  (input)="formatDependentMyNumberInput($event, 2)"
                  placeholder="0000"
                  aria-label="マイナンバー（中盤4桁）"
                >
                <span class="my-number-separator">-</span>
                <input 
                  type="text" 
                  id="dependentMyNumberPart3" 
                  formControlName="myNumberPart3" 
                  class="form-input my-number-part"
                  maxlength="4"
                  (input)="formatDependentMyNumberInput($event, 3)"
                  placeholder="0000"
                  aria-label="マイナンバー（後半4桁）"
                >
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="dependentMyNumberDoc">番号確認書類添付</label>
            <input 
              type="file" 
              id="dependentMyNumberDoc" 
              class="form-input"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onDependentFileSelected($event, 'myNumberDoc')"
            >
            <div *ngIf="dependentMyNumberDocFile" class="file-name">{{ dependentMyNumberDocFile.name }}</div>
          </div>
        </div>
        
        <!-- マイナンバー提供しない場合 -->
        <div *ngIf="dependentApplicationForm.get('provideMyNumber')?.value === '提供しない'" class="form-group">
          <label for="dependentMyNumberNotProvidedReason">未提供理由 <span class="required">*</span></label>
          <textarea id="dependentMyNumberNotProvidedReason" formControlName="myNumberNotProvidedReason" class="form-input" rows="3"></textarea>
        </div>
      </section>
      
      <!-- 障がい者情報 -->
      <section class="form-section">
        <h3 class="section-title">障がい者情報</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="dependentDisabilityCategory">障がい者区分</label>
            <input type="text" id="dependentDisabilityCategory" formControlName="disabilityCategory" class="form-input">
          </div>
          <div class="form-group">
            <label for="dependentDisabilityCardType">障がい者手帳の種類</label>
            <input type="text" id="dependentDisabilityCardType" formControlName="disabilityCardType" class="form-input">
          </div>
          <div class="form-group">
            <label for="dependentDisabilityCardIssueDate">障がい者手帳の交付年月日</label>
            <input type="date" id="dependentDisabilityCardIssueDate" formControlName="disabilityCardIssueDate" class="form-input">
          </div>
          <div class="form-group full-width">
            <label for="dependentDisabilityCard">障がい者手帳の画像添付</label>
            <input 
              type="file" 
              id="dependentDisabilityCard" 
              class="form-input"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onDependentFileSelected($event, 'disabilityCard')"
            >
            <div *ngIf="dependentDisabilityCardFile" class="file-name">{{ dependentDisabilityCardFile.name }}</div>
          </div>
        </div>
      </section>
      
      <!-- 住所情報 -->
      <section class="form-section">
        <h3 class="section-title">住所情報 <span class="required">*</span></h3>
        <div class="form-group">
          <label class="radio-label">
            <input type="radio" formControlName="livingTogether" value="同居" (change)="onLivingTogetherChange()">
            同居
          </label>
          <label class="radio-label">
            <input type="radio" formControlName="livingTogether" value="別居" (change)="onLivingTogetherChange()">
            別居
          </label>
        </div>
        <div *ngIf="dependentApplicationForm.get('livingTogether')?.invalid && dependentApplicationForm.get('livingTogether')?.touched" class="error-message">
          同居/別居を選択してください
        </div>
        
        <!-- 別居の場合 -->
        <div *ngIf="dependentApplicationForm.get('livingTogether')?.value === '別居'" class="form-grid">
          <div class="form-group">
            <label for="dependentPostalCode">郵便番号 <span class="required">*</span></label>
            <input 
              type="text" 
              id="dependentPostalCode" 
              formControlName="postalCode" 
              class="form-input" 
              placeholder="例: 1234567"
              maxlength="7"
              pattern="[a-zA-Z0-9]*"
              (input)="formatDependentPostalCode($event)"
            >
          </div>
          <div class="form-group full-width">
            <label for="dependentAddress">住所 <span class="required">*</span></label>
            <textarea id="dependentAddress" formControlName="address" class="form-input" rows="2"></textarea>
          </div>
          <div class="form-group full-width">
            <label for="dependentAddressKana">住所（ヨミガナ）</label>
            <textarea id="dependentAddressKana" formControlName="addressKana" class="form-input" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label for="dependentAddressChangeDate">住所変更年月日</label>
            <input type="date" id="dependentAddressChangeDate" formControlName="addressChangeDate" class="form-input">
          </div>
        </div>
      </section>
      
      <!-- 送信ボタン -->
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="closeApplicationModal()">キャンセル</button>
        <button type="submit" class="submit-button" [disabled]="dependentApplicationForm.invalid">申請</button>
      </div>
    </form>
  </div>
</div>

<!-- 扶養削除申請モーダル -->
<div class="modal-overlay" *ngIf="showApplicationModal && currentApplicationType === '扶養削除申請'">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">扶養削除申請</h2>
      <button class="modal-close-button" (click)="closeApplicationModal()">×</button>
    </div>
    
    <form [formGroup]="dependentRemovalForm" (ngSubmit)="submitDependentRemovalApplication()" class="application-form">
      <!-- 被扶養者移動日 -->
      <section class="form-section">
        <h3 class="section-title">被扶養者移動日</h3>
        <div class="form-group">
          <label for="removalDate">被扶養者移動日 <span class="required">*</span></label>
          <input 
            type="date" 
            id="removalDate" 
            formControlName="removalDate" 
            class="form-input"
          >
          <div *ngIf="dependentRemovalForm.get('removalDate')?.invalid && dependentRemovalForm.get('removalDate')?.touched" class="error-message">
            被扶養者移動日を入力してください
          </div>
        </div>
      </section>
      
      <!-- 被扶養者情報 -->
      <section class="form-section">
        <h3 class="section-title">被扶養者情報</h3>
        <div class="form-group">
          <label for="dependentId">被扶養者 <span class="required">*</span></label>
          <select 
            id="dependentId" 
            formControlName="dependentId" 
            class="form-input"
          >
            <option value="">選択してください</option>
            <option *ngFor="let dependent of dependentsData; let i = index" [value]="i">
              {{ dependent.name || '（氏名未設定）' }} 
              <span *ngIf="dependent.relationship">（{{ dependent.relationship }}）</span>
            </option>
          </select>
          <div *ngIf="dependentRemovalForm.get('dependentId')?.invalid && dependentRemovalForm.get('dependentId')?.touched" class="error-message">
            被扶養者を選択してください
          </div>
          <div *ngIf="dependentsData.length === 0" class="info-message">
            登録されている扶養者がいません。
          </div>
        </div>
      </section>
      
      <!-- 扶養削除の理由 -->
      <section class="form-section">
        <h3 class="section-title">扶養削除の理由</h3>
        <div class="form-group">
          <label for="removalReason">扶養削除の理由 <span class="required">*</span></label>
          <textarea 
            id="removalReason" 
            formControlName="removalReason" 
            class="form-input"
            rows="4"
            placeholder="扶養削除の理由を入力してください"
          ></textarea>
          <div *ngIf="dependentRemovalForm.get('removalReason')?.invalid && dependentRemovalForm.get('removalReason')?.touched" class="error-message">
            扶養削除の理由を入力してください
          </div>
        </div>
      </section>
      
      <!-- 送信ボタン -->
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="closeApplicationModal()">キャンセル</button>
        <button type="submit" class="submit-button" [disabled]="dependentRemovalForm.invalid || dependentsData.length === 0">
          申請
        </button>
      </div>
    </form>
  </div>
</div>

<!-- 住所変更申請モーダル -->
<div class="modal-overlay" *ngIf="showApplicationModal && currentApplicationType === '住所変更申請'">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">住所変更申請</h2>
      <button class="modal-close-button" (click)="closeApplicationModal()">×</button>
    </div>
    
    <form [formGroup]="addressChangeForm" (ngSubmit)="submitAddressChangeApplication()" class="application-form">
      <!-- 引っ越しした日 -->
      <section class="form-section">
        <h3 class="section-title">引っ越しした日</h3>
        <div class="form-group">
          <label for="moveDate">引っ越しした日 <span class="required">*</span></label>
          <input 
            type="date" 
            id="moveDate" 
            formControlName="moveDate" 
            class="form-input"
          >
          <div *ngIf="addressChangeForm.get('moveDate')?.invalid && addressChangeForm.get('moveDate')?.touched" class="error-message">
            引っ越しした日を入力してください
          </div>
        </div>
      </section>
      
      <!-- 新しい住所欄 -->
      <section class="form-section">
        <h3 class="section-title">新しい住所</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="newPostalCode">郵便番号 <span class="required">*</span></label>
            <input 
              type="text" 
              id="newPostalCode" 
              formControlName="newPostalCode" 
              class="form-input"
              placeholder="1234567"
              maxlength="7"
              pattern="[0-9]{7}"
              (input)="formatAddressPostalCode($event)"
            >
            <div *ngIf="addressChangeForm.get('newPostalCode')?.invalid && addressChangeForm.get('newPostalCode')?.touched" class="error-message">
              <span *ngIf="addressChangeForm.get('newPostalCode')?.errors?.['required']">
                郵便番号を入力してください
              </span>
              <span *ngIf="addressChangeForm.get('newPostalCode')?.errors?.['pattern']">
                7桁の数字を入力してください
              </span>
            </div>
          </div>
          <div class="form-group full-width">
            <label for="newAddress">住所 <span class="required">*</span></label>
            <textarea 
              id="newAddress" 
              formControlName="newAddress" 
              class="form-input"
              rows="2"
            ></textarea>
            <div *ngIf="addressChangeForm.get('newAddress')?.invalid && addressChangeForm.get('newAddress')?.touched" class="error-message">
              住所を入力してください
            </div>
          </div>
          <div class="form-group full-width">
            <label for="newAddressKana">住所（ヨミガナ）</label>
            <textarea 
              id="newAddressKana" 
              formControlName="newAddressKana" 
              class="form-input"
              rows="2"
            ></textarea>
          </div>
        </div>
      </section>
      
      <!-- 新しい住民票住所欄 -->
      <section class="form-section">
        <h3 class="section-title">新しい住民票住所</h3>
        <div class="form-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [checked]="sameAsOldAddress"
              (change)="onSameAsOldAddressChange($event)"
            >
            変更前住所と同じ
          </label>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [checked]="sameAsNewAddress"
              (change)="onSameAsNewAddressChange($event)"
            >
            変更後の住所と同じ
          </label>
        </div>
        <div class="form-grid" *ngIf="!sameAsOldAddress && !sameAsNewAddress">
          <div class="form-group">
            <label for="residentPostalCode">郵便番号</label>
            <input 
              type="text" 
              id="residentPostalCode" 
              formControlName="residentPostalCode" 
              class="form-input"
              placeholder="1234567"
              maxlength="7"
              pattern="[0-9]{7}"
              (input)="formatResidentPostalCodeForAddressChange($event)"
            >
          </div>
          <div class="form-group full-width">
            <label for="residentAddress">住所</label>
            <textarea 
              id="residentAddress" 
              formControlName="residentAddress" 
              class="form-input"
              rows="2"
            ></textarea>
          </div>
          <div class="form-group full-width">
            <label for="residentAddressKana">住所（ヨミガナ）</label>
            <textarea 
              id="residentAddressKana" 
              formControlName="residentAddressKana" 
              class="form-input"
              rows="2"
            ></textarea>
          </div>
        </div>
      </section>
      
      <!-- 送信ボタン -->
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="closeApplicationModal()">キャンセル</button>
        <button type="submit" class="submit-button" [disabled]="addressChangeForm.invalid">
          申請
        </button>
      </div>
    </form>
  </div>
</div>

<!-- 氏名変更申請モーダル -->
<div class="modal-overlay" *ngIf="showApplicationModal && currentApplicationType === '氏名変更申請'">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">氏名変更申請</h2>
      <button class="modal-close-button" (click)="closeApplicationModal()">×</button>
    </div>
    
    <form [formGroup]="nameChangeForm" (ngSubmit)="submitNameChangeApplication()" class="application-form">
      <!-- 氏名変更した日 -->
      <section class="form-section">
        <h3 class="section-title">氏名変更した日</h3>
        <div class="form-group">
          <label for="changeDate">氏名変更した日 <span class="required">*</span></label>
          <input 
            type="date" 
            id="changeDate" 
            formControlName="changeDate" 
            class="form-input"
          >
          <div *ngIf="nameChangeForm.get('changeDate')?.invalid && nameChangeForm.get('changeDate')?.touched" class="error-message">
            氏名変更した日を入力してください
          </div>
        </div>
      </section>
      
      <!-- 新しい氏名欄 -->
      <section class="form-section">
        <h3 class="section-title">新しい氏名</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="newLastName">姓 <span class="required">*</span></label>
            <input 
              type="text" 
              id="newLastName" 
              formControlName="newLastName" 
              class="form-input"
            >
            <div *ngIf="nameChangeForm.get('newLastName')?.invalid && nameChangeForm.get('newLastName')?.touched" class="error-message">
              姓を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="newFirstName">名 <span class="required">*</span></label>
            <input 
              type="text" 
              id="newFirstName" 
              formControlName="newFirstName" 
              class="form-input"
            >
            <div *ngIf="nameChangeForm.get('newFirstName')?.invalid && nameChangeForm.get('newFirstName')?.touched" class="error-message">
              名を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="newLastNameKana">姓（ヨミガナ） <span class="required">*</span></label>
            <input 
              type="text" 
              id="newLastNameKana" 
              formControlName="newLastNameKana" 
              class="form-input"
            >
            <div *ngIf="nameChangeForm.get('newLastNameKana')?.invalid && nameChangeForm.get('newLastNameKana')?.touched" class="error-message">
              姓（ヨミガナ）を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="newFirstNameKana">名（ヨミガナ） <span class="required">*</span></label>
            <input 
              type="text" 
              id="newFirstNameKana" 
              formControlName="newFirstNameKana" 
              class="form-input"
            >
            <div *ngIf="nameChangeForm.get('newFirstNameKana')?.invalid && nameChangeForm.get('newFirstNameKana')?.touched" class="error-message">
              名（ヨミガナ）を入力してください
            </div>
          </div>
        </div>
      </section>
      
      <!-- 本人確認書類添付 -->
      <section class="form-section">
        <h3 class="section-title">本人確認書類添付</h3>
        <div class="form-group">
          <label for="nameChangeIdDocument">本人確認書類添付</label>
          <input 
            type="file" 
            id="nameChangeIdDocument" 
            class="form-input"
            accept=".pdf,.jpg,.jpeg,.png"
            (change)="onFileSelected($event, 'nameChangeIdDocument')"
          >
          <div *ngIf="nameChangeIdDocumentFile" class="file-name">{{ nameChangeIdDocumentFile.name }}</div>
        </div>
      </section>
      
      <!-- 送信ボタン -->
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="closeApplicationModal()">キャンセル</button>
        <button type="submit" class="submit-button" [disabled]="nameChangeForm.invalid">
          申請
        </button>
      </div>
    </form>
  </div>
</div>

<!-- マイナンバー変更申請モーダル -->
<div class="modal-overlay" *ngIf="showApplicationModal && currentApplicationType === 'マイナンバー変更申請'">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">マイナンバー変更申請</h2>
      <button class="modal-close-button" (click)="closeApplicationModal()">×</button>
    </div>
    
    <form [formGroup]="myNumberChangeForm" (ngSubmit)="submitMyNumberChangeApplication()" class="application-form">
      <!-- マイナンバー変更した日 -->
      <section class="form-section">
        <h3 class="section-title">マイナンバー変更した日</h3>
        <div class="form-group">
          <label for="changeDate">マイナンバー変更した日 <span class="required">*</span></label>
          <input 
            type="date" 
            id="changeDate" 
            formControlName="changeDate" 
            class="form-input"
          >
          <div *ngIf="myNumberChangeForm.get('changeDate')?.invalid && myNumberChangeForm.get('changeDate')?.touched" class="error-message">
            マイナンバー変更した日を入力してください
          </div>
        </div>
      </section>
      
      <!-- 新しいマイナンバー欄 -->
      <section class="form-section">
        <h3 class="section-title">新しいマイナンバー</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="newMyNumberPart1">1-4桁目 <span class="required">*</span></label>
            <input 
              type="text" 
              id="newMyNumberPart1" 
              formControlName="newMyNumberPart1" 
              class="form-input"
              maxlength="4"
              pattern="[0-9]*"
              inputmode="numeric"
            >
            <div *ngIf="myNumberChangeForm.get('newMyNumberPart1')?.invalid && myNumberChangeForm.get('newMyNumberPart1')?.touched" class="error-message">
              4桁の数字を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="newMyNumberPart2">5-8桁目 <span class="required">*</span></label>
            <input 
              type="text" 
              id="newMyNumberPart2" 
              formControlName="newMyNumberPart2" 
              class="form-input"
              maxlength="4"
              pattern="[0-9]*"
              inputmode="numeric"
            >
            <div *ngIf="myNumberChangeForm.get('newMyNumberPart2')?.invalid && myNumberChangeForm.get('newMyNumberPart2')?.touched" class="error-message">
              4桁の数字を入力してください
            </div>
          </div>
          <div class="form-group">
            <label for="newMyNumberPart3">9-12桁目 <span class="required">*</span></label>
            <input 
              type="text" 
              id="newMyNumberPart3" 
              formControlName="newMyNumberPart3" 
              class="form-input"
              maxlength="4"
              pattern="[0-9]*"
              inputmode="numeric"
            >
            <div *ngIf="myNumberChangeForm.get('newMyNumberPart3')?.invalid && myNumberChangeForm.get('newMyNumberPart3')?.touched" class="error-message">
              4桁の数字を入力してください
            </div>
          </div>
          <div class="form-group full-width">
            <label for="myNumberChangeCard">マイナンバーカード添付</label>
            <input 
              type="file" 
              id="myNumberChangeCard" 
              class="form-input"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'myNumberChangeCard')"
            >
            <div *ngIf="myNumberChangeCardFile" class="file-name">{{ myNumberChangeCardFile.name }}</div>
          </div>
        </div>
      </section>
      
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="closeApplicationModal()">キャンセル</button>
        <button type="submit" class="submit-button" [disabled]="myNumberChangeForm.invalid">
          申請
        </button>
      </div>
    </form>
  </div>
</div>

<!-- 産前産後休業申請モーダル -->
<div class="modal-overlay" *ngIf="showApplicationModal && currentApplicationType === '産前産後休業申請'">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">産前産後休業申請</h2>
      <button class="modal-close-button" (click)="closeApplicationModal()">×</button>
    </div>
    
    <form [formGroup]="maternityLeaveForm" (ngSubmit)="submitMaternityLeaveApplication()" class="application-form">
      <!-- 出産予定日 -->
      <section class="form-section">
        <h3 class="section-title">出産予定日</h3>
        <div class="form-group">
          <label for="expectedDeliveryDate">出産予定日 <span class="required">*</span></label>
          <input 
            type="date" 
            id="expectedDeliveryDate" 
            formControlName="expectedDeliveryDate" 
            class="form-input"
          >
          <div *ngIf="maternityLeaveForm.get('expectedDeliveryDate')?.invalid && maternityLeaveForm.get('expectedDeliveryDate')?.touched" class="error-message">
            出産予定日を入力してください
          </div>
        </div>
      </section>
      
      <!-- 双子以上か -->
      <section class="form-section">
        <h3 class="section-title">双子以上か <span class="required">*</span></h3>
        <div class="form-group">
          <label class="radio-label">
            <input type="radio" formControlName="isMultipleBirth" value="はい">
            はい
          </label>
          <label class="radio-label">
            <input type="radio" formControlName="isMultipleBirth" value="いいえ">
            いいえ
          </label>
          <div *ngIf="maternityLeaveForm.get('isMultipleBirth')?.invalid && maternityLeaveForm.get('isMultipleBirth')?.touched" class="error-message">
            選択してください
          </div>
        </div>
      </section>
      
      <!-- 産前産後休業期間 -->
      <section class="form-section">
        <h3 class="section-title">産前産後休業期間</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="maternityLeaveStartDate">産前産後休業開始日</label>
            <input 
              type="date" 
              id="maternityLeaveStartDate" 
              formControlName="maternityLeaveStartDate" 
              class="form-input"
              [disabled]="!maternityLeaveForm.get('expectedDeliveryDate')?.value"
            >
            <small class="form-hint" *ngIf="!maternityLeaveForm.get('expectedDeliveryDate')?.value">
              出産予定日を入力すると自動で設定されます
            </small>
          </div>
          <div class="form-group">
            <label for="maternityLeaveEndDate">産前産後休業終了日</label>
            <input 
              type="date" 
              id="maternityLeaveEndDate" 
              formControlName="maternityLeaveEndDate" 
              class="form-input"
              [disabled]="!maternityLeaveForm.get('expectedDeliveryDate')?.value"
            >
            <small class="form-hint" *ngIf="!maternityLeaveForm.get('expectedDeliveryDate')?.value">
              出産予定日を入力すると自動で設定されます
            </small>
          </div>
        </div>
      </section>
      
      <!-- 休業中の滞在先 -->
      <section class="form-section">
        <h3 class="section-title">休業中の滞在先</h3>
        <div class="form-group">
          <label for="stayAddress">休業中の滞在先（現住所と異なる場合）</label>
          <textarea 
            id="stayAddress" 
            formControlName="stayAddress" 
            class="form-input"
            rows="3"
            placeholder="現住所と異なる場合のみ入力してください"
          ></textarea>
        </div>
      </section>
      
      <!-- 送信ボタン -->
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="closeApplicationModal()">キャンセル</button>
        <button type="submit" class="submit-button" [disabled]="maternityLeaveForm.invalid">
          申請
        </button>
      </div>
    </form>
  </div>
</div>

<!-- 退職申請モーダル -->
<div class="modal-overlay" *ngIf="showApplicationModal && currentApplicationType === '退職申請'">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">退職申請</h2>
      <button class="modal-close-button" (click)="closeApplicationModal()">×</button>
    </div>
    
    <form [formGroup]="resignationForm" (ngSubmit)="submitResignationApplication()" class="application-form">
      <!-- 退職日 -->
      <section class="form-section">
        <h3 class="section-title">退職日</h3>
        <div class="form-group">
          <label for="resignationDate">退職日 <span class="required">*</span></label>
          <input 
            type="date" 
            id="resignationDate" 
            formControlName="resignationDate" 
            class="form-input"
            [min]="minResignationDate"
          >
          <div *ngIf="resignationForm.get('resignationDate')?.invalid && resignationForm.get('resignationDate')?.touched" class="error-message">
            <span *ngIf="resignationForm.get('resignationDate')?.errors?.['required']">退職日を入力してください</span>
            <span *ngIf="resignationForm.get('resignationDate')?.errors?.['pastDate']">退職日は今日以降の日付を入力してください</span>
          </div>
        </div>
      </section>
      
      <!-- 最終出社日 -->
      <section class="form-section">
        <h3 class="section-title">最終出社日</h3>
        <div class="form-group">
          <label for="lastWorkDate">最終出社日 <span class="required">*</span></label>
          <input 
            type="date" 
            id="lastWorkDate" 
            formControlName="lastWorkDate" 
            class="form-input"
            [max]="maxLastWorkDate"
          >
          <div *ngIf="resignationForm.get('lastWorkDate')?.invalid && resignationForm.get('lastWorkDate')?.touched" class="error-message">
            <span *ngIf="resignationForm.get('lastWorkDate')?.errors?.['required']">最終出社日を入力してください</span>
            <span *ngIf="resignationForm.get('lastWorkDate')?.errors?.['lastWorkDateAfterResignation']">最終出社日は退職日より前の日付を入力してください</span>
          </div>
        </div>
      </section>
      
      <!-- 退職理由 -->
      <section class="form-section">
        <h3 class="section-title">退職理由</h3>
        <div class="form-group">
          <label for="resignationReason">退職理由 <span class="required">*</span></label>
          <textarea 
            id="resignationReason" 
            formControlName="resignationReason" 
            class="form-input"
            rows="4"
            placeholder="退職理由を入力してください"
          ></textarea>
          <div *ngIf="resignationForm.get('resignationReason')?.invalid && resignationForm.get('resignationReason')?.touched" class="error-message">
            退職理由を入力してください
          </div>
        </div>
      </section>
      
      <!-- 離職票の発行について -->
      <section class="form-section">
        <h3 class="section-title">離職票の発行について</h3>
        <div class="form-group">
          <label class="radio-label">
            <input type="radio" formControlName="separationNotice" value="発行を希望する">
            発行を希望する
          </label>
          <label class="radio-label">
            <input type="radio" formControlName="separationNotice" value="発行を希望しない">
            発行を希望しない
          </label>
          <div *ngIf="resignationForm.get('separationNotice')?.invalid && resignationForm.get('separationNotice')?.touched" class="error-message">
            選択してください
          </div>
        </div>
      </section>
      
      <!-- 退職後の住所 -->
      <section class="form-section">
        <h3 class="section-title">退職後の住所</h3>
        <div class="form-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [checked]="sameAsCurrentAddressForResignation"
              (change)="onSameAsCurrentAddressForResignationChange($event)"
            >
            変更なし（現在の住所を使用）
          </label>
        </div>
        <div class="form-group">
          <label for="postResignationAddress">退職後の住所 <span class="required" *ngIf="!sameAsCurrentAddressForResignation">*</span></label>
          <textarea 
            id="postResignationAddress" 
            formControlName="postResignationAddress" 
            class="form-input"
            rows="3"
          ></textarea>
          <div *ngIf="!sameAsCurrentAddressForResignation && resignationForm.get('postResignationAddress')?.invalid && resignationForm.get('postResignationAddress')?.touched" class="error-message">
            退職後の住所を入力してください
          </div>
        </div>
      </section>
      
      <!-- 退職後の電話番号 -->
      <section class="form-section">
        <h3 class="section-title">退職後の電話番号</h3>
        <div class="form-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [checked]="sameAsCurrentPhoneForResignation"
              (change)="onSameAsCurrentPhoneForResignationChange($event)"
            >
            変更なし（現在の電話番号を使用）
          </label>
        </div>
        <div class="form-group">
          <label for="postResignationPhone">退職後の電話番号 <span class="required" *ngIf="!sameAsCurrentPhoneForResignation">*</span></label>
          <input 
            type="tel" 
            id="postResignationPhone" 
            formControlName="postResignationPhone" 
            class="form-input"
          >
          <div *ngIf="!sameAsCurrentPhoneForResignation && resignationForm.get('postResignationPhone')?.invalid && resignationForm.get('postResignationPhone')?.touched" class="error-message">
            退職後の電話番号を入力してください
          </div>
        </div>
      </section>
      
      <!-- 退職後のメールアドレス -->
      <section class="form-section">
        <h3 class="section-title">退職後のメールアドレス</h3>
        <div class="form-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [checked]="sameAsCurrentEmailForResignation"
              (change)="onSameAsCurrentEmailForResignationChange($event)"
            >
            変更なし（現在のメールアドレスを使用）
          </label>
        </div>
        <div class="form-group">
          <label for="postResignationEmail">退職後のメールアドレス <span class="required" *ngIf="!sameAsCurrentEmailForResignation">*</span></label>
          <input 
            type="email" 
            id="postResignationEmail" 
            formControlName="postResignationEmail" 
            class="form-input"
          >
          <div *ngIf="!sameAsCurrentEmailForResignation && resignationForm.get('postResignationEmail')?.invalid && resignationForm.get('postResignationEmail')?.touched" class="error-message">
            <span *ngIf="resignationForm.get('postResignationEmail')?.errors?.['required']">退職後のメールアドレスを入力してください</span>
            <span *ngIf="resignationForm.get('postResignationEmail')?.errors?.['email']">有効なメールアドレスを入力してください</span>
          </div>
        </div>
      </section>
      
      <!-- 退職後の社会保険加入 -->
      <section class="form-section">
        <h3 class="section-title">退職後の社会保険加入 <span class="required">*</span></h3>
        <div class="form-group">
          <label class="radio-label">
            <input type="radio" formControlName="postResignationInsurance" value="社会保険を任意継続する">
            社会保険を任意継続する
          </label>
          <label class="radio-label">
            <input type="radio" formControlName="postResignationInsurance" value="国民健康保険に加入する">
            国民健康保険に加入する
          </label>
          <label class="radio-label">
            <input type="radio" formControlName="postResignationInsurance" value="他社で社会保険に加入する">
            他社で社会保険に加入する
          </label>
          <div *ngIf="resignationForm.get('postResignationInsurance')?.invalid && resignationForm.get('postResignationInsurance')?.touched" class="error-message">
            退職後の社会保険加入を選択してください
          </div>
        </div>
      </section>
      
      <!-- 送信ボタン -->
      <div class="form-actions">
        <button type="button" class="cancel-button" (click)="closeApplicationModal()">キャンセル</button>
        <button type="submit" class="submit-button" [disabled]="resignationForm.invalid">
          申請
        </button>
      </div>
    </form>
  </div>
</div>

<!-- 申請詳細モーダル -->
<div 
  class="modal-overlay" 
  *ngIf="showApplicationDetailModal" 
  [class.modal-disabled]="isSubmittingReapplication"
>
  <div class="modal-content application-detail-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">申請詳細</h2>
      <button 
        class="modal-close-button" 
        (click)="closeApplicationDetailModal()"
        [disabled]="isSubmittingReapplication"
        [title]="isSubmittingReapplication ? '処理中です。しばらくお待ちください。' : ''"
      >×</button>
    </div>
    
    <div class="application-detail-content" *ngIf="selectedApplication">
      <!-- 申請基本情報 -->
      <section class="detail-section">
        <h3 class="section-title">申請基本情報</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">申請ID:</span>
            <span class="detail-value">{{ selectedApplication.applicationId }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">申請種類:</span>
            <span class="detail-value">{{ selectedApplication.applicationType }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">ステータス:</span>
            <span class="detail-value">
              <span class="status-badge" 
                    [class.status-pending]="selectedApplication.status === '承認待ち'"
                    [class.status-approved]="selectedApplication.status === '承認' || selectedApplication.status === '承認済み'"
                    [class.status-submitted]="selectedApplication.status === '申請済み'"
                    [class.status-rejected]="selectedApplication.status === '却下' || selectedApplication.status === '差し戻し'"
                    [class.status-resubmitted]="selectedApplication.status === '再申請' || selectedApplication.status === '再提出'"
                    [class.status-cancelled]="selectedApplication.status === '取り消し'">
                {{ selectedApplication.status }}
              </span>
            </span>
          </div>
          <div class="detail-item full-width" *ngIf="selectedApplication.status === '差し戻し' && selectedApplication.statusComment">
            <span class="detail-label">差し戻しコメント:</span>
            <span class="detail-value">{{ selectedApplication.statusComment }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">申請日:</span>
            <span class="detail-value">{{ getApplicationDate(selectedApplication) | date:'yyyy年MM月dd日' }}</span>
          </div>
        </div>
      </section>
      
      <!-- 差し戻しの場合の修正・再申請ボタン -->
      <div class="reapplication-actions" *ngIf="selectedApplication.status === '差し戻し'">
        <button 
          type="button" 
          class="edit-button" 
          (click)="enableEditMode()"
          *ngIf="!isEditModeForReapplication"
          [disabled]="isSubmittingReapplication"
          [title]="isSubmittingReapplication ? '処理中です。しばらくお待ちください。' : ''"
        >
          修正
        </button>
        <button 
          type="button" 
          class="resubmit-button" 
          (click)="submitReapplication()"
          *ngIf="isEditModeForReapplication"
          [disabled]="isSubmittingReapplication"
          [title]="isSubmittingReapplication ? '処理中です。しばらくお待ちください。' : ''"
        >
          {{ isSubmittingReapplication ? '送信中...' : '再申請' }}
        </button>
      </div>
      
      <!-- 扶養家族追加申請の詳細（表示モード・編集モード） -->
      <ng-container *ngIf="selectedApplication.applicationType === '扶養家族追加'">
        <form [formGroup]="dependentApplicationForm" (ngSubmit)="submitReapplication()" *ngIf="dependentApplicationForm" class="application-detail-form" [class.form-disabled]="isSubmittingReapplication">
        <!-- 続柄情報 -->
        <section class="detail-section">
          <h3 class="section-title">続柄 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span></h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">続柄種別:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.relationshipType || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <label class="radio-label">
                  <input type="radio" formControlName="relationshipType" value="配偶者" (change)="onRelationshipTypeChange()">
                  配偶者
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="relationshipType" value="配偶者以外" (change)="onRelationshipTypeChange()">
                  配偶者以外
                </label>
                <div *ngIf="dependentApplicationForm.get('relationshipType')?.invalid && dependentApplicationForm.get('relationshipType')?.touched" class="error-message">
                  続柄を選択してください
                </div>
              </div>
            </div>
            <div class="detail-item" *ngIf="(selectedApplication.relationshipType === '配偶者' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('relationshipType')?.value === '配偶者'))">
              <span class="detail-label">配偶者種別:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.spouseType || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <select 
                  formControlName="spouseType" 
                  class="form-input"
                  (change)="onSpouseTypeChange()"
                >
                  <option value="">選択してください</option>
                  <option value="妻">妻</option>
                  <option value="夫">夫</option>
                </select>
                <div *ngIf="dependentApplicationForm.get('spouseType')?.invalid && dependentApplicationForm.get('spouseType')?.touched" class="error-message">
                  妻または夫を選択してください
                </div>
              </div>
            </div>
            <div class="detail-item" *ngIf="(selectedApplication.relationshipType === '配偶者以外' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('relationshipType')?.value === '配偶者以外'))">
              <span class="detail-label">続柄:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.relationship || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input 
                  type="text" 
                  formControlName="relationship" 
                  class="form-input"
                  placeholder="例：父、母、子など"
                >
                <div *ngIf="dependentApplicationForm.get('relationship')?.invalid && dependentApplicationForm.get('relationship')?.touched" class="error-message">
                  続柄を入力してください
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- 基礎年金番号 -->
        <section class="detail-section">
          <h3 class="section-title">基礎年金番号</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">基礎年金番号:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ formatBasicPensionNumberForDisplay(selectedApplication.basicPensionNumber) }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <div class="basic-pension-number-container">
                  <input 
                    type="text" 
                    formControlName="basicPensionNumberPart1" 
                    class="form-input basic-pension-part"
                    maxlength="4"
                    (input)="formatDependentBasicPensionNumberInput($event, 1)"
                    placeholder="0000"
                  >
                  <span class="basic-pension-separator">-</span>
                  <input 
                    type="text" 
                    formControlName="basicPensionNumberPart2" 
                    class="form-input basic-pension-part"
                    maxlength="6"
                    (input)="formatDependentBasicPensionNumberInput($event, 2)"
                    placeholder="000000"
                  >
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- 基本情報 -->
        <section class="detail-section">
          <h3 class="section-title">基本情報</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">姓 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.lastName || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="text" formControlName="lastName" class="form-input">
                <div *ngIf="dependentApplicationForm.get('lastName')?.invalid && dependentApplicationForm.get('lastName')?.touched" class="error-message">
                  姓を入力してください
                </div>
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">名 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.firstName || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="text" formControlName="firstName" class="form-input">
                <div *ngIf="dependentApplicationForm.get('firstName')?.invalid && dependentApplicationForm.get('firstName')?.touched" class="error-message">
                  名を入力してください
                </div>
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">姓（ヨミガナ）:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.lastNameKana || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="text" formControlName="lastNameKana" class="form-input">
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">名（ヨミガナ）:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.firstNameKana || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="text" formControlName="firstNameKana" class="form-input">
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">生年月日 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.birthDate || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="date" formControlName="birthDate" class="form-input">
                <div *ngIf="dependentApplicationForm.get('birthDate')?.invalid && dependentApplicationForm.get('birthDate')?.touched" class="error-message">
                  生年月日を入力してください
                </div>
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">性別 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.gender || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <select formControlName="gender" class="form-input">
                  <option value="">選択してください</option>
                  <option value="男性">男性</option>
                  <option value="女性">女性</option>
                </select>
                <div *ngIf="dependentApplicationForm.get('gender')?.invalid && dependentApplicationForm.get('gender')?.touched" class="error-message">
                  性別を選択してください
                </div>
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">電話番号:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.phoneNumber || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input 
                  type="tel" 
                  formControlName="phoneNumber" 
                  class="form-input"
                  maxlength="11"
                  pattern="[a-zA-Z0-9]*"
                  (input)="formatDependentPhoneNumber($event)"
                >
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">職業:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.occupation || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="text" formControlName="occupation" class="form-input">
              </div>
            </div>
          </div>
        </section>
        
        <!-- 収入情報 -->
        <section class="detail-section">
          <h3 class="section-title">収入情報</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">扶養追加日からの年間収入見込み額:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.annualIncome ? (selectedApplication.annualIncome | number:'1.0-0') + '円' : '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="number" formControlName="annualIncome" class="form-input">
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">扶養追加日からの月額収入見込み額:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.monthlyIncome ? (selectedApplication.monthlyIncome | number:'1.0-0') + '円' : '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="number" formControlName="monthlyIncome" class="form-input">
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">社会保険の扶養者となった日 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.dependentStartDate || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="date" formControlName="dependentStartDate" class="form-input">
                <div *ngIf="dependentApplicationForm.get('dependentStartDate')?.invalid && dependentApplicationForm.get('dependentStartDate')?.touched" class="error-message">
                  社会保険の扶養者となった日を入力してください
                </div>
              </div>
            </div>
            <div class="detail-item full-width">
              <span class="detail-label">扶養に追加された理由:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.dependentReason || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <textarea formControlName="dependentReason" class="form-input" rows="3"></textarea>
              </div>
            </div>
          </div>
        </section>
        
        <!-- マイナンバー情報 -->
        <section class="detail-section">
          <h3 class="section-title">マイナンバー <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span></h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">マイナンバーの提供:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.provideMyNumber || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <label class="radio-label">
                  <input type="radio" formControlName="provideMyNumber" value="提供する" (change)="onProvideMyNumberChange()">
                  提供する
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="provideMyNumber" value="提供しない" (change)="onProvideMyNumberChange()">
                  提供しない
                </label>
                <div *ngIf="dependentApplicationForm.get('provideMyNumber')?.invalid && dependentApplicationForm.get('provideMyNumber')?.touched" class="error-message">
                  マイナンバーの提供を選択してください
                </div>
              </div>
            </div>
            <div class="detail-item" *ngIf="selectedApplication.provideMyNumber === '提供する' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('provideMyNumber')?.value === '提供する')">
              <span class="detail-label">マイナンバー:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ formatMyNumberForDisplay(selectedApplication.myNumber) }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <div class="my-number-container">
                  <div class="my-number-inputs">
                    <input 
                      type="text" 
                      formControlName="myNumberPart1" 
                      class="form-input my-number-part"
                      maxlength="4"
                      (input)="formatDependentMyNumberInput($event, 1)"
                      placeholder="0000"
                    >
                    <span class="my-number-separator">-</span>
                    <input 
                      type="text" 
                      formControlName="myNumberPart2" 
                      class="form-input my-number-part"
                      maxlength="4"
                      (input)="formatDependentMyNumberInput($event, 2)"
                      placeholder="0000"
                    >
                    <span class="my-number-separator">-</span>
                    <input 
                      type="text" 
                      formControlName="myNumberPart3" 
                      class="form-input my-number-part"
                      maxlength="4"
                      (input)="formatDependentMyNumberInput($event, 3)"
                      placeholder="0000"
                    >
                  </div>
                </div>
                <div *ngIf="dependentApplicationForm.get('myNumberPart1')?.invalid && dependentApplicationForm.get('myNumberPart1')?.touched" class="error-message">
                  マイナンバーを入力してください
                </div>
              </div>
            </div>
            <div class="detail-item full-width" *ngIf="(selectedApplication.provideMyNumber === '提供する' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('provideMyNumber')?.value === '提供する')) && (selectedApplication.myNumberCardFileUrl || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentMyNumberCardFile))">
              <span class="detail-label">マイナンバーカード <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                <a *ngIf="selectedApplication.myNumberCardFileUrl" [href]="selectedApplication.myNumberCardFileUrl" target="_blank" class="file-link">
                  {{ selectedApplication.myNumberCardFile || 'マイナンバーカードを開く' }}
                </a>
                <span *ngIf="!selectedApplication.myNumberCardFileUrl">-</span>
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input 
                  type="file" 
                  class="form-input"
                  accept=".pdf,.jpg,.jpeg,.png"
                  (change)="onFileSelected($event, 'dependentMyNumberCard')"
                >
                <div *ngIf="dependentMyNumberCardFile" class="file-name">{{ dependentMyNumberCardFile.name }}</div>
                <div *ngIf="selectedApplication.myNumberCardFileUrl && !dependentMyNumberCardFile" class="file-info" style="margin-top: 0.5rem;">
                  <span>既存ファイル: </span>
                  <a [href]="selectedApplication.myNumberCardFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.myNumberCardFile || 'マイナンバーカードを開く' }}
                  </a>
                </div>
              </div>
            </div>
            <div class="detail-item full-width" *ngIf="selectedApplication.provideMyNumber === '提供しない' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('provideMyNumber')?.value === '提供しない')">
              <span class="detail-label">未提供理由 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.myNumberNotProvidedReason || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <textarea formControlName="myNumberNotProvidedReason" class="form-input" rows="3"></textarea>
                <div *ngIf="dependentApplicationForm.get('myNumberNotProvidedReason')?.invalid && dependentApplicationForm.get('myNumberNotProvidedReason')?.touched" class="error-message">
                  未提供理由を入力してください
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- 障がい者情報 -->
        <section class="detail-section" *ngIf="selectedApplication.disabilityCategory || selectedApplication.disabilityCardType || (isEditModeForReapplication && selectedApplication.status === '差し戻し')">
          <h3 class="section-title">障がい者情報</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">障がい者区分:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.disabilityCategory || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="text" formControlName="disabilityCategory" class="form-input">
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">障がい者手帳の種類:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.disabilityCardType || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="text" formControlName="disabilityCardType" class="form-input">
              </div>
            </div>
            <div class="detail-item">
              <span class="detail-label">障がい者手帳の交付年月日:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.disabilityCardIssueDate || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="date" formControlName="disabilityCardIssueDate" class="form-input">
              </div>
            </div>
          </div>
        </section>
        
        <!-- 住所情報 -->
        <section class="detail-section">
          <h3 class="section-title">住所情報 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span></h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">同居/別居:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.livingTogether || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <label class="radio-label">
                  <input type="radio" formControlName="livingTogether" value="同居" (change)="onLivingTogetherChange()">
                  同居
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="livingTogether" value="別居" (change)="onLivingTogetherChange()">
                  別居
                </label>
                <div *ngIf="dependentApplicationForm.get('livingTogether')?.invalid && dependentApplicationForm.get('livingTogether')?.touched" class="error-message">
                  同居/別居を選択してください
                </div>
              </div>
            </div>
            <div class="detail-item" *ngIf="selectedApplication.livingTogether === '別居' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('livingTogether')?.value === '別居')">
              <span class="detail-label">郵便番号 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.postalCode || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input 
                  type="text" 
                  formControlName="postalCode" 
                  class="form-input" 
                  placeholder="例: 1234567"
                  maxlength="7"
                  pattern="[a-zA-Z0-9]*"
                  (input)="formatDependentPostalCode($event)"
                >
                <div *ngIf="dependentApplicationForm.get('postalCode')?.invalid && dependentApplicationForm.get('postalCode')?.touched" class="error-message">
                  郵便番号を入力してください
                </div>
              </div>
            </div>
            <div class="detail-item full-width" *ngIf="selectedApplication.livingTogether === '別居' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('livingTogether')?.value === '別居')">
              <span class="detail-label">住所 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span>:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.address || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <textarea formControlName="address" class="form-input" rows="2"></textarea>
                <div *ngIf="dependentApplicationForm.get('address')?.invalid && dependentApplicationForm.get('address')?.touched" class="error-message">
                  住所を入力してください
                </div>
              </div>
            </div>
            <div class="detail-item full-width" *ngIf="selectedApplication.livingTogether === '別居' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('livingTogether')?.value === '別居')">
              <span class="detail-label">住所（ヨミガナ）:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.addressKana || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <textarea formControlName="addressKana" class="form-input" rows="2"></textarea>
              </div>
            </div>
            <div class="detail-item" *ngIf="selectedApplication.livingTogether === '別居' || (isEditModeForReapplication && selectedApplication.status === '差し戻し' && dependentApplicationForm?.get('livingTogether')?.value === '別居')">
              <span class="detail-label">住所変更年月日:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.addressChangeDate || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="date" formControlName="addressChangeDate" class="form-input">
              </div>
            </div>
          </div>
        </section>
        
        <!-- 添付書類 -->
        <section class="detail-section" *ngIf="selectedApplication.basicPensionNumberDocFileUrl || selectedApplication.myNumberDocFileUrl || selectedApplication.identityDocFileUrl || selectedApplication.disabilityCardFileUrl">
          <h3 class="section-title">添付書類</h3>
          <div class="detail-grid">
            <div class="detail-item full-width" *ngIf="selectedApplication.basicPensionNumberDocFileUrl">
              <span class="detail-label">基礎年金番号確認書類:</span>
              <span class="detail-value">
                <a [href]="selectedApplication.basicPensionNumberDocFileUrl" target="_blank" class="file-link">{{ getFileNameFromUrl(selectedApplication.basicPensionNumberDocFileUrl, selectedApplication.basicPensionNumberDocFileName) }}</a>
              </span>
            </div>
            <div class="detail-item full-width" *ngIf="selectedApplication.myNumberDocFileUrl">
              <span class="detail-label">マイナンバー確認書類:</span>
              <span class="detail-value">
                <a [href]="selectedApplication.myNumberDocFileUrl" target="_blank" class="file-link">{{ getFileNameFromUrl(selectedApplication.myNumberDocFileUrl, selectedApplication.myNumberDocFileName) }}</a>
              </span>
            </div>
            <div class="detail-item full-width" *ngIf="selectedApplication.identityDocFileUrl">
              <span class="detail-label">身元確認書類:</span>
              <span class="detail-value">
                <a [href]="selectedApplication.identityDocFileUrl" target="_blank" class="file-link">{{ getFileNameFromUrl(selectedApplication.identityDocFileUrl, selectedApplication.identityDocFileName) }}</a>
              </span>
            </div>
            <div class="detail-item full-width" *ngIf="selectedApplication.disabilityCardFileUrl">
              <span class="detail-label">障がい者手帳の画像:</span>
              <span class="detail-value">
                <a [href]="selectedApplication.disabilityCardFileUrl" target="_blank" class="file-link">{{ getFileNameFromUrl(selectedApplication.disabilityCardFileUrl, selectedApplication.disabilityCardFileName) }}</a>
              </span>
            </div>
          </div>
        </section>
        </form>
      </ng-container>
      
      <!-- 扶養削除申請の詳細 -->
      <ng-container *ngIf="selectedApplication.applicationType === '扶養削除申請'">
        <form [formGroup]="dependentRemovalForm" (ngSubmit)="submitReapplication()" *ngIf="dependentRemovalForm" class="application-detail-form" [class.form-disabled]="isSubmittingReapplication">
        <!-- 被扶養者移動日 -->
        <section class="detail-section">
          <h3 class="section-title">被扶養者移動日 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span></h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">被扶養者移動日:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.removalDate || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <input type="date" formControlName="removalDate" class="form-input">
                <div *ngIf="dependentRemovalForm.get('removalDate')?.invalid && dependentRemovalForm.get('removalDate')?.touched" class="error-message">
                  被扶養者移動日を入力してください
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- 扶養削除の理由 -->
        <section class="detail-section">
          <h3 class="section-title">扶養削除の理由 <span class="required" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">*</span></h3>
          <div class="detail-grid">
            <div class="detail-item full-width">
              <span class="detail-label">扶養削除の理由:</span>
              <!-- 表示モード -->
              <span class="detail-value" *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
                {{ selectedApplication.removalReason || '-' }}
              </span>
              <!-- 編集モード -->
              <div *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="detail-edit-input">
                <textarea formControlName="removalReason" class="form-input" rows="4" placeholder="扶養削除の理由を入力してください"></textarea>
                <div *ngIf="dependentRemovalForm.get('removalReason')?.invalid && dependentRemovalForm.get('removalReason')?.touched" class="error-message">
                  扶養削除の理由を入力してください
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- 被扶養者情報 -->
        <section class="detail-section" *ngIf="selectedApplication.dependent">
          <h3 class="section-title">被扶養者情報</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">氏名:</span>
              <span class="detail-value">{{ selectedApplication.dependent.name || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">氏名（ヨミガナ）:</span>
              <span class="detail-value">{{ selectedApplication.dependent.nameKana || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">続柄:</span>
              <span class="detail-value">{{ selectedApplication.dependent.relationship || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">生年月日:</span>
              <span class="detail-value">{{ selectedApplication.dependent.birthDate || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">マイナンバー:</span>
              <span class="detail-value">{{ selectedApplication.dependent.myNumber ? '●●●●-●●●●-●●●●' : '-' }}</span>
            </div>
            <div class="detail-item full-width">
              <span class="detail-label">住所:</span>
              <span class="detail-value">{{ selectedApplication.dependent.address || '-' }}</span>
            </div>
            <div class="detail-item full-width" *ngIf="selectedApplication.dependent.notes">
              <span class="detail-label">備考:</span>
              <span class="detail-value">{{ selectedApplication.dependent.notes }}</span>
            </div>
          </div>
        </section>
        </form>
      </ng-container>
      
      <!-- 住所変更申請の詳細 -->
      <ng-container *ngIf="selectedApplication.applicationType === '住所変更申請'">
        <!-- 編集フォーム（差し戻しの場合） -->
        <form [formGroup]="addressChangeForm" (ngSubmit)="submitReapplication()" *ngIf="addressChangeForm && isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="application-detail-form" [class.form-disabled]="isSubmittingReapplication">
          <!-- 引っ越しした日 -->
          <section class="detail-section">
            <h3 class="section-title">引っ越しした日 <span class="required">*</span></h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">引っ越しした日:</span>
                <div class="detail-edit-input">
                  <input type="date" formControlName="moveDate" class="form-input">
                  <div *ngIf="addressChangeForm.get('moveDate')?.invalid && addressChangeForm.get('moveDate')?.touched" class="error-message">
                    引っ越しした日を入力してください
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 新しい住所 -->
          <section class="detail-section">
            <h3 class="section-title">新しい住所</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">郵便番号 <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <input 
                    type="text" 
                    formControlName="newPostalCode" 
                    class="form-input"
                    placeholder="1234567"
                    maxlength="7"
                    pattern="[0-9]{7}"
                    (input)="formatAddressPostalCode($event)"
                  >
                  <div *ngIf="addressChangeForm.get('newPostalCode')?.invalid && addressChangeForm.get('newPostalCode')?.touched" class="error-message">
                    <span *ngIf="addressChangeForm.get('newPostalCode')?.errors?.['required']">
                      郵便番号を入力してください
                    </span>
                    <span *ngIf="addressChangeForm.get('newPostalCode')?.errors?.['pattern']">
                      7桁の数字を入力してください
                    </span>
                  </div>
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所 <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <textarea formControlName="newAddress" class="form-input" rows="2"></textarea>
                  <div *ngIf="addressChangeForm.get('newAddress')?.invalid && addressChangeForm.get('newAddress')?.touched" class="error-message">
                    住所を入力してください
                  </div>
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所（ヨミガナ）:</span>
                <div class="detail-edit-input">
                  <textarea formControlName="newAddressKana" class="form-input" rows="2"></textarea>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 新しい住民票住所 -->
          <section class="detail-section">
            <h3 class="section-title">新しい住民票住所</h3>
            <div class="form-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [checked]="sameAsOldAddress"
                  (change)="onSameAsOldAddressChange($event)"
                >
                変更前住所と同じ
              </label>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [checked]="sameAsNewAddress"
                  (change)="onSameAsNewAddressChange($event)"
                >
                変更後の住所と同じ
              </label>
            </div>
            <div class="detail-grid" *ngIf="!sameAsOldAddress && !sameAsNewAddress">
              <div class="detail-item">
                <span class="detail-label">郵便番号:</span>
                <div class="detail-edit-input">
                  <input 
                    type="text" 
                    formControlName="residentPostalCode" 
                    class="form-input"
                    placeholder="1234567"
                    maxlength="7"
                    pattern="[0-9]{7}"
                    (input)="formatResidentPostalCodeForAddressChange($event)"
                  >
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所:</span>
                <div class="detail-edit-input">
                  <textarea formControlName="residentAddress" class="form-input" rows="2"></textarea>
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所（ヨミガナ）:</span>
                <div class="detail-edit-input">
                  <textarea formControlName="residentAddressKana" class="form-input" rows="2"></textarea>
                </div>
              </div>
            </div>
          </section>
        </form>
        
        <!-- 表示モード（編集モードでない場合） -->
        <ng-container *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
          <!-- 引っ越しした日 -->
          <section class="detail-section">
            <h3 class="section-title">引っ越しした日</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">引っ越しした日:</span>
                <span class="detail-value">{{ selectedApplication.moveDate || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 新しい住所 -->
          <section class="detail-section" *ngIf="selectedApplication.newAddress">
            <h3 class="section-title">新しい住所</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">郵便番号:</span>
                <span class="detail-value">{{ selectedApplication.newAddress.postalCode || '-' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所:</span>
                <span class="detail-value">{{ selectedApplication.newAddress.address || '-' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.newAddress.addressKana || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 新しい住民票住所 -->
          <section class="detail-section" *ngIf="selectedApplication.residentAddress">
            <h3 class="section-title">新しい住民票住所</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">現住所と同じ:</span>
                <span class="detail-value">{{ selectedApplication.residentAddress.sameAsNewAddress ? 'はい' : 'いいえ' }}</span>
              </div>
              <div class="detail-item" *ngIf="!selectedApplication.residentAddress.sameAsNewAddress">
                <span class="detail-label">郵便番号:</span>
                <span class="detail-value">{{ selectedApplication.residentAddress.postalCode || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.residentAddress.sameAsNewAddress">
                <span class="detail-label">住所:</span>
                <span class="detail-value">{{ selectedApplication.residentAddress.address || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.residentAddress.sameAsNewAddress">
                <span class="detail-label">住所（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.residentAddress.addressKana || '-' }}</span>
              </div>
            </div>
          </section>
        </ng-container>
        
        <!-- 新しい緊急連絡先 -->
        <section class="detail-section" *ngIf="selectedApplication.emergencyContact">
          <h3 class="section-title">新しい緊急連絡先</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">姓:</span>
              <span class="detail-value">{{ selectedApplication.emergencyContact.lastName || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">名:</span>
              <span class="detail-value">{{ selectedApplication.emergencyContact.firstName || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">姓（ヨミガナ）:</span>
              <span class="detail-value">{{ selectedApplication.emergencyContact.lastNameKana || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">名（ヨミガナ）:</span>
              <span class="detail-value">{{ selectedApplication.emergencyContact.firstNameKana || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">続柄:</span>
              <span class="detail-value">{{ selectedApplication.emergencyContact.relationship || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">電話番号:</span>
              <span class="detail-value">{{ selectedApplication.emergencyContact.phone || '-' }}</span>
            </div>
          </div>
        </section>
      </ng-container>
      
      <!-- マイナンバー変更申請の詳細 -->
      <ng-container *ngIf="selectedApplication.applicationType === 'マイナンバー変更申請'">
        <!-- 編集フォーム（差し戻しの場合） -->
        <form [formGroup]="myNumberChangeForm" (ngSubmit)="submitReapplication()" *ngIf="myNumberChangeForm && isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="application-detail-form" [class.form-disabled]="isSubmittingReapplication">
          <!-- マイナンバー変更した日 -->
          <section class="detail-section">
            <h3 class="section-title">マイナンバー変更した日 <span class="required">*</span></h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">マイナンバー変更した日:</span>
                <div class="detail-edit-input">
                  <input type="date" formControlName="changeDate" class="form-input">
                  <div *ngIf="myNumberChangeForm.get('changeDate')?.invalid && myNumberChangeForm.get('changeDate')?.touched" class="error-message">
                    マイナンバー変更した日を入力してください
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 新しいマイナンバー -->
          <section class="detail-section">
            <h3 class="section-title">新しいマイナンバー <span class="required">*</span></h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">1-4桁目:</span>
                <div class="detail-edit-input">
                  <input 
                    type="text" 
                    formControlName="newMyNumberPart1" 
                    class="form-input"
                    maxlength="4"
                    pattern="[0-9]*"
                    inputmode="numeric"
                  >
                  <div *ngIf="myNumberChangeForm.get('newMyNumberPart1')?.invalid && myNumberChangeForm.get('newMyNumberPart1')?.touched" class="error-message">
                    4桁の数字を入力してください
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">5-8桁目:</span>
                <div class="detail-edit-input">
                  <input 
                    type="text" 
                    formControlName="newMyNumberPart2" 
                    class="form-input"
                    maxlength="4"
                    pattern="[0-9]*"
                    inputmode="numeric"
                  >
                  <div *ngIf="myNumberChangeForm.get('newMyNumberPart2')?.invalid && myNumberChangeForm.get('newMyNumberPart2')?.touched" class="error-message">
                    4桁の数字を入力してください
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">9-12桁目:</span>
                <div class="detail-edit-input">
                  <input 
                    type="text" 
                    formControlName="newMyNumberPart3" 
                    class="form-input"
                    maxlength="4"
                    pattern="[0-9]*"
                    inputmode="numeric"
                  >
                  <div *ngIf="myNumberChangeForm.get('newMyNumberPart3')?.invalid && myNumberChangeForm.get('newMyNumberPart3')?.touched" class="error-message">
                    4桁の数字を入力してください
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- マイナンバーカード -->
          <section class="detail-section">
            <h3 class="section-title">マイナンバーカード</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">マイナンバーカード:</span>
                <div class="detail-edit-input">
                  <input 
                    type="file" 
                    class="form-input"
                    accept=".pdf,.jpg,.jpeg,.png"
                    (change)="onFileSelected($event, 'myNumberChangeCard')"
                  >
                  <div *ngIf="myNumberChangeCardFile" class="file-name">{{ myNumberChangeCardFile.name }}</div>
                  <div *ngIf="selectedApplication.myNumberCardFileUrl && !myNumberChangeCardFile" class="file-info" style="margin-top: 0.5rem;">
                    <span>既存ファイル: </span>
                    <a [href]="selectedApplication.myNumberCardFileUrl" target="_blank" class="file-link">
                      {{ selectedApplication.myNumberCardFile || 'マイナンバーカードを開く' }}
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </form>
        
        <!-- 表示モード（差し戻しでない場合、または編集モードでない場合） -->
        <ng-container *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
          <!-- マイナンバー変更した日 -->
          <section class="detail-section">
            <h3 class="section-title">マイナンバー変更した日</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">マイナンバー変更した日:</span>
                <span class="detail-value">{{ selectedApplication.changeDate || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 新しいマイナンバー -->
          <section class="detail-section" *ngIf="selectedApplication.newMyNumber">
            <h3 class="section-title">新しいマイナンバー</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">1-4桁目:</span>
                <span class="detail-value">{{ selectedApplication.newMyNumber.part1 || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">5-8桁目:</span>
                <span class="detail-value">{{ selectedApplication.newMyNumber.part2 || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">9-12桁目:</span>
                <span class="detail-value">{{ selectedApplication.newMyNumber.part3 || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- マイナンバーカード -->
          <section class="detail-section" *ngIf="selectedApplication.myNumberCardFileUrl">
            <h3 class="section-title">マイナンバーカード</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">マイナンバーカード:</span>
                <span class="detail-value">
                  <a [href]="selectedApplication.myNumberCardFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.myNumberCardFile || 'マイナンバーカードを開く' }}
                  </a>
                </span>
              </div>
            </div>
          </section>
        </ng-container>
      </ng-container>
      
      <!-- 氏名変更申請の詳細 -->
      <ng-container *ngIf="selectedApplication.applicationType === '氏名変更申請'">
        <!-- 編集フォーム（差し戻しの場合） -->
        <form [formGroup]="nameChangeForm" (ngSubmit)="submitReapplication()" *ngIf="nameChangeForm && isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="application-detail-form" [class.form-disabled]="isSubmittingReapplication">
          <!-- 氏名変更した日 -->
          <section class="detail-section">
            <h3 class="section-title">氏名変更した日 <span class="required">*</span></h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">氏名変更した日:</span>
                <div class="detail-edit-input">
                  <input type="date" formControlName="changeDate" class="form-input">
                  <div *ngIf="nameChangeForm.get('changeDate')?.invalid && nameChangeForm.get('changeDate')?.touched" class="error-message">
                    氏名変更した日を入力してください
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 新しい氏名 -->
          <section class="detail-section">
            <h3 class="section-title">新しい氏名</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">姓 <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <input type="text" formControlName="newLastName" class="form-input">
                  <div *ngIf="nameChangeForm.get('newLastName')?.invalid && nameChangeForm.get('newLastName')?.touched" class="error-message">
                    姓を入力してください
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">名 <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <input type="text" formControlName="newFirstName" class="form-input">
                  <div *ngIf="nameChangeForm.get('newFirstName')?.invalid && nameChangeForm.get('newFirstName')?.touched" class="error-message">
                    名を入力してください
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">姓（ヨミガナ） <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <input type="text" formControlName="newLastNameKana" class="form-input">
                  <div *ngIf="nameChangeForm.get('newLastNameKana')?.invalid && nameChangeForm.get('newLastNameKana')?.touched" class="error-message">
                    姓（ヨミガナ）を入力してください
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">名（ヨミガナ） <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <input type="text" formControlName="newFirstNameKana" class="form-input">
                  <div *ngIf="nameChangeForm.get('newFirstNameKana')?.invalid && nameChangeForm.get('newFirstNameKana')?.touched" class="error-message">
                    名（ヨミガナ）を入力してください
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 本人確認書類 -->
          <section class="detail-section">
            <h3 class="section-title">本人確認書類添付</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">本人確認書類:</span>
                <div class="detail-edit-input">
                  <input 
                    type="file" 
                    accept=".pdf,.jpg,.jpeg,.png"
                    (change)="onFileSelected($event, 'nameChangeIdDocument')"
                    class="form-input"
                  >
                  <div *ngIf="nameChangeIdDocumentFile" class="file-info">
                    選択済み: {{ nameChangeIdDocumentFile.name }}
                  </div>
                  <div *ngIf="selectedApplication.idDocumentFileUrl && !nameChangeIdDocumentFile" class="file-info">
                    現在のファイル: <a [href]="selectedApplication.idDocumentFileUrl" target="_blank" class="file-link">本人確認書類を開く</a>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </form>
        
        <!-- 表示モード（編集モードでない場合） -->
        <ng-container *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
          <!-- 氏名変更した日 -->
          <section class="detail-section">
            <h3 class="section-title">氏名変更した日</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">氏名変更した日:</span>
                <span class="detail-value">{{ selectedApplication.changeDate || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 新しい氏名 -->
          <section class="detail-section" *ngIf="selectedApplication.newName">
            <h3 class="section-title">新しい氏名</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">姓:</span>
                <span class="detail-value">{{ selectedApplication.newName.lastName || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">名:</span>
                <span class="detail-value">{{ selectedApplication.newName.firstName || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">姓（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.newName.lastNameKana || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">名（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.newName.firstNameKana || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 本人確認書類 -->
          <section class="detail-section">
            <h3 class="section-title">本人確認書類</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">本人確認書類添付:</span>
                <span class="detail-value">{{ selectedApplication.hasIdDocument ? 'あり' : 'なし' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.idDocumentFileUrl">
                <span class="detail-label">本人確認書類:</span>
                <span class="detail-value">
                  <a [href]="selectedApplication.idDocumentFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.idDocumentFile || '本人確認書類を開く' }}
                  </a>
                </span>
              </div>
            </div>
          </section>
        </ng-container>
      </ng-container>
      
      <!-- 産前産後休業申請の詳細 -->
      <ng-container *ngIf="selectedApplication.applicationType === '産前産後休業申請'">
        <!-- 編集フォーム（差し戻しの場合） -->
        <form [formGroup]="maternityLeaveForm" (ngSubmit)="submitReapplication()" *ngIf="maternityLeaveForm && isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="application-detail-form" [class.form-disabled]="isSubmittingReapplication">
          <!-- 出産予定日 -->
          <section class="detail-section">
            <h3 class="section-title">出産予定日 <span class="required">*</span></h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">出産予定日 <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <input type="date" formControlName="expectedDeliveryDate" class="form-input">
                  <div *ngIf="maternityLeaveForm.get('expectedDeliveryDate')?.invalid && maternityLeaveForm.get('expectedDeliveryDate')?.touched" class="error-message">
                    出産予定日を入力してください
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">双子以上か:</span>
                <div class="detail-edit-input">
                  <select formControlName="isMultipleBirth" class="form-input">
                    <option value="">選択してください</option>
                    <option value="いいえ">いいえ</option>
                    <option value="はい">はい</option>
                  </select>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 産前産後休業期間 -->
          <section class="detail-section">
            <h3 class="section-title">産前産後休業期間</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">産前産後休業開始日:</span>
                <div class="detail-edit-input">
                  <input type="date" formControlName="maternityLeaveStartDate" class="form-input">
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">産前産後休業終了日:</span>
                <div class="detail-edit-input">
                  <input type="date" formControlName="maternityLeaveEndDate" class="form-input">
                </div>
              </div>
            </div>
          </section>
          
          <!-- 休業中の滞在先 -->
          <section class="detail-section">
            <h3 class="section-title">休業中の滞在先</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">休業中の滞在先（現住所と異なる場合）:</span>
                <div class="detail-edit-input">
                  <textarea formControlName="stayAddress" class="form-input" rows="2"></textarea>
                </div>
              </div>
            </div>
          </section>
        </form>
        
        <!-- 表示モード（編集モードでない場合） -->
        <ng-container *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
          <!-- 出産予定日 -->
          <section class="detail-section">
            <h3 class="section-title">出産予定日</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">出産予定日:</span>
                <span class="detail-value">{{ selectedApplication.expectedDeliveryDate || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">双子以上か:</span>
                <span class="detail-value">{{ selectedApplication.isMultipleBirth || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 産前産後休業期間 -->
          <section class="detail-section">
            <h3 class="section-title">産前産後休業期間</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">産前産後休業開始日:</span>
                <span class="detail-value">{{ selectedApplication.maternityLeaveStartDate || selectedApplication.preMaternityLeaveStartDate || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">産前産後休業終了日:</span>
                <span class="detail-value">{{ selectedApplication.maternityLeaveEndDate || selectedApplication.postMaternityLeaveEndDate || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 休業中の滞在先 -->
          <section class="detail-section" *ngIf="selectedApplication.stayAddress">
            <h3 class="section-title">休業中の滞在先</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">休業中の滞在先（現住所と異なる場合）:</span>
                <span class="detail-value">{{ selectedApplication.stayAddress }}</span>
              </div>
            </div>
          </section>
        </ng-container>
      </ng-container>
      
      <!-- 退職申請の詳細 -->
      <ng-container *ngIf="selectedApplication.applicationType === '退職申請'">
        <!-- 編集フォーム（差し戻しの場合） -->
        <form [formGroup]="resignationForm" (ngSubmit)="submitReapplication()" *ngIf="resignationForm && isEditModeForReapplication && selectedApplication.status === '差し戻し'" class="application-detail-form" [class.form-disabled]="isSubmittingReapplication">
          <!-- 退職日・最終出社日 -->
          <section class="detail-section">
            <h3 class="section-title">退職情報 <span class="required">*</span></h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">退職日 <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <input type="date" formControlName="resignationDate" class="form-input" [min]="minResignationDate">
                  <div *ngIf="resignationForm.get('resignationDate')?.invalid && resignationForm.get('resignationDate')?.touched" class="error-message">
                    <span *ngIf="resignationForm.get('resignationDate')?.errors?.['required']">退職日を入力してください</span>
                    <span *ngIf="resignationForm.get('resignationDate')?.errors?.['pastDate']">退職日は今日以降の日付を入力してください</span>
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">最終出社日 <span class="required">*</span>:</span>
                <div class="detail-edit-input">
                  <input type="date" formControlName="lastWorkDate" class="form-input" [max]="maxLastWorkDate">
                  <div *ngIf="resignationForm.get('lastWorkDate')?.invalid && resignationForm.get('lastWorkDate')?.touched" class="error-message">
                    <span *ngIf="resignationForm.get('lastWorkDate')?.errors?.['required']">最終出社日を入力してください</span>
                    <span *ngIf="resignationForm.get('lastWorkDate')?.errors?.['futureDate']">最終出社日は退職日以前の日付を入力してください</span>
                  </div>
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">退職事由:</span>
                <div class="detail-edit-input">
                  <textarea formControlName="resignationReason" class="form-input" rows="3"></textarea>
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">離職票の発行について:</span>
                <div class="detail-edit-input">
                  <textarea formControlName="separationNotice" class="form-input" rows="2"></textarea>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 退職後の連絡先 -->
          <section class="detail-section">
            <h3 class="section-title">退職後の連絡先</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <label class="checkbox-label">
                  <input 
                    type="checkbox" 
                    [checked]="sameAsCurrentAddressForResignation"
                    (change)="onSameAsCurrentAddressForResignationChange($event)"
                  >
                  現住所と同じ
                </label>
              </div>
              <div class="detail-item full-width" *ngIf="!sameAsCurrentAddressForResignation">
                <span class="detail-label">退職後の住所:</span>
                <div class="detail-edit-input">
                  <textarea formControlName="postResignationAddress" class="form-input" rows="2"></textarea>
                </div>
              </div>
              <div class="detail-item full-width">
                <label class="checkbox-label">
                  <input 
                    type="checkbox" 
                    [checked]="sameAsCurrentPhoneForResignation"
                    (change)="onSameAsCurrentPhoneForResignationChange($event)"
                  >
                  現電話番号と同じ
                </label>
              </div>
              <div class="detail-item" *ngIf="!sameAsCurrentPhoneForResignation">
                <span class="detail-label">退職後の電話番号:</span>
                <div class="detail-edit-input">
                  <input type="tel" formControlName="postResignationPhone" class="form-input">
                </div>
              </div>
              <div class="detail-item full-width">
                <label class="checkbox-label">
                  <input 
                    type="checkbox" 
                    [checked]="sameAsCurrentEmailForResignation"
                    (change)="onSameAsCurrentEmailForResignationChange($event)"
                  >
                  現メールアドレスと同じ
                </label>
              </div>
              <div class="detail-item" *ngIf="!sameAsCurrentEmailForResignation">
                <span class="detail-label">退職後のメールアドレス:</span>
                <div class="detail-edit-input">
                  <input type="email" formControlName="postResignationEmail" class="form-input">
                </div>
              </div>
            </div>
          </section>
          
          <!-- 退職後の社会保険加入 -->
          <section class="detail-section">
            <h3 class="section-title">退職後の社会保険加入 <span class="required">*</span></h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <div class="detail-edit-input">
                  <label class="radio-label">
                    <input type="radio" formControlName="postResignationInsurance" value="社会保険を任意継続する">
                    社会保険を任意継続する
                  </label>
                  <label class="radio-label">
                    <input type="radio" formControlName="postResignationInsurance" value="国民健康保険に加入する">
                    国民健康保険に加入する
                  </label>
                  <label class="radio-label">
                    <input type="radio" formControlName="postResignationInsurance" value="他社で社会保険に加入する">
                    他社で社会保険に加入する
                  </label>
                  <div *ngIf="resignationForm.get('postResignationInsurance')?.invalid && resignationForm.get('postResignationInsurance')?.touched" class="error-message">
                    退職後の社会保険加入を選択してください
                  </div>
                </div>
              </div>
            </div>
          </section>
        </form>
        
        <!-- 表示モード（編集モードでない場合） -->
        <ng-container *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
          <!-- 退職日・最終出社日 -->
          <section class="detail-section">
            <h3 class="section-title">退職情報</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">退職日:</span>
                <span class="detail-value">{{ selectedApplication.resignationDate || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">最終出社日:</span>
                <span class="detail-value">{{ selectedApplication.lastWorkDate || '-' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">退職事由:</span>
                <span class="detail-value">{{ selectedApplication.resignationReason || '-' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">離職票の発行について:</span>
                <span class="detail-value">{{ selectedApplication.separationNotice || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 退職後の連絡先 -->
          <section class="detail-section">
            <h3 class="section-title">退職後の連絡先</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">退職後の住所:</span>
                <span class="detail-value">{{ selectedApplication.postResignationAddress || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">退職後の電話番号:</span>
                <span class="detail-value">{{ selectedApplication.postResignationPhone || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">退職後のメールアドレス:</span>
                <span class="detail-value">{{ selectedApplication.postResignationEmail || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 退職後の社会保険加入 -->
          <section class="detail-section">
            <h3 class="section-title">退職後の社会保険加入</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">退職後の社会保険加入:</span>
                <span class="detail-value">{{ selectedApplication.postResignationInsurance || '-' }}</span>
              </div>
            </div>
          </section>
        </ng-container>
      </ng-container>
      
      <!-- 入社時申請の詳細（表示モード・編集モード） -->
      <ng-container *ngIf="selectedApplication.applicationType === '入社時申請'">
        <form [formGroup]="onboardingApplicationForm" *ngIf="isEditModeForReapplication && selectedApplication.status === '差し戻し'">
          <!-- 基本情報 -->
          <section class="detail-section">
            <h3 class="section-title">基本情報</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">姓:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ getLastName(selectedApplication.name, selectedApplication.lastName) }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="text" formControlName="lastName" class="form-input" readonly style="background: #f5f5f5;">
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">名:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ getFirstName(selectedApplication.name, selectedApplication.firstName) }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="text" formControlName="firstName" class="form-input" readonly style="background: #f5f5f5;">
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">姓（ヨミガナ） <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ getLastNameKana(selectedApplication.nameKana, selectedApplication.lastNameKana) }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="text" formControlName="lastNameKana" class="form-input">
                  <div *ngIf="onboardingApplicationForm.get('lastNameKana')?.invalid && onboardingApplicationForm.get('lastNameKana')?.touched" class="error-message">
                    <span *ngIf="onboardingApplicationForm.get('lastNameKana')?.errors?.['required']">姓（ヨミガナ）を入力してください</span>
                    <span *ngIf="onboardingApplicationForm.get('lastNameKana')?.errors?.['katakana']">カタカナで入力してください</span>
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">名（ヨミガナ） <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ getFirstNameKana(selectedApplication.nameKana, selectedApplication.firstNameKana) }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="text" formControlName="firstNameKana" class="form-input">
                  <div *ngIf="onboardingApplicationForm.get('firstNameKana')?.invalid && onboardingApplicationForm.get('firstNameKana')?.touched" class="error-message">
                    <span *ngIf="onboardingApplicationForm.get('firstNameKana')?.errors?.['required']">名（ヨミガナ）を入力してください</span>
                    <span *ngIf="onboardingApplicationForm.get('firstNameKana')?.errors?.['katakana']">カタカナで入力してください</span>
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">生年月日 <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.birthDate || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="date" formControlName="birthDate" class="form-input">
                  <div *ngIf="onboardingApplicationForm.get('birthDate')?.invalid && onboardingApplicationForm.get('birthDate')?.touched" class="error-message">生年月日を入力してください</div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">戸籍上の性別 <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.gender || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <select formControlName="gender" class="form-input">
                    <option value="">選択してください</option>
                    <option *ngFor="let g of genders" [value]="g">{{ g }}</option>
                  </select>
                  <div *ngIf="onboardingApplicationForm.get('gender')?.invalid && onboardingApplicationForm.get('gender')?.touched" class="error-message">性別を選択してください</div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">メールアドレス:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.email || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="email" formControlName="email" class="form-input" readonly style="background: #f5f5f5;">
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">本人確認書類:</span>
                <span class="detail-value" *ngIf="isInViewMode() && selectedApplication.idDocumentFileUrl">
                  <a [href]="selectedApplication.idDocumentFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.idDocumentFile || '本人確認書類を開く' }}
                  </a>
                </span>
                <span class="detail-value" *ngIf="isInViewMode() && !selectedApplication.idDocumentFileUrl">-</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input 
                    type="file" 
                    class="form-input"
                    accept=".pdf,.jpg,.jpeg,.png"
                    (change)="onFileSelected($event, 'idDocument')"
                  >
                  <div *ngIf="idDocumentFile" class="file-name">{{ idDocumentFile.name }}</div>
                  <div *ngIf="selectedApplication.idDocumentFileUrl && !idDocumentFile" class="file-info" style="margin-top: 0.5rem;">
                    <span>既存ファイル: </span>
                    <a [href]="selectedApplication.idDocumentFileUrl" target="_blank" class="file-link">
                      {{ selectedApplication.idDocumentFile || '本人確認書類を開く' }}
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- マイナンバー -->
          <section class="detail-section">
            <h3 class="section-title">マイナンバー</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">マイナンバー:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.myNumber ? '●●●●-●●●●-●●●●' : '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <div class="my-number-container">
                    <div class="my-number-inputs">
                      <input type="text" formControlName="myNumberPart1" class="form-input my-number-part" maxlength="4" placeholder="0000">
                      <span class="my-number-separator">-</span>
                      <input type="text" formControlName="myNumberPart2" class="form-input my-number-part" maxlength="4" placeholder="0000">
                      <span class="my-number-separator">-</span>
                      <input type="text" formControlName="myNumberPart3" class="form-input my-number-part" maxlength="4" placeholder="0000">
                    </div>
                  </div>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.myNumberCardFileUrl || (isInEditMode() && myNumberCardFile)">
                <span class="detail-label">マイナンバーカード:</span>
                <span class="detail-value" *ngIf="isInViewMode() && selectedApplication.myNumberCardFileUrl">
                  <a [href]="selectedApplication.myNumberCardFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.myNumberCardFile || 'マイナンバーカードを開く' }}
                  </a>
                </span>
                <span class="detail-value" *ngIf="isInViewMode() && !selectedApplication.myNumberCardFileUrl">-</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input 
                    type="file" 
                    class="form-input"
                    accept=".pdf,.jpg,.jpeg,.png"
                    (change)="onFileSelected($event, 'myNumberCard')"
                  >
                  <div *ngIf="myNumberCardFile" class="file-name">{{ myNumberCardFile.name }}</div>
                  <div *ngIf="selectedApplication.myNumberCardFileUrl && !myNumberCardFile" class="file-info" style="margin-top: 0.5rem;">
                    <span>既存ファイル: </span>
                    <a [href]="selectedApplication.myNumberCardFileUrl" target="_blank" class="file-link">
                      {{ selectedApplication.myNumberCardFile || 'マイナンバーカードを開く' }}
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 現住所と連絡先 -->
          <section class="detail-section">
            <h3 class="section-title">現住所と連絡先</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">海外に在住:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.isOverseasResident ? 'はい' : 'いいえ' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <label class="checkbox-label">
                    <input type="checkbox" formControlName="isOverseasResident" (change)="onOverseasResidentChange($event)">
                    海外に在住
                  </label>
                </div>
              </div>
              <div class="detail-item" *ngIf="!selectedApplication.isOverseasResident || (isInEditMode() && !onboardingApplicationForm.get('isOverseasResident')?.value)">
                <span class="detail-label">郵便番号:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.postalCode || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="text" formControlName="postalCode" class="form-input" maxlength="7" (input)="formatPostalCode($event)" placeholder="1234567">
                  <div *ngIf="onboardingApplicationForm.get('postalCode')?.invalid && onboardingApplicationForm.get('postalCode')?.touched" class="error-message">
                    <span *ngIf="onboardingApplicationForm.get('postalCode')?.errors?.['pattern']">7桁の数字を入力してください</span>
                  </div>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.isOverseasResident || (isInEditMode() && !onboardingApplicationForm.get('isOverseasResident')?.value)">
                <span class="detail-label">現住所 <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.currentAddress || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <textarea formControlName="currentAddress" class="form-input" rows="2"></textarea>
                  <div *ngIf="onboardingApplicationForm.get('currentAddress')?.invalid && onboardingApplicationForm.get('currentAddress')?.touched" class="error-message">現住所を入力してください</div>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.isOverseasResident || (isInEditMode() && !onboardingApplicationForm.get('isOverseasResident')?.value)">
                <span class="detail-label">現住所（ヨミガナ） <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.currentAddressKana || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <textarea formControlName="currentAddressKana" class="form-input" rows="2"></textarea>
                  <div *ngIf="onboardingApplicationForm.get('currentAddressKana')?.invalid && onboardingApplicationForm.get('currentAddressKana')?.touched" class="error-message">
                    <span *ngIf="onboardingApplicationForm.get('currentAddressKana')?.errors?.['required']">現住所（ヨミガナ）を入力してください</span>
                    <span *ngIf="onboardingApplicationForm.get('currentAddressKana')?.errors?.['katakana']">カタカナで入力してください</span>
                  </div>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.isOverseasResident || (isInEditMode() && onboardingApplicationForm.get('isOverseasResident')?.value)">
                <span class="detail-label">住所（海外） <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.overseasAddress || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <textarea formControlName="overseasAddress" class="form-input" rows="2" placeholder="海外住所を入力してください"></textarea>
                  <div *ngIf="onboardingApplicationForm.get('overseasAddress')?.invalid && onboardingApplicationForm.get('overseasAddress')?.touched" class="error-message">住所を入力してください</div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">電話番号 <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.phoneNumber || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="tel" formControlName="phoneNumber" class="form-input" (input)="formatPhoneNumber($event)">
                  <div *ngIf="onboardingApplicationForm.get('phoneNumber')?.invalid && onboardingApplicationForm.get('phoneNumber')?.touched" class="error-message">
                    <span *ngIf="onboardingApplicationForm.get('phoneNumber')?.errors?.['required']">電話番号を入力してください</span>
                    <span *ngIf="onboardingApplicationForm.get('phoneNumber')?.errors?.['pattern']">数字のみで入力してください</span>
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 住民票住所 -->
          <section class="detail-section">
            <h3 class="section-title">住民票住所</h3>
            <div class="detail-grid">
              <div class="detail-item full-width" *ngIf="!selectedApplication.isOverseasResident || (isInEditMode() && !onboardingApplicationForm.get('isOverseasResident')?.value)">
                <span class="detail-label">住所（現住所と同じ）:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.sameAsCurrentAddress ? 'はい' : 'いいえ' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <label class="checkbox-label">
                    <input type="checkbox" formControlName="sameAsCurrentAddress" (change)="onOnboardingSameAddressChange($event)">
                    住所（現住所と同じ）
                  </label>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.isOverseasResident || (isInEditMode() && onboardingApplicationForm.get('isOverseasResident')?.value)">
                <span class="detail-label">住民票住所を記載しない:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.skipResidentAddress ? 'はい' : 'いいえ' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <label class="checkbox-label">
                    <input type="checkbox" formControlName="skipResidentAddress" (change)="onSkipResidentAddressChange($event)" [disabled]="onboardingApplicationForm.get('isOverseasResident')?.value">
                    住民票住所を記載しない
                  </label>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="(selectedApplication.isOverseasResident || (isInEditMode() && onboardingApplicationForm.get('isOverseasResident')?.value)) && (selectedApplication.skipResidentAddress || (isInEditMode() && onboardingApplicationForm.get('skipResidentAddress')?.value))">
                <span class="detail-label">住民票住所を記載しない理由:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.residentAddressSkipReason || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input type="text" formControlName="residentAddressSkipReason" class="form-input" readonly>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="(!selectedApplication.isOverseasResident || (isInEditMode() && !onboardingApplicationForm.get('isOverseasResident')?.value)) && (!selectedApplication.skipResidentAddress || (isInEditMode() && !onboardingApplicationForm.get('skipResidentAddress')?.value))">
                <span class="detail-label">住所 <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.residentAddress || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <textarea formControlName="residentAddress" class="form-input" rows="2" [readonly]="onboardingApplicationForm.get('sameAsCurrentAddress')?.value"></textarea>
                  <div *ngIf="onboardingApplicationForm.get('residentAddress')?.invalid && onboardingApplicationForm.get('residentAddress')?.touched" class="error-message">住所を入力してください</div>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="(!selectedApplication.isOverseasResident || (isInEditMode() && !onboardingApplicationForm.get('isOverseasResident')?.value)) && (!selectedApplication.skipResidentAddress || (isInEditMode() && !onboardingApplicationForm.get('skipResidentAddress')?.value))">
                <span class="detail-label">住所（ヨミガナ） <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.residentAddressKana || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <textarea formControlName="residentAddressKana" class="form-input" rows="2" [readonly]="onboardingApplicationForm.get('sameAsCurrentAddress')?.value"></textarea>
                  <div *ngIf="onboardingApplicationForm.get('residentAddressKana')?.invalid && onboardingApplicationForm.get('residentAddressKana')?.touched" class="error-message">
                    <span *ngIf="onboardingApplicationForm.get('residentAddressKana')?.errors?.['required']">住所（ヨミガナ）を入力してください</span>
                    <span *ngIf="onboardingApplicationForm.get('residentAddressKana')?.errors?.['katakana']">カタカナで入力してください</span>
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 緊急連絡先 -->
          <section class="detail-section">
            <h3 class="section-title">緊急連絡先</h3>
            <div formGroupName="emergencyContact" *ngIf="isInEditMode()">
              <div class="detail-grid">
                <div class="detail-item">
                  <span class="detail-label">氏名:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.emergencyContact?.name || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <input type="text" formControlName="name" class="form-input">
                  </div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">氏名（ヨミガナ）:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.emergencyContact?.nameKana || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <input type="text" formControlName="nameKana" class="form-input">
                    <div *ngIf="onboardingApplicationForm.get('emergencyContact.nameKana')?.invalid && onboardingApplicationForm.get('emergencyContact.nameKana')?.touched" class="error-message">
                      <span *ngIf="onboardingApplicationForm.get('emergencyContact.nameKana')?.errors?.['katakana']">カタカナで入力してください</span>
                    </div>
                  </div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">続柄:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.emergencyContact?.relationship || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <input type="text" formControlName="relationship" class="form-input">
                  </div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">緊急連絡先電話番号:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.emergencyContact?.phone || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <input type="tel" formControlName="phone" class="form-input" (input)="formatEmergencyPhoneNumber($event)">
                    <div *ngIf="onboardingApplicationForm.get('emergencyContact.phone')?.invalid && onboardingApplicationForm.get('emergencyContact.phone')?.touched" class="error-message">
                      <span *ngIf="onboardingApplicationForm.get('emergencyContact.phone')?.errors?.['pattern']">数字のみで入力してください</span>
                    </div>
                  </div>
                </div>
                <div class="detail-item full-width">
                  <span class="detail-label">住所:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.emergencyContact?.address || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <textarea formControlName="address" class="form-input" rows="2"></textarea>
                  </div>
                </div>
                <div class="detail-item full-width">
                  <span class="detail-label">住所（ヨミガナ）:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.emergencyContact?.addressKana || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <textarea formControlName="addressKana" class="form-input" rows="2"></textarea>
                    <div *ngIf="onboardingApplicationForm.get('emergencyContact.addressKana')?.invalid && onboardingApplicationForm.get('emergencyContact.addressKana')?.touched" class="error-message">
                      <span *ngIf="onboardingApplicationForm.get('emergencyContact.addressKana')?.errors?.['katakana']">カタカナで入力してください</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="isInViewMode()" class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">氏名:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.name || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">氏名（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.nameKana || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">続柄:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.relationship || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">緊急連絡先電話番号:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.phone || '-' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.address || '-' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.addressKana || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 履歴書・職務経歴書 -->
          <section class="detail-section">
            <h3 class="section-title">履歴書・職務経歴書</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">履歴書:</span>
                <span class="detail-value" *ngIf="isInViewMode() && selectedApplication.resumeFileUrl">
                  <a [href]="selectedApplication.resumeFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.resumeFile || '履歴書を開く' }}
                  </a>
                </span>
                <span class="detail-value" *ngIf="isInViewMode() && !selectedApplication.resumeFileUrl">-</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input 
                    type="file" 
                    accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                    (change)="onFileSelected($event, 'resume')"
                    class="form-input"
                  >
                  <div *ngIf="resumeFile" class="file-name">{{ resumeFile.name }}</div>
                  <div *ngIf="selectedApplication.resumeFileUrl && !resumeFile" class="file-info" style="margin-top: 0.5rem;">
                    <span>既存ファイル: </span>
                    <a [href]="selectedApplication.resumeFileUrl" target="_blank" class="file-link">
                      {{ selectedApplication.resumeFile || '履歴書を開く' }}
                    </a>
                  </div>
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">職務経歴書:</span>
                <span class="detail-value" *ngIf="isInViewMode() && selectedApplication.careerHistoryFileUrl">
                  <a [href]="selectedApplication.careerHistoryFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.careerHistoryFile || '職務経歴書を開く' }}
                  </a>
                </span>
                <span class="detail-value" *ngIf="isInViewMode() && !selectedApplication.careerHistoryFileUrl">-</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input 
                    type="file" 
                    accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                    (change)="onFileSelected($event, 'careerHistory')"
                    class="form-input"
                  >
                  <div *ngIf="careerHistoryFile" class="file-name">{{ careerHistoryFile.name }}</div>
                  <div *ngIf="selectedApplication.careerHistoryFileUrl && !careerHistoryFile" class="file-info" style="margin-top: 0.5rem;">
                    <span>既存ファイル: </span>
                    <a [href]="selectedApplication.careerHistoryFileUrl" target="_blank" class="file-link">
                      {{ selectedApplication.careerHistoryFile || '職務経歴書を開く' }}
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 口座情報 -->
          <section class="detail-section">
            <h3 class="section-title">口座情報</h3>
            <div formGroupName="bankAccount" *ngIf="isInEditMode()">
              <div class="detail-grid">
                <div class="detail-item">
                  <span class="detail-label">銀行名:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.bankAccount?.bankName || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <input type="text" formControlName="bankName" class="form-input">
                  </div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">預金種別:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.bankAccount?.accountType || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <select formControlName="accountType" class="form-input">
                      <option value="">選択してください</option>
                      <option value="普通">普通</option>
                      <option value="当座">当座</option>
                      <option value="貯蓄">貯蓄</option>
                    </select>
                  </div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">名義（カタカナ）:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.bankAccount?.accountHolder || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <input type="text" formControlName="accountHolder" class="form-input">
                    <div *ngIf="onboardingApplicationForm.get('bankAccount.accountHolder')?.invalid && onboardingApplicationForm.get('bankAccount.accountHolder')?.touched" class="error-message">
                      <span *ngIf="onboardingApplicationForm.get('bankAccount.accountHolder')?.errors?.['katakana']">カタカナで入力してください</span>
                    </div>
                  </div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">支店名:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.bankAccount?.branchName || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <input type="text" formControlName="branchName" class="form-input">
                  </div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">口座番号:</span>
                  <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.bankAccount?.accountNumber || '-' }}</span>
                  <div *ngIf="isInEditMode()" class="detail-edit-input">
                    <input type="text" formControlName="accountNumber" class="form-input">
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="isInViewMode()" class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">銀行名:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.bankName || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">預金種別:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.accountType || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">名義（カタカナ）:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.accountHolder || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">支店名:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.branchName || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">口座番号:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.accountNumber || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 社会保険 -->
          <section class="detail-section">
            <h3 class="section-title">社会保険</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">基礎年金番号 <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ formatBasicPensionNumberForDisplay(selectedApplication.basicPensionNumber) }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <div class="basic-pension-number-container">
                    <input type="text" formControlName="basicPensionNumberPart1" class="form-input basic-pension-part" maxlength="4" placeholder="0000" (input)="formatOnboardingBasicPensionNumberInput($event, 1)">
                    <span class="basic-pension-separator">-</span>
                    <input type="text" formControlName="basicPensionNumberPart2" class="form-input basic-pension-part" maxlength="6" placeholder="000000" (input)="formatOnboardingBasicPensionNumberInput($event, 2)">
                  </div>
                  <div *ngIf="(onboardingApplicationForm.get('basicPensionNumberPart1')?.invalid || onboardingApplicationForm.get('basicPensionNumberPart2')?.invalid) && (onboardingApplicationForm.get('basicPensionNumberPart1')?.touched || onboardingApplicationForm.get('basicPensionNumberPart2')?.touched)" class="error-message">
                    <span *ngIf="onboardingApplicationForm.get('basicPensionNumberPart1')?.errors?.['required'] || onboardingApplicationForm.get('basicPensionNumberPart2')?.errors?.['required']">基礎年金番号を入力してください</span>
                    <span *ngIf="onboardingApplicationForm.get('basicPensionNumberPart1')?.errors?.['pattern'] || onboardingApplicationForm.get('basicPensionNumberPart2')?.errors?.['pattern']">半角数字のみで入力してください</span>
                  </div>
                </div>
              </div>
              <div class="detail-item">
                <span class="detail-label">厚生年金加入履歴:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.pensionHistoryStatus || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <select formControlName="pensionHistoryStatus" class="form-input" (change)="onPensionHistoryChange($event)">
                    <option value="">選択してください</option>
                    <option *ngFor="let option of pensionHistoryOptions" [value]="option">{{ option }}</option>
                  </select>
                </div>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.pensionHistoryStatus === '有' || (isInEditMode() && onboardingApplicationForm.get('pensionHistoryStatus')?.value === '有')">
                <span class="detail-label">厚生年金加入履歴（詳細）:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.pensionHistory || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <textarea formControlName="pensionHistory" class="form-input" rows="4"></textarea>
                </div>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">基礎年金番号がわかる書類:</span>
                <span class="detail-value" *ngIf="isInViewMode() && selectedApplication.basicPensionNumberDocFileUrl">
                  <a [href]="selectedApplication.basicPensionNumberDocFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.basicPensionNumberDocFile || '基礎年金番号がわかる書類を開く' }}
                  </a>
                </span>
                <span class="detail-value" *ngIf="isInViewMode() && !selectedApplication.basicPensionNumberDocFileUrl">-</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <input 
                    type="file" 
                    accept=".pdf,.jpg,.jpeg,.png"
                    (change)="onFileSelected($event, 'basicPensionNumberDoc')"
                    class="form-input"
                  >
                  <div *ngIf="basicPensionNumberDocFile" class="file-name">{{ basicPensionNumberDocFile.name }}</div>
                  <div *ngIf="selectedApplication.basicPensionNumberDocFileUrl && !basicPensionNumberDocFile" class="file-info" style="margin-top: 0.5rem;">
                    <span>既存ファイル: </span>
                    <a [href]="selectedApplication.basicPensionNumberDocFileUrl" target="_blank" class="file-link">
                      {{ selectedApplication.basicPensionNumberDocFile || '基礎年金番号がわかる書類を開く' }}
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 扶養者有無 -->
          <section class="detail-section">
            <h3 class="section-title">扶養者有無</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">被扶養者 <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.dependentStatus || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <select formControlName="dependentStatus" class="form-input">
                    <option value="">選択してください</option>
                    <option value="有">有</option>
                    <option value="無">無</option>
                  </select>
                  <div *ngIf="onboardingApplicationForm.get('dependentStatus')?.invalid && onboardingApplicationForm.get('dependentStatus')?.touched" class="error-message">被扶養者を選択してください</div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 資格確認書発行要否 -->
          <section class="detail-section">
            <h3 class="section-title">資格確認書発行要否</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">資格確認書発行要否 <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.qualificationCertificateRequired || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <div class="radio-group">
                    <label class="radio-label">
                      <input 
                        type="radio" 
                        formControlName="qualificationCertificateRequired" 
                        value="必要"
                        name="qualificationCertificateRequired"
                      >
                      必要
                    </label>
                    <label class="radio-label">
                      <input 
                        type="radio" 
                        formControlName="qualificationCertificateRequired" 
                        value="不要"
                        name="qualificationCertificateRequired"
                      >
                      不要
                    </label>
                  </div>
                  <div *ngIf="onboardingApplicationForm.get('qualificationCertificateRequired')?.invalid && onboardingApplicationForm.get('qualificationCertificateRequired')?.touched" class="error-message">資格確認書発行要否を選択してください</div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- 年金基金加入 -->
          <section class="detail-section">
            <h3 class="section-title">年金基金加入</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">年金基金に加入しているか <span class="required" *ngIf="isInEditMode()">*</span>:</span>
                <span class="detail-value" *ngIf="isInViewMode()">{{ selectedApplication.pensionFundMembership || '-' }}</span>
                <div *ngIf="isInEditMode()" class="detail-edit-input">
                  <div class="radio-group">
                    <label class="radio-label">
                      <input 
                        type="radio" 
                        formControlName="pensionFundMembership" 
                        value="はい"
                        name="pensionFundMembership"
                      >
                      はい
                    </label>
                    <label class="radio-label">
                      <input 
                        type="radio" 
                        formControlName="pensionFundMembership" 
                        value="いいえ"
                        name="pensionFundMembership"
                      >
                      いいえ
                    </label>
                  </div>
                  <div *ngIf="onboardingApplicationForm.get('pensionFundMembership')?.invalid && onboardingApplicationForm.get('pensionFundMembership')?.touched" class="error-message">年金基金に加入しているかを選択してください</div>
                </div>
              </div>
            </div>
          </section>
        </form>
        
        <!-- 表示モード（編集モードでない場合） -->
        <ng-container *ngIf="!isEditModeForReapplication || selectedApplication.status !== '差し戻し'">
          <!-- 基本情報 -->
          <section class="detail-section">
            <h3 class="section-title">基本情報</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">氏名:</span>
                <span class="detail-value">{{ selectedApplication.name || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">氏名（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.nameKana || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">生年月日:</span>
                <span class="detail-value">{{ selectedApplication.birthDate || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">戸籍上の性別:</span>
                <span class="detail-value">{{ selectedApplication.gender || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">メールアドレス:</span>
                <span class="detail-value">{{ selectedApplication.email || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.idDocumentFileUrl">
                <span class="detail-label">本人確認書類:</span>
                <span class="detail-value">
                  <a [href]="selectedApplication.idDocumentFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.idDocumentFile || '本人確認書類を開く' }}
                  </a>
                </span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.idDocumentFileUrl">
                <span class="detail-label">本人確認書類:</span>
                <span class="detail-value">-</span>
              </div>
            </div>
          </section>
          
          <!-- マイナンバー -->
          <section class="detail-section">
            <h3 class="section-title">マイナンバー</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">マイナンバー:</span>
                <span class="detail-value">{{ selectedApplication.myNumber ? '●●●●-●●●●-●●●●' : '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.myNumberCardFileUrl">
                <span class="detail-label">マイナンバーカード:</span>
                <span class="detail-value">
                  <a [href]="selectedApplication.myNumberCardFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.myNumberCardFile || 'マイナンバーカードを開く' }}
                  </a>
                </span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.myNumberCardFileUrl">
                <span class="detail-label">マイナンバーカード:</span>
                <span class="detail-value">-</span>
              </div>
            </div>
          </section>
          
          <!-- 現住所と連絡先 -->
          <section class="detail-section">
            <h3 class="section-title">現住所と連絡先</h3>
            <div class="detail-grid">
              <div class="detail-item full-width">
                <span class="detail-label">海外に在住:</span>
                <span class="detail-value">{{ selectedApplication.isOverseasResident ? 'はい' : 'いいえ' }}</span>
              </div>
              <div class="detail-item" *ngIf="!selectedApplication.isOverseasResident">
                <span class="detail-label">郵便番号:</span>
                <span class="detail-value">{{ selectedApplication.postalCode || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.isOverseasResident">
                <span class="detail-label">現住所:</span>
                <span class="detail-value">{{ selectedApplication.currentAddress || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.isOverseasResident">
                <span class="detail-label">現住所（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.currentAddressKana || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.isOverseasResident">
                <span class="detail-label">住所（海外）:</span>
                <span class="detail-value">{{ selectedApplication.overseasAddress || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">電話番号:</span>
                <span class="detail-value">{{ selectedApplication.phoneNumber || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 住民票住所 -->
          <section class="detail-section">
            <h3 class="section-title">住民票住所</h3>
            <div class="detail-grid">
              <div class="detail-item full-width" *ngIf="!selectedApplication.isOverseasResident">
                <span class="detail-label">住所（現住所と同じ）:</span>
                <span class="detail-value">{{ selectedApplication.sameAsCurrentAddress ? 'はい' : 'いいえ' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.isOverseasResident">
                <span class="detail-label">住民票住所を記載しない:</span>
                <span class="detail-value">{{ selectedApplication.skipResidentAddress ? 'はい' : 'いいえ' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.isOverseasResident && selectedApplication.skipResidentAddress">
                <span class="detail-label">住民票住所を記載しない理由:</span>
                <span class="detail-value">{{ selectedApplication.residentAddressSkipReason || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.isOverseasResident && !selectedApplication.skipResidentAddress">
                <span class="detail-label">住所:</span>
                <span class="detail-value">{{ selectedApplication.residentAddress || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.isOverseasResident && !selectedApplication.skipResidentAddress">
                <span class="detail-label">住所（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.residentAddressKana || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 緊急連絡先 -->
          <section class="detail-section">
            <h3 class="section-title">緊急連絡先</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">氏名:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.name || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">氏名（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.nameKana || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">続柄:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.relationship || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">緊急連絡先電話番号:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.phone || '-' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.address || '-' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">住所（ヨミガナ）:</span>
                <span class="detail-value">{{ selectedApplication.emergencyContact?.addressKana || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 履歴書・職務経歴書 -->
          <section class="detail-section">
            <h3 class="section-title">履歴書・職務経歴書</h3>
            <div class="detail-grid">
              <div class="detail-item full-width" *ngIf="selectedApplication.resumeFileUrl">
                <span class="detail-label">履歴書:</span>
                <span class="detail-value">
                  <a [href]="selectedApplication.resumeFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.resumeFile || '履歴書を開く' }}
                  </a>
                </span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.resumeFileUrl">
                <span class="detail-label">履歴書:</span>
                <span class="detail-value">-</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.careerHistoryFileUrl">
                <span class="detail-label">職務経歴書:</span>
                <span class="detail-value">
                  <a [href]="selectedApplication.careerHistoryFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.careerHistoryFile || '職務経歴書を開く' }}
                  </a>
                </span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.careerHistoryFileUrl">
                <span class="detail-label">職務経歴書:</span>
                <span class="detail-value">-</span>
              </div>
            </div>
          </section>
          
          <!-- 口座情報 -->
          <section class="detail-section">
            <h3 class="section-title">口座情報</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">銀行名:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.bankName || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">預金種別:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.accountType || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">名義（カタカナ）:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.accountHolder || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">支店名:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.branchName || '-' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">口座番号:</span>
                <span class="detail-value">{{ selectedApplication.bankAccount?.accountNumber || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 社会保険 -->
          <section class="detail-section">
            <h3 class="section-title">社会保険</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">基礎年金番号:</span>
                <span class="detail-value">{{ formatBasicPensionNumberForDisplay(selectedApplication.basicPensionNumber) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">厚生年金加入履歴:</span>
                <span class="detail-value">{{ selectedApplication.pensionHistoryStatus || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.pensionHistoryStatus === '有'">
                <span class="detail-label">厚生年金加入履歴（詳細）:</span>
                <span class="detail-value">{{ selectedApplication.pensionHistory || '-' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedApplication.basicPensionNumberDocFileUrl">
                <span class="detail-label">基礎年金番号がわかる書類:</span>
                <span class="detail-value">
                  <a [href]="selectedApplication.basicPensionNumberDocFileUrl" target="_blank" class="file-link">
                    {{ selectedApplication.basicPensionNumberDocFile || '基礎年金番号がわかる書類を開く' }}
                  </a>
                </span>
              </div>
              <div class="detail-item full-width" *ngIf="!selectedApplication.basicPensionNumberDocFileUrl">
                <span class="detail-label">基礎年金番号がわかる書類:</span>
                <span class="detail-value">-</span>
              </div>
            </div>
          </section>
          
          <!-- 扶養者有無 -->
          <section class="detail-section">
            <h3 class="section-title">扶養者有無</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">被扶養者:</span>
                <span class="detail-value">{{ selectedApplication.dependentStatus || '-' }}</span>
              </div>
            </div>
          </section>
          
          <!-- 資格確認書発行要否 -->
          <section class="detail-section">
            <h3 class="section-title">資格確認書発行要否</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">資格確認書発行要否:</span>
                <span class="detail-value">{{ selectedApplication.qualificationCertificateRequired || '-' }}</span>
              </div>
            </div>
          </section>
        </ng-container>
      </ng-container>
      
      <!-- その他の申請タイプの詳細（今後実装） -->
      <ng-container *ngIf="selectedApplication.applicationType !== '扶養家族追加' && selectedApplication.applicationType !== '扶養削除申請' && selectedApplication.applicationType !== '住所変更申請' && selectedApplication.applicationType !== '氏名変更申請' && selectedApplication.applicationType !== '産前産後休業申請' && selectedApplication.applicationType !== '退職申請' && selectedApplication.applicationType !== '保険証再発行申請' && selectedApplication.applicationType !== '入社時申請' && selectedApplication.applicationType !== 'マイナンバー変更申請'">
        <section class="detail-section">
          <p class="no-detail-message">この申請タイプの詳細表示は今後実装予定です。</p>
        </section>
      </ng-container>
    </div>
    
    <div class="modal-footer">
      <button 
        type="button" 
        class="close-detail-button" 
        (click)="closeApplicationDetailModal()"
        [disabled]="isSubmittingReapplication"
        [title]="isSubmittingReapplication ? '処理中です。しばらくお待ちください。' : ''"
      >閉じる</button>
    </div>
  </div>
</div>
