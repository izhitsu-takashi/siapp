# Firebase Functions環境変数の設定手順

## 方法1: Firebase CLIを使用（推奨・確実）

Firebaseコンソールで設定タブが見当たらない場合は、Firebase CLIを使用して環境変数を設定できます。

### 手順

1. **ターミナルでプロジェクトルートに移動**
   ```bash
   cd C:\Users\takashi.izhitsu_path\Desktop\SIApp
   ```

2. **Firebase CLIでログイン（未ログインの場合）**
   ```bash
   firebase login
   ```

3. **環境変数を設定**
   
   **SendGridを使用する場合：**
   ```bash
   firebase functions:config:set smtp.host="smtp.sendgrid.net"
   firebase functions:config:set smtp.port="587"
   firebase functions:config:set smtp.user="apikey"
   firebase functions:config:set smtp.password="SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
   firebase functions:config:set smtp.from="noreply@yourcompany.com"
   ```
   
   **Gmailを使用する場合：**
   ```bash
   firebase functions:config:set smtp.host="smtp.gmail.com"
   firebase functions:config:set smtp.port="587"
   firebase functions:config:set smtp.user="your-email@gmail.com"
   firebase functions:config:set smtp.password="xxxx xxxx xxxx xxxx"
   firebase functions:config:set smtp.from="your-email@gmail.com"
   ```

4. **環境変数の確認**
   ```bash
   firebase functions:config:get
   ```

5. **Functionsをデプロイ**
   ```bash
   cd functions
   npm run build
   firebase deploy --only functions
   ```

---

## 方法2: Firebaseコンソールを使用

FirebaseコンソールのUIが異なる場合、以下の手順を試してください：

### 手順A: Functionsページから設定

1. Firebaseコンソールにアクセス: https://console.firebase.google.com/
2. プロジェクト「kensyu10117」を選択
3. 左メニューから「Functions」をクリック
4. 上部のタブから「設定」または「Configuration」を探す
5. 「環境変数」または「Environment variables」セクションを開く

### 手順B: プロジェクト設定から

1. Firebaseコンソールにアクセス
2. プロジェクト「kensyu10117」を選択
3. 左メニューの歯車アイコン（⚙️）をクリック
4. 「プロジェクトの設定」または「Project settings」を選択
5. 「Functions」タブを探す
6. 「環境変数」セクションを開く

---

## 注意事項

### Firebase Functions v2の環境変数設定

Firebase Functions v2を使用している場合、環境変数の設定方法が異なります。

**v2の場合（推奨）：**
```bash
firebase functions:secrets:set SMTP_HOST
firebase functions:secrets:set SMTP_PORT
firebase functions:secrets:set SMTP_USER
firebase functions:secrets:set SMTP_PASSWORD
firebase functions:secrets:set SMTP_FROM
```

または、`.env`ファイルを使用：
```bash
# .envファイルを作成（functions/.env）
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASSWORD=SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SMTP_FROM=noreply@yourcompany.com
```

### 現在のコードの対応

現在のコードは`process.env`を使用しているため、以下のいずれかの方法で設定できます：

1. **Firebase Functions v1の設定方法（functions:config）**
   - コードを修正して`functions.config()`を使用する必要があります

2. **Firebase Functions v2の環境変数**
   - `.env`ファイルまたは`firebase functions:secrets:set`を使用

3. **直接process.envを使用（現在の実装）**
   - Firebase Functionsのランタイム環境変数として設定

---

## 推奨される方法

**Firebase CLIを使用する方法（方法1）を推奨します。**
- 確実に設定できる
- コンソールのUIに依存しない
- コマンドで確認できる

---

## トラブルシューティング

### 環境変数が読み込まれない場合

1. **Functionsのコードを確認**
   - `process.env.SMTP_HOST`が正しく使用されているか確認

2. **デプロイ後の確認**
   - デプロイ後、Functionsのログで環境変数が読み込まれているか確認

3. **環境変数の形式を確認**
   - 値にスペースや特殊文字が含まれている場合は、引用符で囲む

---

## 次のステップ

環境変数を設定した後：

1. Functionsをビルド: `cd functions && npm run build`
2. Functionsをデプロイ: `firebase deploy --only functions`
3. アプリでテスト: 社員を追加してメール送信を確認

